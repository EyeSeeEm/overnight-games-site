var lo=Object.defineProperty;var ho=(t,e,n)=>e in t?lo(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var We=(t,e,n)=>ho(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))h(p);new MutationObserver(p=>{for(const f of p)if(f.type==="childList")for(const S of f.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&h(S)}).observe(document,{childList:!0,subtree:!0});function n(p){const f={};return p.integrity&&(f.integrity=p.integrity),p.referrerPolicy&&(f.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?f.credentials="include":p.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function h(p){if(p.ep)return;p.ep=!0;const f=n(p);fetch(p.href,f)}})();var uo=Object.defineProperty,a=(t,e)=>uo(t,"name",{value:e,configurable:!0}),co=(()=>{for(var t=new Uint8Array(128),e=0;e<64;e++)t[e<26?e+65:e<52?e+71:e<62?e-4:e*4-205]=e;return n=>{for(var h=n.length,p=new Uint8Array((h-(n[h-1]=="=")-(n[h-2]=="="))*3/4|0),f=0,S=0;f<h;){var B=t[n.charCodeAt(f++)],F=t[n.charCodeAt(f++)],y=t[n.charCodeAt(f++)],N=t[n.charCodeAt(f++)];p[S++]=B<<2|F>>4,p[S++]=F<<4|y>>2,p[S++]=y<<6|N}return p}})();function at(t){return t*Math.PI/180}a(at,"deg2rad");function wr(t){return t*180/Math.PI}a(wr,"rad2deg");function dt(t,e,n){return e>n?dt(t,n,e):Math.min(Math.max(t,e),n)}a(dt,"clamp");function ft(t,e,n){if(typeof t=="number"&&typeof e=="number")return t+(e-t)*n;if(t instanceof M&&e instanceof M||t instanceof pe&&e instanceof pe)return t.lerp(e,n);throw new Error(`Bad value for lerp(): ${t}, ${e}. Only number, Vec2 and Color is supported.`)}a(ft,"lerp");function xt(t,e,n,h,p){return h+(t-e)/(n-e)*(p-h)}a(xt,"map");function An(t,e,n,h,p){return dt(xt(t,e,n,h,p),h,p)}a(An,"mapc");var we,M=(we=class{x=0;y=0;constructor(e=0,n=e){this.x=e,this.y=n}static fromAngle(e){let n=at(e);return new we(Math.cos(n),Math.sin(n))}clone(){return new we(this.x,this.y)}add(...e){let n=C(...e);return new we(this.x+n.x,this.y+n.y)}sub(...e){let n=C(...e);return new we(this.x-n.x,this.y-n.y)}scale(...e){let n=C(...e);return new we(this.x*n.x,this.y*n.y)}dist(...e){let n=C(...e);return this.sub(n).len()}sdist(...e){let n=C(...e);return this.sub(n).slen()}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let e=this.len();return e===0?new we(0):this.scale(1/e)}normal(){return new we(this.y,-this.x)}reflect(e){return this.sub(e.scale(2*this.dot(e)))}project(e){return e.scale(e.dot(this)/e.len())}reject(e){return this.sub(this.project(e))}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}angle(...e){let n=C(...e);return wr(Math.atan2(this.y-n.y,this.x-n.x))}angleBetween(...e){let n=C(...e);return wr(Math.atan2(this.cross(n),this.dot(n)))}lerp(e,n){return new we(ft(this.x,e.x,n),ft(this.y,e.y,n))}slerp(e,n){let h=this.dot(e),p=this.cross(e),f=Math.atan2(p,h);return this.scale(Math.sin((1-n)*f)).add(e.scale(Math.sin(n*f))).scale(1/p)}isZero(){return this.x===0&&this.y===0}toFixed(e){return new we(Number(this.x.toFixed(e)),Number(this.y.toFixed(e)))}transform(e){return e.multVec2(this)}eq(e){return this.x===e.x&&this.y===e.y}bbox(){return new ze(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}},a(we,"Vec2"),We(we,"LEFT",new we(-1,0)),We(we,"RIGHT",new we(1,0)),We(we,"UP",new we(0,-1)),We(we,"DOWN",new we(0,1)),we);function C(...t){if(t.length===1){if(t[0]instanceof M)return new M(t[0].x,t[0].y);if(Array.isArray(t[0])&&t[0].length===2)return new M(...t[0])}return new M(...t)}a(C,"vec2");var oe,pe=(oe=class{r=255;g=255;b=255;constructor(e,n,h){this.r=dt(e,0,255),this.g=dt(n,0,255),this.b=dt(h,0,255)}static fromArray(e){return new oe(e[0],e[1],e[2])}static fromHex(e){if(typeof e=="number")return new oe(e>>16&255,e>>8&255,e>>0&255);if(typeof e=="string"){let n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return new oe(parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16))}else throw new Error("Invalid hex color format")}static fromHSL(e,n,h){if(n==0)return new oe(255*h,255*h,255*h);let p=a((N,E,g)=>(g<0&&(g+=1),g>1&&(g-=1),g<1/6?N+(E-N)*6*g:g<1/2?E:g<2/3?N+(E-N)*(2/3-g)*6:N),"hue2rgb"),f=h<.5?h*(1+n):h+n-h*n,S=2*h-f,B=p(S,f,e+1/3),F=p(S,f,e),y=p(S,f,e-1/3);return new oe(Math.round(B*255),Math.round(F*255),Math.round(y*255))}clone(){return new oe(this.r,this.g,this.b)}lighten(e){return new oe(this.r+e,this.g+e,this.b+e)}darken(e){return this.lighten(-e)}invert(){return new oe(255-this.r,255-this.g,255-this.b)}mult(e){return new oe(this.r*e.r/255,this.g*e.g/255,this.b*e.b/255)}lerp(e,n){return new oe(ft(this.r,e.r,n),ft(this.g,e.g,n),ft(this.b,e.b,n))}toHSL(){let e=this.r/255,n=this.g/255,h=this.b/255,p=Math.max(e,n,h),f=Math.min(e,n,h),S=(p+f)/2,B=S,F=S;if(p==f)S=B=0;else{let y=p-f;switch(B=F>.5?y/(2-p-f):y/(p+f),p){case e:S=(n-h)/y+(n<h?6:0);break;case n:S=(h-e)/y+2;break;case h:S=(e-n)/y+4;break}S/=6}return[S,B,F]}eq(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}},a(oe,"Color"),We(oe,"RED",new oe(255,0,0)),We(oe,"GREEN",new oe(0,255,0)),We(oe,"BLUE",new oe(0,0,255)),We(oe,"YELLOW",new oe(255,255,0)),We(oe,"MAGENTA",new oe(255,0,255)),We(oe,"CYAN",new oe(0,255,255)),We(oe,"WHITE",new oe(255,255,255)),We(oe,"BLACK",new oe(0,0,0)),oe);function ue(...t){if(t.length===0)return new pe(255,255,255);if(t.length===1){if(t[0]instanceof pe)return t[0].clone();if(typeof t[0]=="string")return pe.fromHex(t[0]);if(Array.isArray(t[0])&&t[0].length===3)return pe.fromArray(t[0])}return new pe(...t)}a(ue,"rgb");var fo=a((t,e,n)=>pe.fromHSL(t,e,n),"hsl2rgb"),Vt,Pe=(Vt=class{x=0;y=0;w=1;h=1;constructor(e,n,h,p){this.x=e,this.y=n,this.w=h,this.h=p}scale(e){return new Vt(this.x+this.w*e.x,this.y+this.h*e.y,this.w*e.w,this.h*e.h)}pos(){return new M(this.x,this.y)}clone(){return new Vt(this.x,this.y,this.w,this.h)}eq(e){return this.x===e.x&&this.y===e.y&&this.w===e.w&&this.h===e.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}},a(Vt,"Quad"),Vt);function xe(t,e,n,h){return new Pe(t,e,n,h)}a(xe,"quad");var Ye,ot=(Ye=class{m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];constructor(e){e&&(this.m=e)}static translate(e){return new Ye([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,0,1])}static scale(e){return new Ye([e.x,0,0,0,0,e.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(e){e=at(-e);let n=Math.cos(e),h=Math.sin(e);return new Ye([1,0,0,0,0,n,-h,0,0,h,n,0,0,0,0,1])}static rotateY(e){e=at(-e);let n=Math.cos(e),h=Math.sin(e);return new Ye([n,0,h,0,0,1,0,0,-h,0,n,0,0,0,0,1])}static rotateZ(e){e=at(-e);let n=Math.cos(e),h=Math.sin(e);return new Ye([n,-h,0,0,h,n,0,0,0,0,1,0,0,0,0,1])}translate(e){return this.m[12]+=this.m[0]*e.x+this.m[4]*e.y,this.m[13]+=this.m[1]*e.x+this.m[5]*e.y,this.m[14]+=this.m[2]*e.x+this.m[6]*e.y,this.m[15]+=this.m[3]*e.x+this.m[7]*e.y,this}scale(e){return this.m[0]*=e.x,this.m[4]*=e.y,this.m[1]*=e.x,this.m[5]*=e.y,this.m[2]*=e.x,this.m[6]*=e.y,this.m[3]*=e.x,this.m[7]*=e.y,this}rotate(e){e=at(-e);let n=Math.cos(e),h=Math.sin(e),p=this.m[0],f=this.m[1],S=this.m[4],B=this.m[5];return this.m[0]=p*n+f*h,this.m[1]=-p*h+f*n,this.m[4]=S*n+B*h,this.m[5]=-S*h+B*n,this}mult(e){let n=[];for(let h=0;h<4;h++)for(let p=0;p<4;p++)n[h*4+p]=this.m[0+p]*e.m[h*4+0]+this.m[4+p]*e.m[h*4+1]+this.m[8+p]*e.m[h*4+2]+this.m[12+p]*e.m[h*4+3];return new Ye(n)}multVec2(e){return new M(e.x*this.m[0]+e.y*this.m[4]+this.m[12],e.x*this.m[1]+e.y*this.m[5]+this.m[13])}getTranslation(){return new M(this.m[12],this.m[13])}getScale(){if(this.m[0]!=0||this.m[1]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],n=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new M(n,e/n)}else if(this.m[4]!=0||this.m[5]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],n=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new M(e/n,n)}else return new M(0,0)}getRotation(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return wr(this.m[1]>0?Math.acos(this.m[0]/e):-Math.acos(this.m[0]/e))}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return wr(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/e):-Math.acos(this.m[4]/e)))}else return 0}getSkew(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new M(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e),0)}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new M(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e))}else return new M(0,0)}invert(){let e=[],n=this.m[10]*this.m[15]-this.m[14]*this.m[11],h=this.m[9]*this.m[15]-this.m[13]*this.m[11],p=this.m[9]*this.m[14]-this.m[13]*this.m[10],f=this.m[8]*this.m[15]-this.m[12]*this.m[11],S=this.m[8]*this.m[14]-this.m[12]*this.m[10],B=this.m[8]*this.m[13]-this.m[12]*this.m[9],F=this.m[6]*this.m[15]-this.m[14]*this.m[7],y=this.m[5]*this.m[15]-this.m[13]*this.m[7],N=this.m[5]*this.m[14]-this.m[13]*this.m[6],E=this.m[4]*this.m[15]-this.m[12]*this.m[7],g=this.m[4]*this.m[14]-this.m[12]*this.m[6],w=this.m[5]*this.m[15]-this.m[13]*this.m[7],j=this.m[4]*this.m[13]-this.m[12]*this.m[5],W=this.m[6]*this.m[11]-this.m[10]*this.m[7],te=this.m[5]*this.m[11]-this.m[9]*this.m[7],H=this.m[5]*this.m[10]-this.m[9]*this.m[6],U=this.m[4]*this.m[11]-this.m[8]*this.m[7],T=this.m[4]*this.m[10]-this.m[8]*this.m[6],De=this.m[4]*this.m[9]-this.m[8]*this.m[5];e[0]=this.m[5]*n-this.m[6]*h+this.m[7]*p,e[4]=-(this.m[4]*n-this.m[6]*f+this.m[7]*S),e[8]=this.m[4]*h-this.m[5]*f+this.m[7]*B,e[12]=-(this.m[4]*p-this.m[5]*S+this.m[6]*B),e[1]=-(this.m[1]*n-this.m[2]*h+this.m[3]*p),e[5]=this.m[0]*n-this.m[2]*f+this.m[3]*S,e[9]=-(this.m[0]*h-this.m[1]*f+this.m[3]*B),e[13]=this.m[0]*p-this.m[1]*S+this.m[2]*B,e[2]=this.m[1]*F-this.m[2]*y+this.m[3]*N,e[6]=-(this.m[0]*F-this.m[2]*E+this.m[3]*g),e[10]=this.m[0]*w-this.m[1]*E+this.m[3]*j,e[14]=-(this.m[0]*N-this.m[1]*g+this.m[2]*j),e[3]=-(this.m[1]*W-this.m[2]*te+this.m[3]*H),e[7]=this.m[0]*W-this.m[2]*U+this.m[3]*T,e[11]=-(this.m[0]*te-this.m[1]*U+this.m[3]*De),e[15]=this.m[0]*H-this.m[1]*T+this.m[2]*De;let _=this.m[0]*e[0]+this.m[1]*e[4]+this.m[2]*e[8]+this.m[3]*e[12];for(let Le=0;Le<4;Le++)for(let ye=0;ye<4;ye++)e[Le*4+ye]*=1/_;return new Ye(e)}clone(){return new Ye([...this.m])}toString(){return this.m.toString()}},a(Ye,"Mat4"),Ye);function Fi(t,e,n,h=p=>-Math.cos(p)){return t+(h(n)+1)/2*(e-t)}a(Fi,"wave");var po=1103515245,go=12345,en=2147483648,sr,yn=(sr=class{seed;constructor(e){this.seed=e}gen(){return this.seed=(po*this.seed+go)%en,this.seed/en}genNumber(e,n){return e+this.gen()*(n-e)}genVec2(e,n){return new M(this.genNumber(e.x,n.x),this.genNumber(e.y,n.y))}genColor(e,n){return new pe(this.genNumber(e.r,n.r),this.genNumber(e.g,n.g),this.genNumber(e.b,n.b))}genAny(...e){if(e.length===0)return this.gen();if(e.length===1){if(typeof e[0]=="number")return this.genNumber(0,e[0]);if(e[0]instanceof M)return this.genVec2(C(0,0),e[0]);if(e[0]instanceof pe)return this.genColor(ue(0,0,0),e[0])}else if(e.length===2){if(typeof e[0]=="number"&&typeof e[1]=="number")return this.genNumber(e[0],e[1]);if(e[0]instanceof M&&e[1]instanceof M)return this.genVec2(e[0],e[1]);if(e[0]instanceof pe&&e[1]instanceof pe)return this.genColor(e[0],e[1])}}},a(sr,"RNG"),sr),Ci=new yn(Date.now());function vn(t){return t!=null&&(Ci.seed=t),Ci.seed}a(vn,"randSeed");function Lr(...t){return Ci.genAny(...t)}a(Lr,"rand");function Oi(...t){return Math.floor(Lr(...t))}a(Oi,"randi");function xn(t){return Lr()<=t}a(xn,"chance");function Vn(t){return t[Oi(t.length)]}a(Vn,"choose");function En(t,e){return t.pos.x+t.width>e.pos.x&&t.pos.x<e.pos.x+e.width&&t.pos.y+t.height>e.pos.y&&t.pos.y<e.pos.y+e.height}a(En,"testRectRect");function bn(t,e){if(t.p1.x===t.p2.x&&t.p1.y===t.p2.y||e.p1.x===e.p2.x&&e.p1.y===e.p2.y)return null;let n=(e.p2.y-e.p1.y)*(t.p2.x-t.p1.x)-(e.p2.x-e.p1.x)*(t.p2.y-t.p1.y);if(n===0)return null;let h=((e.p2.x-e.p1.x)*(t.p1.y-e.p1.y)-(e.p2.y-e.p1.y)*(t.p1.x-e.p1.x))/n,p=((t.p2.x-t.p1.x)*(t.p1.y-e.p1.y)-(t.p2.y-t.p1.y)*(t.p1.x-e.p1.x))/n;return h<0||h>1||p<0||p>1?null:h}a(bn,"testLineLineT");function rr(t,e){let n=bn(t,e);return n?C(t.p1.x+n*(t.p2.x-t.p1.x),t.p1.y+n*(t.p2.y-t.p1.y)):null}a(rr,"testLineLine");function Rn(t,e){if(Ur(t,e.p1)||Ur(t,e.p2))return!0;let n=t.points();return!!rr(e,new ir(n[0],n[1]))||!!rr(e,new ir(n[1],n[2]))||!!rr(e,new ir(n[2],n[3]))||!!rr(e,new ir(n[3],n[0]))}a(Rn,"testRectLine");function Ur(t,e){return e.x>t.pos.x&&e.x<t.pos.x+t.width&&e.y>t.pos.y&&e.y<t.pos.y+t.height}a(Ur,"testRectPoint");function Mn(t,e){let n=e.sub(t.p1),h=t.p2.sub(t.p1);if(Math.abs(n.cross(h))>Number.EPSILON)return!1;let p=n.dot(h)/h.dot(h);return p>=0&&p<=1}a(Mn,"testLinePoint");function Gi(t,e){let n=t.p2.sub(t.p1),h=n.dot(n),p=t.p1.sub(e.center),f=2*n.dot(p),S=p.dot(p)-e.radius*e.radius,B=f*f-4*h*S;if(h<=Number.EPSILON||B<0)return!1;if(B==0){let F=-f/(2*h);if(F>=0&&F<=1)return!0}else{let F=(-f+Math.sqrt(B))/(2*h),y=(-f-Math.sqrt(B))/(2*h);if(F>=0&&F<=1||y>=0&&y<=1)return!0}return Hi(e,t.p1)}a(Gi,"testLineCircle");function Hi(t,e){return t.center.sdist(e)<t.radius*t.radius}a(Hi,"testCirclePoint");function Sn(t,e){let n=e.pts[e.pts.length-1];for(let h of e.pts){if(Gi(new ir(n,h),t))return!0;n=h}return Hi(t,e.pts[0])?!0:zi(e,t.center)}a(Sn,"testCirclePolygon");function zi(t,e){let n=!1,h=t.pts;for(let p=0,f=h.length-1;p<h.length;f=p++)h[p].y>e.y!=h[f].y>e.y&&e.x<(h[f].x-h[p].x)*(e.y-h[p].y)/(h[f].y-h[p].y)+h[p].x&&(n=!n);return n}a(zi,"testPolygonPoint");var Et,ir=(Et=class{p1;p2;constructor(e,n){this.p1=e.clone(),this.p2=n.clone()}transform(e){return new Et(e.multVec2(this.p1),e.multVec2(this.p2))}bbox(){return ze.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new Et(this.p1,this.p2)}},a(Et,"Line"),Et),bt,ze=(bt=class{pos;width;height;constructor(e,n,h){this.pos=e.clone(),this.width=n,this.height=h}static fromPoints(e,n){return new bt(e.clone(),n.x-e.x,n.y-e.y)}center(){return new M(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(e){return new Fr(this.points().map(n=>e.multVec2(n)))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new bt(this.pos.clone(),this.width,this.height)}distToPoint(e){return Math.sqrt(this.sdistToPoint(e))}sdistToPoint(e){let n=this.pos,h=this.pos.add(this.width,this.height),p=Math.max(n.x-e.x,0,e.x-h.x),f=Math.max(n.y-e.y,0,e.y-h.y);return p*p+f*f}},a(bt,"Rect"),bt),zt,tn=(zt=class{center;radius;constructor(e,n){this.center=e.clone(),this.radius=n}transform(e){return new mo(this.center,this.radius,this.radius).transform(e)}bbox(){return ze.fromPoints(this.center.sub(C(this.radius)),this.center.add(C(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new zt(this.center,this.radius)}},a(zt,"Circle"),zt),Rt,mo=(Rt=class{center;radiusX;radiusY;constructor(e,n,h){this.center=e.clone(),this.radiusX=n,this.radiusY=h}transform(e){return new Rt(e.multVec2(this.center),e.m[0]*this.radiusX,e.m[5]*this.radiusY)}bbox(){return ze.fromPoints(this.center.sub(C(this.radiusX,this.radiusY)),this.center.add(C(this.radiusX,this.radiusY)))}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new Rt(this.center,this.radiusX,this.radiusY)}},a(Rt,"Ellipse"),Rt),Mt,Fr=(Mt=class{pts;constructor(e){if(e.length<3)throw new Error("Polygons should have at least 3 vertices");this.pts=e}transform(e){return new Mt(this.pts.map(n=>e.multVec2(n)))}bbox(){let e=C(Number.MAX_VALUE),n=C(-Number.MAX_VALUE);for(let h of this.pts)e.x=Math.min(e.x,h.x),n.x=Math.max(n.x,h.x),e.y=Math.min(e.y,h.y),n.y=Math.max(n.y,h.y);return ze.fromPoints(e,n)}area(){let e=0,n=this.pts.length;for(let h=0;h<n;h++){let p=this.pts[h],f=this.pts[(h+1)%n];e+=p.x*f.y*.5,e-=f.x*p.y*.5}return Math.abs(e)}clone(){return new Mt(this.pts.map(e=>e.clone()))}},a(Mt,"Polygon"),Mt);function Tn(t,e){let n=Number.MAX_VALUE,h=C(0);for(let p of[t,e])for(let f=0;f<p.pts.length;f++){let S=p.pts[f],B=p.pts[(f+1)%p.pts.length].sub(S).normal().unit(),F=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let w=0;w<t.pts.length;w++){let j=t.pts[w].dot(B);F=Math.min(F,j),y=Math.max(y,j)}let N=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let w=0;w<e.pts.length;w++){let j=e.pts[w].dot(B);N=Math.min(N,j),E=Math.max(E,j)}let g=Math.min(y,E)-Math.max(F,N);if(g<0)return null;if(g<Math.abs(n)){let w=E-F,j=N-y;n=Math.abs(w)<Math.abs(j)?w:j,h=B.scale(n)}}return h}a(Tn,"sat");var nr,Pn=(nr=class extends Map{lastID;constructor(...e){super(...e),this.lastID=0}push(e){let n=this.lastID;return this.set(n,e),this.lastID++,n}pushd(e){let n=this.push(e);return()=>this.delete(n)}},a(nr,"Registry"),nr),Kt,tr=(Kt=class{paused=!1;cancel;constructor(e){this.cancel=e}static join(e){let n=new Kt(()=>e.forEach(h=>h.cancel()));return Object.defineProperty(n,"paused",{get:()=>e[0].paused,set:h=>e.forEach(p=>p.paused=h)}),n.paused=!1,n}},a(Kt,"EventController"),Kt),or,et=(or=class{handlers=new Pn;add(e){let n=this.handlers.pushd((...p)=>{h.paused||e(...p)}),h=new tr(n);return h}addOnce(e){let n=this.add((...h)=>{n.cancel(),e(...h)});return n}next(){return new Promise(e=>this.addOnce(e))}trigger(...e){this.handlers.forEach(n=>n(...e))}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}},a(or,"Event"),or),ar,Cr=(ar=class{handlers={};on(e,n){return this.handlers[e]||(this.handlers[e]=new et),this.handlers[e].add(n)}onOnce(e,n){let h=this.on(e,(...p)=>{h.cancel(),n(...p)});return h}next(e){return new Promise(n=>{this.onOnce(e,(...h)=>n(h[0]))})}trigger(e,...n){this.handlers[e]&&this.handlers[e].trigger(...n)}remove(e){delete this.handlers[e]}clear(){this.handlers={}}numListeners(e){return this.handlers[e]?.numListeners()??0}},a(ar,"EventHandler"),ar);function ti(t,e){if(t===e)return!0;let n=typeof t,h=typeof e;if(n!==h)return!1;if(n==="object"&&h==="object"&&t!==null&&e!==null){if(Array.isArray(t)!==Array.isArray(e))return!1;let p=Object.keys(t),f=Object.keys(e);if(p.length!==f.length)return!1;for(let S of p){let B=t[S],F=e[S];if(!ti(B,F))return!1}return!0}return!1}a(ti,"deepEq");function Dn(t){let e=window.atob(t),n=e.length,h=new Uint8Array(n);for(let p=0;p<n;p++)h[p]=e.charCodeAt(p);return h.buffer}a(Dn,"base64ToArrayBuffer");function Fn(t){return Dn(t.split(",")[1])}a(Fn,"dataURLToArrayBuffer");function ri(t,e){let n=document.createElement("a");n.href=e,n.download=t,n.click()}a(ri,"download");function Ki(t,e){ri(t,"data:text/plain;charset=utf-8,"+e)}a(Ki,"downloadText");function Cn(t,e){Ki(t,JSON.stringify(e))}a(Cn,"downloadJSON");function Bi(t,e){let n=URL.createObjectURL(e);ri(t,n),URL.revokeObjectURL(n)}a(Bi,"downloadBlob");var rn=a(t=>t.match(/^data:\w+\/\w+;base64,.+/),"isDataURL"),wo=a(t=>t.split(".").slice(0,-1).join("."),"getFileName");function Xe(t,e){return(...n)=>{let h=n.length;if(h===t.length)return t(...n);if(h===e.length)return e(...n)}}a(Xe,"overload2");var Ao=(()=>{let t=0;return()=>t++})(),yo=a(t=>t instanceof Error?t.message:String(t),"getErrorMessage"),lr,vo=(lr=class{_items;_compareFn;constructor(e=(n,h)=>n<h){this._compareFn=e,this._items=[]}insert(e){this._items.push(e),this.moveUp(this._items.length-1)}remove(){if(this._items.length===0)return null;let e=this._items[0],n=this._items.pop();return this._items.length!==0&&(this._items[0]=n,this.moveDown(0)),e}clear(){this._items.splice(0,this._items.length)}moveUp(e){for(;e>0;){let n=Math.floor((e-1)/2);if(!this._compareFn(this._items[e],this._items[n])&&this._items[e]>=this._items[n])break;this.swap(e,n),e=n}}moveDown(e){for(;e<Math.floor(this._items.length/2);){let n=2*e+1;if(n<this._items.length-1&&!this._compareFn(this._items[n],this._items[n+1])&&++n,this._compareFn(this._items[e],this._items[n]))break;this.swap(e,n),e=n}}swap(e,n){[this._items[e],this._items[n]]=[this._items[n],this._items[e]]}get length(){return this._items.length}},a(lr,"BinaryHeap"),lr),xo=Object.freeze([776,2359,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520]);function Bn(t){if(typeof t!="string")throw new TypeError("string cannot be undefined or null");let e=[],n=0,h=0;for(;n<t.length;){if(h+=In(n+h,t),zn(t[n+h])&&h++,On(t[n+h])&&h++,Gn(t[n+h])&&h++,Kn(t[n+h])){h++;continue}e.push(t.substring(n,n+h)),n+=h,h=0}return e}a(Bn,"runes");function In(t,e){let n=e[t];if(!Ln(n)||t===e.length-1)return 1;let h=n+e[t+1],p=e.substring(t+2,t+5);return Ii(h)&&Ii(p)?4:Un(h)&&Hn(p)?e.slice(t).indexOf(String.fromCodePoint(917631))+2:Nn(p)?4:2}a(In,"nextUnits");function Ln(t){return t&&St(t[0].charCodeAt(0),55296,56319)}a(Ln,"isFirstOfSurrogatePair");function Ii(t){return St(ii(t),127462,127487)}a(Ii,"isRegionalIndicator");function Un(t){return St(ii(t),127988,127988)}a(Un,"isSubdivisionFlag");function Nn(t){return St(ii(t),127995,127999)}a(Nn,"isFitzpatrickModifier");function On(t){return typeof t=="string"&&St(t.charCodeAt(0),65024,65039)}a(On,"isVariationSelector");function Gn(t){return typeof t=="string"&&St(t.charCodeAt(0),8400,8447)}a(Gn,"isDiacriticalMark");function Hn(t){let e=t.codePointAt(0);return typeof t=="string"&&typeof e=="number"&&St(e,917504,917631)}a(Hn,"isSupplementarySpecialpurposePlane");function zn(t){return typeof t=="string"&&xo.includes(t.charCodeAt(0))}a(zn,"isGrapheme");function Kn(t){return typeof t=="string"&&t.charCodeAt(0)===8205}a(Kn,"isZeroWidthJoiner");function ii(t){let e=t.charCodeAt(0)-55296,n=t.charCodeAt(1)-56320;return(e<<10)+n+65536}a(ii,"codePointFromSurrogatePair");function St(t,e,n){return t>=e&&t<=n}a(St,"betweenInclusive");var sn={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"select",10:"lstick",16:"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"start",10:"lstick",16:"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}},hr,kr=(hr=class{pressed=new Set([]);pressedRepeat=new Set([]);released=new Set([]);down=new Set([]);update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(e){this.pressed.add(e),this.pressedRepeat.add(e),this.down.add(e)}pressRepeat(e){this.pressedRepeat.add(e)}release(e){this.down.delete(e),this.pressed.delete(e),this.released.add(e)}},a(hr,"ButtonState"),hr),ur,Vo=(ur=class{buttonState=new kr;stickState=new Map},a(ur,"GamepadState"),ur),cr,Eo=(cr=class{dts=[];timer=0;fps=0;tick(e){this.dts.push(e),this.timer+=e,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce((n,h)=>n+h)/this.dts.length)),this.dts=[])}},a(cr,"FPSCounter"),cr),bo=a(t=>{if(!t.canvas)throw new Error("Please provide a canvas");let e={canvas:t.canvas,loopID:null,stopped:!1,dt:0,time:0,realTime:0,fpsCounter:new Eo,timeScale:1,skipTime:!1,numFrames:0,mousePos:new M(0),mouseDeltaPos:new M(0),keyState:new kr,mouseState:new kr,mergedGamepadState:new Vo,gamepadStates:new Map,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:t.canvas.offsetWidth,lastHeight:t.canvas.offsetHeight,events:new Cr};function n(){return e.dt*e.timeScale}a(n,"dt");function h(){return e.time}a(h,"time");function p(){return e.fpsCounter.fps}a(p,"fps");function f(){return e.numFrames}a(f,"numFrames");function S(){return e.canvas.toDataURL()}a(S,"screenshot");function B(d){e.canvas.style.cursor=d}a(B,"setCursor");function F(){return e.canvas.style.cursor}a(F,"getCursor");function y(d){if(d)try{let b=e.canvas.requestPointerLock();b.catch&&b.catch(D=>console.error(D))}catch(b){console.error(b)}else document.exitPointerLock()}a(y,"setCursorLocked");function N(){return!!document.pointerLockElement}a(N,"isCursorLocked");function E(d){d.requestFullscreen?d.requestFullscreen():d.webkitRequestFullscreen&&d.webkitRequestFullscreen()}a(E,"enterFullscreen");function g(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}a(g,"exitFullscreen");function w(){return document.fullscreenElement||document.webkitFullscreenElement}a(w,"getFullscreenElement");function j(d=!0){d?E(e.canvas):g()}a(j,"setFullscreen");function W(){return!!w()}a(W,"isFullscreen");function te(){e.stopped=!0;for(let d in ge)e.canvas.removeEventListener(d,ge[d]);for(let d in Ee)document.removeEventListener(d,Ee[d]);for(let d in Ae)window.removeEventListener(d,Ae[d]);Be.disconnect()}a(te,"quit");function H(d){e.loopID!==null&&cancelAnimationFrame(e.loopID);let b=0,D=a(ee=>{if(e.stopped)return;if(document.visibilityState!=="visible"){e.loopID=requestAnimationFrame(D);return}let ne=ee/1e3,Re=ne-e.realTime,qe=t.maxFPS?1/t.maxFPS:0;e.realTime=ne,b+=Re,b>qe&&(e.skipTime||(e.dt=b,e.time+=n(),e.fpsCounter.tick(e.dt)),b=0,e.skipTime=!1,e.numFrames++,Bt(),d(),vr()),e.loopID=requestAnimationFrame(D)},"frame");D(0)}a(H,"run");function U(){return"ontouchstart"in window||navigator.maxTouchPoints>0}a(U,"isTouchscreen");function T(){return e.mousePos.clone()}a(T,"mousePos");function De(){return e.mouseDeltaPos.clone()}a(De,"mouseDeltaPos");function _(d="left"){return e.mouseState.pressed.has(d)}a(_,"isMousePressed");function Le(d="left"){return e.mouseState.down.has(d)}a(Le,"isMouseDown");function ye(d="left"){return e.mouseState.released.has(d)}a(ye,"isMouseReleased");function Ve(){return e.isMouseMoved}a(Ve,"isMouseMoved");function tt(d){return d===void 0?e.keyState.pressed.size>0:e.keyState.pressed.has(d)}a(tt,"isKeyPressed");function Tt(d){return d===void 0?e.keyState.pressedRepeat.size>0:e.keyState.pressedRepeat.has(d)}a(Tt,"isKeyPressedRepeat");function rt(d){return d===void 0?e.keyState.down.size>0:e.keyState.down.has(d)}a(rt,"isKeyDown");function Fe(d){return d===void 0?e.keyState.released.size>0:e.keyState.released.has(d)}a(Fe,"isKeyReleased");function Ue(d){return d===void 0?e.mergedGamepadState.buttonState.pressed.size>0:e.mergedGamepadState.buttonState.pressed.has(d)}a(Ue,"isGamepadButtonPressed");function Je(d){return d===void 0?e.mergedGamepadState.buttonState.down.size>0:e.mergedGamepadState.buttonState.down.has(d)}a(Je,"isGamepadButtonDown");function it(d){return d===void 0?e.mergedGamepadState.buttonState.released.size>0:e.mergedGamepadState.buttonState.released.has(d)}a(it,"isGamepadButtonReleased");function pt(d){return e.events.on("resize",d)}a(pt,"onResize");let lt=Xe(d=>e.events.on("keyDown",d),(d,b)=>e.events.on("keyDown",D=>D===d&&b(d))),jt=Xe(d=>e.events.on("keyPress",d),(d,b)=>e.events.on("keyPress",D=>D===d&&b(d))),Qt=Xe(d=>e.events.on("keyPressRepeat",d),(d,b)=>e.events.on("keyPressRepeat",D=>D===d&&b(d))),P=Xe(d=>e.events.on("keyRelease",d),(d,b)=>e.events.on("keyRelease",D=>D===d&&b(d))),k=Xe(d=>e.events.on("mouseDown",b=>d(b)),(d,b)=>e.events.on("mouseDown",D=>D===d&&b(D))),re=Xe(d=>e.events.on("mousePress",b=>d(b)),(d,b)=>e.events.on("mousePress",D=>D===d&&b(D))),Y=Xe(d=>e.events.on("mouseRelease",b=>d(b)),(d,b)=>e.events.on("mouseRelease",D=>D===d&&b(D)));function se(d){return e.events.on("mouseMove",()=>d(T(),De()))}a(se,"onMouseMove");function Q(d){return e.events.on("charInput",d)}a(Q,"onCharInput");function ce(d){return e.events.on("touchStart",d)}a(ce,"onTouchStart");function Ne(d){return e.events.on("touchMove",d)}a(Ne,"onTouchMove");function Ce(d){return e.events.on("touchEnd",d)}a(Ce,"onTouchEnd");function Oe(d){return e.events.on("scroll",d)}a(Oe,"onScroll");function Ke(d){return e.events.on("hide",d)}a(Ke,"onHide");function Pt(d){return e.events.on("show",d)}a(Pt,"onShow");function Wt(d,b){if(typeof d=="function")return e.events.on("gamepadButtonDown",d);if(typeof d=="string"&&typeof b=="function")return e.events.on("gamepadButtonDown",D=>D===d&&b(d))}a(Wt,"onGamepadButtonDown");function Xt(d,b){if(typeof d=="function")return e.events.on("gamepadButtonPress",d);if(typeof d=="string"&&typeof b=="function")return e.events.on("gamepadButtonPress",D=>D===d&&b(d))}a(Xt,"onGamepadButtonPress");function Ar(d,b){if(typeof d=="function")return e.events.on("gamepadButtonRelease",d);if(typeof d=="string"&&typeof b=="function")return e.events.on("gamepadButtonRelease",D=>D===d&&b(d))}a(Ar,"onGamepadButtonRelease");function Dt(d,b){return e.events.on("gamepadStick",(D,ee)=>D===d&&b(ee))}a(Dt,"onGamepadStick");function yr(d){e.events.on("gamepadConnect",d)}a(yr,"onGamepadConnect");function Ft(d){e.events.on("gamepadDisconnect",d)}a(Ft,"onGamepadDisconnect");function Ze(d){return e.mergedGamepadState.stickState.get(d)||new M(0)}a(Ze,"getGamepadStick");function Ct(){return[...e.charInputted]}a(Ct,"charInputted");function Jt(){return[...e.gamepads]}a(Jt,"getGamepads");function Bt(){e.events.trigger("input"),e.keyState.down.forEach(d=>e.events.trigger("keyDown",d)),e.mouseState.down.forEach(d=>e.events.trigger("mouseDown",d)),st()}a(Bt,"processInput");function vr(){e.keyState.update(),e.mouseState.update(),e.mergedGamepadState.buttonState.update(),e.mergedGamepadState.stickState.forEach((d,b)=>{e.mergedGamepadState.stickState.set(b,new M(0))}),e.charInputted=[],e.isMouseMoved=!1,e.gamepadStates.forEach(d=>{d.buttonState.update(),d.stickState.forEach((b,D)=>{d.stickState.set(D,new M(0))})})}a(vr,"resetInput");function Zt(d){let b={index:d.index,isPressed:D=>e.gamepadStates.get(d.index).buttonState.pressed.has(D),isDown:D=>e.gamepadStates.get(d.index).buttonState.down.has(D),isReleased:D=>e.gamepadStates.get(d.index).buttonState.released.has(D),getStick:D=>e.gamepadStates.get(d.index).stickState.get(D)};return e.gamepads.push(b),e.gamepadStates.set(d.index,{buttonState:new kr,stickState:new Map([["left",new M(0)],["right",new M(0)]])}),b}a(Zt,"registerGamepad");function fe(d){e.gamepads=e.gamepads.filter(b=>b.index!==d.index),e.gamepadStates.delete(d.index)}a(fe,"removeGamepad");function st(){for(let d of navigator.getGamepads())d&&!e.gamepadStates.has(d.index)&&Zt(d);for(let d of e.gamepads){let b=navigator.getGamepads()[d.index],D=(t.gamepads??{})[b.id]??sn[b.id]??sn.default,ee=e.gamepadStates.get(d.index);for(let ne=0;ne<b.buttons.length;ne++)b.buttons[ne].pressed?(ee.buttonState.down.has(D.buttons[ne])||(e.mergedGamepadState.buttonState.press(D.buttons[ne]),ee.buttonState.press(D.buttons[ne]),e.events.trigger("gamepadButtonPress",D.buttons[ne])),e.events.trigger("gamepadButtonDown",D.buttons[ne])):ee.buttonState.down.has(D.buttons[ne])&&(e.mergedGamepadState.buttonState.release(D.buttons[ne]),ee.buttonState.release(D.buttons[ne]),e.events.trigger("gamepadButtonRelease",D.buttons[ne]));for(let ne in D.sticks){let Re=D.sticks[ne],qe=new M(b.axes[Re.x],b.axes[Re.y]);ee.stickState.set(ne,qe),e.mergedGamepadState.stickState.set(ne,qe),e.events.trigger("gamepadStick",ne,qe)}}}a(st,"processGamepad");let ge={},Ee={},Ae={},nt=t.pixelDensity||window.devicePixelRatio||1;ge.mousemove=d=>{let b=new M(d.offsetX,d.offsetY),D=new M(d.movementX,d.movementY);if(W()){let ee=e.canvas.width/nt,ne=e.canvas.height/nt,Re=window.innerWidth,qe=window.innerHeight,xr=Re/qe,Vr=ee/ne;if(xr>Vr){let _e=qe/ne,je=(Re-ee*_e)/2;b.x=xt(d.offsetX-je,0,ee*_e,0,ee),b.y=xt(d.offsetY,0,ne*_e,0,ne)}else{let _e=Re/ee,je=(qe-ne*_e)/2;b.x=xt(d.offsetX,0,ee*_e,0,ee),b.y=xt(d.offsetY-je,0,ne*_e,0,ne)}}e.events.onOnce("input",()=>{e.isMouseMoved=!0,e.mousePos=b,e.mouseDeltaPos=D,e.events.trigger("mouseMove")})};let gt=["left","middle","right","back","forward"];ge.mousedown=d=>{e.events.onOnce("input",()=>{let b=gt[d.button];b&&(e.mouseState.press(b),e.events.trigger("mousePress",b))})},ge.mouseup=d=>{e.events.onOnce("input",()=>{let b=gt[d.button];b&&(e.mouseState.release(b),e.events.trigger("mouseRelease",b))})};let Or=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),ht={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};ge.keydown=d=>{Or.has(d.key)&&d.preventDefault(),e.events.onOnce("input",()=>{let b=ht[d.key]||d.key.toLowerCase();b.length===1?(e.events.trigger("charInput",b),e.charInputted.push(b)):b==="space"&&(e.events.trigger("charInput"," "),e.charInputted.push(" ")),d.repeat?(e.keyState.pressRepeat(b),e.events.trigger("keyPressRepeat",b)):(e.keyState.press(b),e.events.trigger("keyPressRepeat",b),e.events.trigger("keyPress",b))})},ge.keyup=d=>{e.events.onOnce("input",()=>{let b=ht[d.key]||d.key.toLowerCase();e.keyState.release(b),e.events.trigger("keyRelease",b)})},ge.touchstart=d=>{d.preventDefault(),e.events.onOnce("input",()=>{let b=[...d.changedTouches],D=e.canvas.getBoundingClientRect();t.touchToMouse!==!1&&(e.mousePos=new M(b[0].clientX-D.x,b[0].clientY-D.y),e.mouseState.press("left"),e.events.trigger("mousePress","left")),b.forEach(ee=>{e.events.trigger("touchStart",new M(ee.clientX-D.x,ee.clientY-D.y),ee)})})},ge.touchmove=d=>{d.preventDefault(),e.events.onOnce("input",()=>{let b=[...d.changedTouches],D=e.canvas.getBoundingClientRect();t.touchToMouse!==!1&&(e.mousePos=new M(b[0].clientX-D.x,b[0].clientY-D.y),e.events.trigger("mouseMove")),b.forEach(ee=>{e.events.trigger("touchMove",new M(ee.clientX-D.x,ee.clientY-D.y),ee)})})},ge.touchend=d=>{e.events.onOnce("input",()=>{let b=[...d.changedTouches],D=e.canvas.getBoundingClientRect();t.touchToMouse!==!1&&(e.mousePos=new M(b[0].clientX-D.x,b[0].clientY-D.y),e.mouseState.release("left"),e.events.trigger("mouseRelease","left")),b.forEach(ee=>{e.events.trigger("touchEnd",new M(ee.clientX-D.x,ee.clientY-D.y),ee)})})},ge.touchcancel=d=>{e.events.onOnce("input",()=>{let b=[...d.changedTouches],D=e.canvas.getBoundingClientRect();t.touchToMouse!==!1&&(e.mousePos=new M(b[0].clientX-D.x,b[0].clientY-D.y),e.mouseState.release("left"),e.events.trigger("mouseRelease","left")),b.forEach(ee=>{e.events.trigger("touchEnd",new M(ee.clientX-D.x,ee.clientY-D.y),ee)})})},ge.wheel=d=>{d.preventDefault(),e.events.onOnce("input",()=>{e.events.trigger("scroll",new M(d.deltaX,d.deltaY))})},ge.contextmenu=d=>d.preventDefault(),Ee.visibilitychange=()=>{document.visibilityState==="visible"?(e.skipTime=!0,e.events.trigger("show")):e.events.trigger("hide")},Ae.gamepadconnected=d=>{let b=Zt(d.gamepad);e.events.onOnce("input",()=>{e.events.trigger("gamepadConnect",b)})},Ae.gamepaddisconnected=d=>{let b=Jt().filter(D=>D.index===d.gamepad.index)[0];fe(d.gamepad),e.events.onOnce("input",()=>{e.events.trigger("gamepadDisconnect",b)})};for(let d in ge)e.canvas.addEventListener(d,ge[d]);for(let d in Ee)document.addEventListener(d,Ee[d]);for(let d in Ae)window.addEventListener(d,Ae[d]);let Be=new ResizeObserver(d=>{for(let b of d)if(b.target===e.canvas){if(e.lastWidth===e.canvas.offsetWidth&&e.lastHeight===e.canvas.offsetHeight)return;e.lastWidth=e.canvas.offsetWidth,e.lastHeight=e.canvas.offsetHeight,e.events.onOnce("input",()=>{e.events.trigger("resize")})}});return Be.observe(e.canvas),{dt:n,time:h,run:H,canvas:e.canvas,fps:p,numFrames:f,quit:te,setFullscreen:j,isFullscreen:W,setCursor:B,screenshot:S,getGamepads:Jt,getCursor:F,setCursorLocked:y,isCursorLocked:N,isTouchscreen:U,mousePos:T,mouseDeltaPos:De,isKeyDown:rt,isKeyPressed:tt,isKeyPressedRepeat:Tt,isKeyReleased:Fe,isMouseDown:Le,isMousePressed:_,isMouseReleased:ye,isMouseMoved:Ve,isGamepadButtonPressed:Ue,isGamepadButtonDown:Je,isGamepadButtonReleased:it,getGamepadStick:Ze,charInputted:Ct,onResize:pt,onKeyDown:lt,onKeyPress:jt,onKeyPressRepeat:Qt,onKeyRelease:P,onMouseDown:k,onMousePress:re,onMouseRelease:Y,onMouseMove:se,onCharInput:Q,onTouchStart:ce,onTouchMove:Ne,onTouchEnd:Ce,onScroll:Oe,onHide:Ke,onShow:Pt,onGamepadButtonDown:Wt,onGamepadButtonPress:Xt,onGamepadButtonRelease:Ar,onGamepadStick:Dt,onGamepadConnect:yr,onGamepadDisconnect:Ft,events:e.events}},"default"),Yt,Gt=(Yt=class{ctx;src=null;glTex;width;height;constructor(e,n,h,p={}){this.ctx=e;let f=e.gl;this.glTex=e.gl.createTexture(),e.onDestroy(()=>this.free()),this.width=n,this.height=h;let S={linear:f.LINEAR,nearest:f.NEAREST}[p.filter??e.opts.texFilter]??f.NEAREST,B={repeat:f.REPEAT,clampToEadge:f.CLAMP_TO_EDGE}[p.wrap]??f.CLAMP_TO_EDGE;this.bind(),n&&h&&f.texImage2D(f.TEXTURE_2D,0,f.RGBA,n,h,0,f.RGBA,f.UNSIGNED_BYTE,null),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,S),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,S),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,B),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,B),this.unbind()}static fromImage(e,n,h={}){let p=new Yt(e,n.width,n.height,h);return p.update(n),p.src=n,p}update(e,n=0,h=0){let p=this.ctx.gl;this.bind(),p.texSubImage2D(p.TEXTURE_2D,0,n,h,p.RGBA,p.UNSIGNED_BYTE,e),this.unbind()}bind(){this.ctx.pushTexture2D(this.glTex)}unbind(){this.ctx.popTexture2D()}free(){this.ctx.gl.deleteTexture(this.glTex)}},a(Yt,"Texture"),Yt),dr,Qr=(dr=class{ctx;tex;glFramebuffer;glRenderbuffer;constructor(e,n,h,p={}){this.ctx=e;let f=e.gl;e.onDestroy(()=>this.free()),this.tex=new Gt(e,n,h,p),this.glFramebuffer=f.createFramebuffer(),this.glRenderbuffer=f.createRenderbuffer(),this.bind(),f.renderbufferStorage(f.RENDERBUFFER,f.DEPTH_STENCIL,n,h),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,this.tex.glTex,0),f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.RENDERBUFFER,this.glRenderbuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}toImageData(){let e=this.ctx.gl,n=new Uint8ClampedArray(this.width*this.height*4);this.bind(),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,n),this.unbind();let h=this.width*4,p=new Uint8Array(h);for(let f=0;f<(this.height/2|0);f++){let S=f*h,B=(this.height-f-1)*h;p.set(n.subarray(S,S+h)),n.copyWithin(S,B,B+h),n.set(p,B)}return new ImageData(n,this.width,this.height)}toDataURL(){let e=document.createElement("canvas"),n=e.getContext("2d");return e.width=this.width,e.height=this.height,n.putImageData(this.toImageData(),0,0),e.toDataURL()}draw(e){this.bind(),e(),this.unbind()}bind(){this.ctx.pushFramebuffer(this.glFramebuffer),this.ctx.pushRenderbuffer(this.glRenderbuffer),this.ctx.pushViewport({x:0,y:0,w:this.width,h:this.height})}unbind(){this.ctx.popFramebuffer(),this.ctx.popRenderbuffer(),this.ctx.popViewport()}free(){let e=this.ctx.gl;e.deleteFramebuffer(this.glFramebuffer),e.deleteRenderbuffer(this.glRenderbuffer),this.tex.free()}},a(dr,"FrameBuffer"),dr),fr,Ro=(fr=class{ctx;glProgram;constructor(e,n,h,p){this.ctx=e,e.onDestroy(()=>this.free());let f=e.gl,S=f.createShader(f.VERTEX_SHADER),B=f.createShader(f.FRAGMENT_SHADER);f.shaderSource(S,n),f.shaderSource(B,h),f.compileShader(S),f.compileShader(B);let F=f.createProgram();if(this.glProgram=F,f.attachShader(F,S),f.attachShader(F,B),p.forEach((y,N)=>f.bindAttribLocation(F,N,y)),f.linkProgram(F),!f.getProgramParameter(F,f.LINK_STATUS)){let y=f.getShaderInfoLog(S);if(y)throw new Error("VERTEX SHADER "+y);let N=f.getShaderInfoLog(B);if(N)throw new Error("FRAGMENT SHADER "+N)}f.deleteShader(S),f.deleteShader(B)}bind(){this.ctx.pushProgram(this.glProgram)}unbind(){this.ctx.popProgram()}send(e){let n=this.ctx.gl;for(let h in e){let p=e[h],f=n.getUniformLocation(this.glProgram,h);typeof p=="number"?n.uniform1f(f,p):p instanceof ot?n.uniformMatrix4fv(f,!1,new Float32Array(p.m)):p instanceof pe?n.uniform3f(f,p.r,p.g,p.b):p instanceof M&&n.uniform2f(f,p.x,p.y)}}free(){this.ctx.gl.deleteProgram(this.glProgram)}},a(fr,"Shader"),fr),pr,Mo=(pr=class{ctx;glVBuf;glIBuf;vqueue=[];iqueue=[];stride;maxVertices;maxIndices;vertexFormat;numDraws=0;curPrimitive=null;curTex=null;curShader=null;curUniform={};constructor(e,n,h,p){let f=e.gl;this.vertexFormat=n,this.ctx=e,this.stride=n.reduce((S,B)=>S+B.size,0),this.maxVertices=h,this.maxIndices=p,this.glVBuf=f.createBuffer(),e.pushArrayBuffer(this.glVBuf),f.bufferData(f.ARRAY_BUFFER,h*4,f.DYNAMIC_DRAW),e.popArrayBuffer(),this.glIBuf=f.createBuffer(),e.pushElementArrayBuffer(this.glIBuf),f.bufferData(f.ELEMENT_ARRAY_BUFFER,p*4,f.DYNAMIC_DRAW),e.popElementArrayBuffer()}push(e,n,h,p,f=null,S={}){(e!==this.curPrimitive||f!==this.curTex||p!==this.curShader||!ti(this.curUniform,S)||this.vqueue.length+n.length*this.stride>this.maxVertices||this.iqueue.length+h.length>this.maxIndices)&&this.flush();let B=this.vqueue.length/this.stride;for(let F of n)this.vqueue.push(F);for(let F of h)this.iqueue.push(F+B);this.curPrimitive=e,this.curShader=p,this.curTex=f,this.curUniform=S}flush(){if(!this.curPrimitive||!this.curShader||this.vqueue.length===0||this.iqueue.length===0)return;let e=this.ctx.gl;this.ctx.pushArrayBuffer(this.glVBuf),e.bufferSubData(e.ARRAY_BUFFER,0,new Float32Array(this.vqueue)),this.ctx.pushElementArrayBuffer(this.glIBuf),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.iqueue)),this.ctx.setVertexFormat(this.vertexFormat),this.curShader.bind(),this.curShader.send(this.curUniform),this.curTex?.bind(),e.drawElements(this.curPrimitive,this.iqueue.length,e.UNSIGNED_SHORT,0),this.curTex?.unbind(),this.curShader.unbind(),this.ctx.popArrayBuffer(),this.ctx.popElementArrayBuffer(),this.vqueue=[],this.iqueue=[],this.numDraws++}free(){let e=this.ctx.gl;e.deleteBuffer(this.glVBuf),e.deleteBuffer(this.glIBuf)}},a(pr,"BatchRenderer"),pr);function yt(t){let e=[],n=a(f=>{e.push(f),t(f)},"push"),h=a(()=>{e.pop(),t(p()??null)},"pop"),p=a(()=>e[e.length-1],"cur");return[n,h,p]}a(yt,"genStack");function Yn(t,e={}){let n=[];function h(_){n.push(_)}a(h,"onDestroy");function p(){n.forEach(_=>_()),t.getExtension("WEBGL_lose_context").loseContext()}a(p,"destroy");let f=null;function S(_){if(ti(_,f))return;f=_;let Le=_.reduce((ye,Ve)=>ye+Ve.size,0);_.reduce((ye,Ve,tt)=>(t.vertexAttribPointer(tt,Ve.size,t.FLOAT,!1,Le*4,ye),t.enableVertexAttribArray(tt),ye+Ve.size*4),0)}a(S,"setVertexFormat");let[B,F]=yt(_=>t.bindTexture(t.TEXTURE_2D,_)),[y,N]=yt(_=>t.bindBuffer(t.ARRAY_BUFFER,_)),[E,g]=yt(_=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,_)),[w,j]=yt(_=>t.bindFramebuffer(t.FRAMEBUFFER,_)),[W,te]=yt(_=>t.bindRenderbuffer(t.RENDERBUFFER,_)),[H,U]=yt(({x:_,y:Le,w:ye,h:Ve})=>{t.viewport(_,Le,ye,Ve)}),[T,De]=yt(_=>t.useProgram(_));return H({x:0,y:0,w:t.drawingBufferWidth,h:t.drawingBufferHeight}),{gl:t,opts:e,onDestroy:h,destroy:p,pushTexture2D:B,popTexture2D:F,pushArrayBuffer:y,popArrayBuffer:N,pushElementArrayBuffer:E,popElementArrayBuffer:g,pushFramebuffer:w,popFramebuffer:j,pushRenderbuffer:W,popRenderbuffer:te,pushViewport:H,popViewport:U,pushProgram:T,popProgram:De,setVertexFormat:S}}a(Yn,"initGfx");var qt,$e=(qt=class{loaded=!1;data=null;error=null;onLoadEvents=new et;onErrorEvents=new et;onFinishEvents=new et;constructor(e){e.then(n=>{this.data=n,this.onLoadEvents.trigger(n)}).catch(n=>{if(this.error=n,this.onErrorEvents.numListeners()>0)this.onErrorEvents.trigger(n);else throw n}).finally(()=>{this.onFinishEvents.trigger(),this.loaded=!0})}static loaded(e){let n=new qt(Promise.resolve(e));return n.data=e,n.loaded=!0,n}onLoad(e){return this.loaded&&this.data?e(this.data):this.onLoadEvents.add(e),this}onError(e){return this.loaded&&this.error?e(this.error):this.onErrorEvents.add(e),this}onFinish(e){return this.loaded?e():this.onFinishEvents.add(e),this}then(e){return this.onLoad(e)}catch(e){return this.onError(e)}finally(e){return this.onFinish(e)}},a(qt,"Asset"),qt),gr,er=(gr=class{assets=new Map;lastUID=0;add(e,n){let h=e??this.lastUID+++"",p=new $e(n);return this.assets.set(h,p),p}addLoaded(e,n){let h=e??this.lastUID+++"",p=$e.loaded(n);return this.assets.set(h,p),p}get(e){return this.assets.get(e)}progress(){if(this.assets.size===0)return 1;let e=0;return this.assets.forEach(n=>{n.loaded&&e++}),e/this.assets.size}},a(gr,"AssetBucket"),gr);function si(t){return fetch(t).then(e=>{if(!e.ok)throw new Error(`Failed to fetch "${t}"`);return e})}a(si,"fetchURL");function Br(t){return si(t).then(e=>e.json())}a(Br,"fetchJSON");function qn(t){return si(t).then(e=>e.text())}a(qn,"fetchText");function jn(t){return si(t).then(e=>e.arrayBuffer())}a(jn,"fetchArrayBuffer");function Ir(t){let e=new Image;return e.crossOrigin="anonymous",e.src=t,new Promise((n,h)=>{e.onload=()=>n(e),e.onerror=()=>h(new Error(`Failed to load image from "${t}"`))})}a(Ir,"loadImg");var Wr=2.5949095,nn=1.70158+1,on=2*Math.PI/3,an=2*Math.PI/4.5,ei={linear:t=>t,easeInSine:t=>1-Math.cos(t*Math.PI/2),easeOutSine:t=>Math.sin(t*Math.PI/2),easeInOutSine:t=>-(Math.cos(Math.PI*t)-1)/2,easeInQuad:t=>t*t,easeOutQuad:t=>1-(1-t)*(1-t),easeInOutQuad:t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2,easeInCubic:t=>t*t*t,easeOutCubic:t=>1-Math.pow(1-t,3),easeInOutCubic:t=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2,easeInQuart:t=>t*t*t*t,easeOutQuart:t=>1-Math.pow(1-t,4),easeInOutQuart:t=>t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2,easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>1-Math.pow(1-t,5),easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2,easeInExpo:t=>t===0?0:Math.pow(2,10*t-10),easeOutExpo:t=>t===1?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2,easeInCirc:t=>1-Math.sqrt(1-Math.pow(t,2)),easeOutCirc:t=>Math.sqrt(1-Math.pow(t-1,2)),easeInOutCirc:t=>t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2,easeInBack:t=>nn*t*t*t-1.70158*t*t,easeOutBack:t=>1+nn*Math.pow(t-1,3)+1.70158*Math.pow(t-1,2),easeInOutBack:t=>t<.5?Math.pow(2*t,2)*((Wr+1)*2*t-Wr)/2:(Math.pow(2*t-2,2)*((Wr+1)*(t*2-2)+Wr)+2)/2,easeInElastic:t=>t===0?0:t===1?1:-Math.pow(2,10*t-10)*Math.sin((t*10-10.75)*on),easeOutElastic:t=>t===0?0:t===1?1:Math.pow(2,-10*t)*Math.sin((t*10-.75)*on)+1,easeInOutElastic:t=>t===0?0:t===1?1:t<.5?-(Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*an))/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*an)/2+1,easeInBounce:t=>1-ei.easeOutBounce(1-t),easeOutBounce:t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,easeInOutBounce:t=>t<.5?(1-ei.easeOutBounce(1-2*t))/2:(1+ei.easeOutBounce(2*t-1))/2},Xr=ei,mr,So=(mr=class{textures=[];canvas;c2d;x=0;y=0;curHeight=0;gfx;constructor(e,n,h){this.gfx=e,this.canvas=document.createElement("canvas"),this.canvas.width=n,this.canvas.height=h,this.textures=[Gt.fromImage(e,this.canvas)],this.c2d=this.canvas.getContext("2d")}add(e){if(e.width>this.canvas.width||e.height>this.canvas.height)throw new Error(`Texture size (${e.width} x ${e.height}) exceeds limit (${this.canvas.width} x ${this.canvas.height})`);this.x+e.width>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+e.height>this.canvas.height&&(this.c2d.clearRect(0,0,this.canvas.width,this.canvas.height),this.textures.push(Gt.fromImage(this.gfx,this.canvas)),this.x=0,this.y=0,this.curHeight=0);let n=this.textures[this.textures.length-1],h=new M(this.x,this.y);return this.x+=e.width,e.height>this.curHeight&&(this.curHeight=e.height),e instanceof ImageData?this.c2d.putImageData(e,h.x,h.y):this.c2d.drawImage(e,h.x,h.y),n.update(this.canvas),[n,new Pe(h.x/this.canvas.width,h.y/this.canvas.height,e.width/this.canvas.width,e.height/this.canvas.height)]}free(){for(let e of this.textures)e.free()}},a(mr,"TexPacker"),mr),To="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==",Po=co("SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAASAAAeMwAUFBQUFCIiIiIiIjAwMDAwPj4+Pj4+TExMTExZWVlZWVlnZ2dnZ3V1dXV1dYODg4ODkZGRkZGRn5+fn5+frKysrKy6urq6urrIyMjIyNbW1tbW1uTk5OTk8vLy8vLy//////8AAAAATGF2YzU4LjEzAAAAAAAAAAAAAAAAJAQKAAAAAAAAHjOZTf9/AAAAAAAAAAAAAAAAAAAAAP/7kGQAAANUMEoFPeACNQV40KEYABEY41g5vAAA9RjpZxRwAImU+W8eshaFpAQgALAAYALATx/nYDYCMJ0HITQYYA7AH4c7MoGsnCMU5pnW+OQnBcDrQ9Xx7w37/D+PimYavV8elKUpT5fqx5VjV6vZ38eJR48eRKa9KUp7v396UgPHkQwMAAAAAA//8MAOp39CECAAhlIEEIIECBAgTT1oj///tEQYT0wgEIYxgDC09aIiE7u7u7uIiIz+LtoIQGE/+XAGYLjpTAIOGYYy0ZACgDgSNFxC7YYiINocwERjAEDhIy0mRoGwAE7lOTBsGhj1qrXNCU9GrgwSPr80jj0dIpT9DRUNHKJbRxiWSiifVHuD2b0EbjLkOUzSXztP3uE1JpHzV6NPq+f3P5T0/f/lNH7lWTavQ5Xz1yLVe653///qf93B7f/vMdaKJAAJAMAIwIMAHMpzDkoYwD8CR717zVb8/p54P3MikXGCEWhQOEAOAdP6v8b8oNL/EzdnROC8Zo+z+71O8VVAGIKFEglKbidkoLam0mAFiwo0ZoVExf/7kmQLgAQyZFxvPWAENcVKXeK0ABAk2WFMaSNIzBMptBYfArbkZgpWjEQpcmjxQoG2qREWQcvpzuuIm29THt3ElhDNlrXV///XTGbm7Kbx0ymcRX///x7GVvquf5vk/dPs0Wi5Td1vggDxqbNII4bAPTU3Ix5h9FJTe7zv1LHG/uPsPrvth0ejchVzVT3giirs6sQAACgQAAIAdaXbRAYra/2t0//3HwqLKIlBOJhOg4BzAOkt+MOL6H8nlNvKyi3rOnqP//zf6AATwBAKIcHKixxwjl1TjDVIrvTqdmKQOFQBUBDwZ1EhHlDEGEVyGQWBAHrcJgRSXYbkvHK/8/6rbYjs4Qj0C8mRy2hwRv/82opGT55fROgRoBTjanaiQiMRHUu1/P3V9yGFffaVv78U1/6l/kpo0cz73vuSv/9GeaqDVRA5bWdHRKQKIEAAAAoIktKeEmdQFKN5sguv/ZSC0oxCAR7CzcJgEsd8cA0M/x0tzv15E7//5L5KCqoIAAmBFIKM1UxYtMMFjLKESTE8lhaelUyCBYeA2IN4rK1iDt//+5JkEgAkZzlVq29D8DJDWo0YLLARwPFZrL0PyLsUazTAlpI+hKSx01VSOfbjXg0iW9/jVPDleLJ15QQA4Okdc5ByMDFIeuCCE5CvevwBGH8YibiX9FtaIIgUikF42wrZw6ZJ6WlHrA+Ki5++NNMeYH1lEkwwJAIJB4ugVFguXFc20Vd/FLlvq1GSiSwAFABABABA47k6BFeNvxEQZO9v3L1IE4iEVElfrXmEmlyWIyGslFA55gH/sW7////o9AAFIBIIAAIUMzYTTNkgsAmYObfwQyzplrOmYvq0BKCKNN+nUTbvD7cJzvHxrEWG5QqvP8U1vFx6CwE8NoRc2ADBeEb/HoXh60N7ST8nw9QiiGoYvf/r6GtC9+vLwXHjaSkIp3iupC5+Nii81Zhu85pNYbFvrf+UFThDOYYY26off+W6b//73GTiN9xDfl0AAwBAiMBO8qsDBPOZtuT/dTbjVVbY/KSGH6ppHwKv/6X+s8gUCN/lODzv////GQAGAMQAADlXAUCBJiY0wFQZusYQOaQzaTwDBTcx0IvVp8m7uxKp//uSZBMCBHRI1eNPLHAyxNqWGeoYUIEnWYyxD8DUFSn0l6iojcd+oEOkzV6uWqyHNzjqmv+7V5xGUfY9yEmbziTzjRscm9OqFQp1PKFrqu3PX/7YuGtDU6bt0OUTpv38rdc+37dVDQLKUchaJ853E9edNDGqWwsYz1VoiSStEJtZvw6+sNqFWqaIXJjQCGAAGWAYVwmag/x3BRJw1wYF7IzVqDcNzn85d//FzK7IgwbQwccLoB4AsF8Nj/1ESRUAAVJwAFh0YOFEhmSJEHKQRDyhszgLUpHIgFrb5cySFg5jv10ImlYuvaaGBItfXqnNPmic+XNkmb5fW49vdhq97nQMQyGIlM2v8oQSrxKSxE4F1WqrduqvuJCRof1R7Gsre9KszUVF1/t3PzH2tnp+iSUG3rDwGNcDzxCGA8atuQF0paZAAkAhAQAEAC240yJV+nJgUrqq8axAYtVpYjZyFGb13/17jwiClQDaCdytZpyHHf1R/EG/+lUAgAAAChhmJvioVGGBCFgqdpsGAkUUrbTstwTCJgLQpFIsELW7t/68Iv/7kmQUgAQ9NFO9aeAAPAU6RKwUABClY2e5hoARGpDvPydCAsY8WO10fSvUOnfT98+n/l/6/+hxslhQ1DEOaevNKGocvIYba8WJpaP/15pX0NQ1DUNn/////k6lPp/N61rBi8RJFfERV3IgrqDsJA64sjCoKxDDQ9xEcWDpMBDwVFDIAEIAAzryxsjGi4q/oWpixKjhklAF4pUrDPjFhFVupDFZ/t/t0YPAygUBhADPR/KLCKJ8h2Oxhpxz/zNRAAFl0MAZLAYEAiVbEiz36LSgZ5QoQVat69KNy8FyM5Z80ACHAzgnISEkxUSJIDyBSwi5KF4mjBl4xJdbrG9ComLrL8YATiodhQKCkj6ROdyg1y5XmZlvMVmpJzYppJDwLi/Lp9vT3TfmimOGpuezi2U/9FNav0zX9Oja2r//8+hvuihuQAAMAVmqFgAgCcuboAEAAAUcqy8ca0BHBmwbFkED0CNA1YYDPkhcQrRJxcY3BzfxxltAz9vX62Xl3plAzWmRO+FkZyH///1qAAEjQBAACUpgU5o2AIBmFBGMamrGg0b/+5JkC4ADxyLWb2ngAEEkGofsoACP7U1JLaxTkOqFaKhspGgnW3SGC56ZgUJGCRnLOmIJAkuNBgvwU4Ocf8CJK9UsafH9/Frj///365XSoME+DZMw5UNjrMbVoeIj9EL91IuQ5KHyl5V2LCpdIdESgafOHxVGkAlkHuakmix/gN8+BP/sKguLAAoAtUjtvaoeEADwr3OK11E4KBlojgeQNQBJ4MvCAd/4t/xMMzeLhQGQ1//6tQu5BaBOGCT6U4aafvXZ//4iAPAAAAbLkgIlQmMSLA2H1CVNAlWwyVvKIQIxOSK1NWxs4MBUATlKrAkIMPAjCAdS6MVFzuURWa/+/qQWEGsA6EEpiBEJb9Q21lAHoBoD0B6aAPhyt+bG3muoXIN3RLadXxUfr/ohjGFF/p97eqNI5noKAqYLNPpUTDSI9/TmA6B+YAAADgA0Y4lxTW1SQfOQuDDDI0KTTuIrF5qoJrUFhUFAsg+AT2hbkaRZYGIjBKVDIa5VgNN/9P/rCDsBJbYJRKpCA1ArAkigIeYY61AjE+jubyiZFZ3+L789//uSZBCABHVj2entNmw1JXokLycYEFTFVa0wz4DYjKs08J2Q+r4n3lgbWaaMwMLEjFW88F39brqPF83cv1mCSJeY3Q2uiQxhBJxCBeR1D2LQRsYQcZUTzdNll8+OwZBsIwSgl45ymaHX603Mz7JmZuvt71GDTN66zev/+cLn/b5imV8pAHkg61FIJchBSG+zycgAZgADD6F1iQQRXRWmWS6bDIIgyBCZEcdl/KgXGmVKFv/vl8ry/5bLypf//U5jhYDhL9X/pAA0AKBIAAKgGtGXGGWJgEoF2JNsHlKfSKLRhGBAgIuWZKIJCFpF1VBhkB+EfzEyMUJdWuMrEZoPZ5BfF3/Nu62riIdjoO4AAKD2sTrDmpZZaYysf/810TitAVvn9xtFucieiaEy54YqiIO6RqkGAm5wVO0bFB0sDTdNxYGekKktR4KAAfAwUIgI8Ci6aXgtwbhPWAC+CKExAFydNtYGXNZoQjUsXv/9vKjgmdwieb+h7kHvPoc//0FaCACAATKFC4Y9ammklidbaiJNPBhGWTNhFSgdtalK12lpl//7kmQRAFN2NFI7TBvwNKNaTRsFGBWdfV2tPNcYvBHpgPKJsc8IUcTCxY3HSvUVNTWe/Z3YWlrJ0yrNRUiT19aprA7E+mPP+ZmC3/CsheOJXhc/9VJb3UZnphUBcqZUZQth1i3XqtPYu2Sy1s8DV9ZYACAAASAAHgFkQcOqgB5utFHFh3kSi4USs0yk4iOClREmjvdG+upaiLcRA6/9QGbOfxF/8sEAQAVG0G07YFMihKR4EXJCkRdX9isueLqUMRAQdhDZmv3KeR0nPqRVrZmSIXDt+BBSR7qqbKQcB98W9qiMb55preHIStxFWPE4lAyI+BKz2iSxonpvMR5DgKxTH6vGGXAbYCaAnJUW4W07EesQqbfqdbo4qNnPxSpn1H8eahszc/y9//dn1V7D/OYpn1szQKAPXTMlO/rO//u7JriJXbld7aP33v6RXYg/COIDzTWkTspg6Ay1YaDSwKxrP/LfIikHjmO871POf/kEAseAgoPEi9/0ZziNwfxVKy9qAEGEEAAq1EcOamDEGHAA0iao8k31rz2MiLNEik6VQ37/+5JkEAgEYU5WU0M3MDjDe0o9IjiOzSVM7aCzEM2GqXD8pFB0zxMcHCQNHtZD+R+pMWZxOJ/otEZTvVN/MeU12xTVcL+f2YaiNJTVoPd6SvzEnKel5GXOzEaazgdChnP2jOAwpfyRpVlQwoJBwpN1L1DL////6TVWcoepf7CVWrpEWiym5lR5U0BSMlxQC4qByOyQIAEuJfIriWixDqRgMfVZWuvRowjR9BzP5lZlT/+YG50CsSBG////////liXDQVMxEaBkbzKAAACnDIAstY7iK7gGSF7SIDexaTtPOHABk9YcmJEACmo50pgWal22etroBpYoVqtU6OPqvlf0c4QCAfLk9P/FJs4KCQMf6ECZyA6BwqqyJ0rMYj56k1/UlTIx1V3Rt5NF71D4qlptDC8VMgQVHFDlQnDFi06qQgKQAAIK4TxxJGFGYJuZNGXRdpq7IW/DYpPIQRFJLAc+qn1E0XYdOkQVJT+z8Lvff//8vbKAWTIBBUUdM6cOhlDry7x4dAkJXIBhbO3HSMMMGBQ9K9/JNfu09PjTO64wYEcR//uSZBeABP5g11NPRVwzQ4r8PMJVj7j9UU2wUwDPjeq0Z5w675D9+uDdL2QsuIry2lZtwn/pJYyRRjANEOQxNWw8mU7Tq+vueV7JrX/Pg7VIkEuZT5dwd85MVoq5lpStNICkBAcFR88//58KO8Zjt2PIGxWl1cVfXeNGH18SReNT//hYliWtQuNluxyxONbm4U+lpkAgpyE7yAIYUjIaqHmARJ0GQTtmH60xdwFp/u253XBCxD0f/lBcguCALn//Y5nqEv//1h4BAAwgAA5gcHmpIplgeW9fAOM6RFZUywrsGAiRmKkanQnCFBjYoPDS7bjwtPTkVI8D/P8VVLcTUz65n7PW2s3tNYHgEul4tBaIz0A9RgJAyAMI4/i0fpQKjhX9S+qIa0vmc4CZit/0/3UTDGeKNpkk0nu2rUE2ag8WErhE/kgAiQCJKQEYBA5Wn6CxHoIUh6dQ46nLIuwFk4S/LaDQxXu7Yf/pf//lwJB0S/Ff/4C///EiBEiAAAIAMnpngiIABAdMpKigkXaUwhLEGvpiofmXW57h2XAZO3CMRv/7kmQUAEOHQlHraRTQMkQp6GWFZBTVU1lNPTPYyIyocYeUoNgLBWAs1jPkTv/tXBaeZ/tbD/nAGP8/xT0SNEi5zof0KIVEzVe9r5lZOol7kyaXMYS4J/ZS3djp//UaeVyR0mUMlTgfz8XqMzIEgAQQ6UNQ1DSE0/C16OvyaocF4ijAGFci0FSYqCUSaWs6t9F6/699DKvMgMoK1//kSbvxtyBN27I7mdXgNMAW75sRU1UwUHYG5axI2tFIFpkgx7nnK+1JmRKjqeAd5Ph0QAL4QAnirmiPlg0yBDlrb/d3ngtA65rb999+8vdDCfnJuJAYIl285zklpVbrKpk1PEzrOY9NZUgyz6OiOsKt5qG/g2ibxSZ+/eTI/NB8n4ev//n2nIw85GAdwuJL7kYnnAbpcf1RBKH6b2U4RWP8dmWH5snsAFYwADBgAopKdzFJq4Jlmotloh/m4QpTSvJRE3nYZHephoqBhVf+P7vQ9BPlwZCP+3//+hdy5uUwS3LDEgQx4cdIgvDEBR1YqymCsSbKzRy2aQmSv+AAcAgAkvzPfuX/+5JkFQAj6VFX00Zr5DllOhhgpn4MmSs+zSRRiO8U5tWklYgSLKfs+Xheb/+6WaAQCKTztNeJ382MUltZNnjSJoFrCqB6C4mFcwJpJD4Oc8dLDXMTh9k1/rmTopfzqv9AvHWfOuZJlEvHSVMjyjpkVucKSzxJVQBgAAIo8DGqRdYCXPckFYg+dH9A/qUyljrtpxH9RJX/Z3Vv6uFkPg4M2jf3CL09QrwOrMt69n//8UFEAAMHWdhg1CcjyVBwiArOYlDL5NPY6x8ZLFBCGi6SVTKX5nqdSEFjebnv2zHdt0dj6xvORsSFzwqRNTJSZIrrlpXcURNL9WW7krBgr5jPMaGcvJ5v0N1s19CV7+7fvQfjySX2QECWUgKgeJCIif4WRBZ/6archpDkzE7oWctK3zEHP9Smeai8oeHkM6AK7pGjtOgeFv40ugqNd+Iv///uAZAMgAAAUeSWhLPpdwk3iXpBw43hOVIp1gliUOSaeZcZeZhLAH9TtD56wUpBduzLF5v5qViTH6o+I0+8Z1asaLgKVAohlpB72DgAQBQxEd3g//uSZCiAA6k0UdMPQfA+xcnBYON8E3WDVU0w1ZjPDSmo8IniHAFDNnkXF3B94gicH5d8MFw+IHZwufxOf/8gsHw+XrD4Jn8T4RAyQiABNBQg/3giEWuZ42mVFB3kkXNjhqBg1CghEUbN3/7/KBhyqNueef/MIDBClP3YRnKLiIlEFzf//0g+4zKpRIKTpqQgUtnHGFw6RSLN421iGcYapqFxny/capK9r9v+2BSy/RU1yZxa2eGaWK07ijfcxeiO3iuHJvjbXzts+Ny+XyFnsne1h0qG4mAaN6xRGaLVxKPlrri0Bg9oXGyxcw8JRBPkUzC8v451vVd9liSX85JMrmkVNwxOCwUg298////7ks//L409/hwMRIozKiIckXtjzDaAMTBcAACAwLGargPSEgEJZN/EFjfF/VKgaMYKMbwtf/T0UCGGfjfOAZ2frCigYdwh/+sGlQBxhCAAAUHkDPqOdmmUdAVYl3IhrEfR8qZFjLYEPOyzVGvm6lNUJCk2PNazwFxaijk+ZEaiTehoJGuDh6zN/EVP8BCLD/88BoY7Xv/7kmQlgBNmMtNTL0FwOGZJ/WHiKAyhJU+soE3A3JnmAa2oaCIru/+RrEHMTphxQ0X/LzoVy4gKhYl6ZUlklW7CLRVoYmgABwCRMAAMA/poCiEEYLsBVodWcVZ18+CcAfH165U4Xgh7/X1/BAQF6GN/BwQ/+D9S9P6wII//CoANYFYCBAKlGQDKhVjjylKARw2mPAtp8JjcQHggQswVsOEKsF6AIBWvmpIFdSZvRVv/LHWEy0+txMxu+VK9gEqG5pWf6GNGU4UBVkfd+bsj/6lZE0fkOpAqAOvyUO9oo+IiEtcLKOGzhhSGa4MYINHWoQsFr8zzmow0tRILkqz5/+vFxl/oZX/+qGW//xiLjR3xcGn//0QLkTQJh1UA8MAQAEXC/YxODKTDUEhrASs1512GRp+dRFFdTWIRaOXrve1eNjTNpreqQYrC9NBlQc1f8YO2po8bnH6qffuRvU7taiNF3baokE0YpmjRCHRclWBb9NCHKHpERwHRG3pqgXklq4sBpLjGvmekg8Y7SjM1FZopIM8IhB6dtMr8aKsdovh4FW//+5JkQ4CjTDdSU0gtIDiE+YBrKgwNbSVJTCBPwN8N5ZW8NKDnhRB8AXCm//KAsBUCwKU//oJQnET+UP3/zpYRocAAABJkVzzIuoLGEaDoxfsNva12EUdxhJMGFQioSg8GxKsLm8kWEmExJuNidarkk+OTXc0i2OZEq2v+tZr/MDZRS0I7LfRpHdlsiF6m/mEjk+XlK10UqtKYUwNgMx24hUtCJLfpM3ExUeKDYjClgZAzAjQ0qlNQBTsGpk9zSRkCiKkRGp572VXsPYChGvxhAuYkDYZK//jSRgto2mTf6+PJqgAAgIAAAACYZE6aZOHhYkYlcbpeYQq1RgLO4U8TIlL1sGw+iKZi5Kzc/bKT0yXrIUMES89RCWy8oWlxqIQlKANLFpT/KjUrK+UCYbZqGnjVj29aO5dzofWAskRX5eJWPi4kf/aRVjy3Wlyg2AnMYIDSTLwZUTASIzflPWUwwlUnIFMnGiyABeaXJcN91PmQJCLzmvUJkFOHCrX/+6O///IHnT4tT9YYBoNMQ09GfKIErwdwChNz1Qy5+5S/wWeY//uSZF+C03UyT2tMO0A3RRkhY20KzQjDMszhA8DjlGOBp5y4ZCS3ica52GIGiryv7FAaSDVZSXKFTiir+GvGiuK4rjgwPVTddso+W/42a4ueJJHDYtfj6YoKknnjzRgKA0fBIRZOSsprJqnoNN73ps/Z9DVgbKNbMGmRzrYBMAZCPUANkAZQ0syAC2ubK1NF90+WoesBpnhY8qwVDkNb/5Uof6//418TgElCSgAIgyAAQBHEmiaQFPIRmfAMELffpo0IflyEuAAQnSnKvwTlVlnIgOAAGS3P3IydjXPSh/CaVRqpSNCjQqDvPM+fLcuN+WgqNix6CoHomUWTT86JjziRSZ3yjnq+dIldKPU11KUuf6wAASMAAJxE+MlyktgE9UGSxjEx6RR0v1s9bWZ+EJSrGtjqUIhklG3J8eLRn/2U/nv7f///+7/6gBQgEAMUijVMwweWWMyYM/PLXuc7DptIQmBARMRCxXjEIcTNDQgSSeHpUNXO7dRSOllJPvnY7yzaO1hmUjsKvHe99fOxrabMX7mGTi5tsNkZVZLndzxse//7kmR7ABM2O0pbKTvQN4NI+WGFPA2ZESs1pYAAvA0jVrJwAHfbr/c6//vW790dzX36QNBRlDv/6QQAU3V64yUgBEAYc/lI8e5bm+Z9+j+4aaj4tFrb//iker/4a12b/V//q//9v+7vAEAAAAMqZTGd5gL4f54o6ZebKNrR/zWVYUEVYVVv8BuAV2OUT+DUQgkJ8J1Ey4ZbFCiAwgwzMSdHV4jQR+OoPWEASaPkyYq+PsQFFJCsEEJtOiUjI/+GRhtC2DnizTMXATJig9Ey/kAJMrkHGYJ8gpLjmJOYoskpav+ShRJInyGGZVJMihDi6pIxRZJJel/8iZPkYiREnyKE0akTL5QNSqT5iiySS9Ja2SV//5ME0ak//+4KgAAABgQBAADAMDgYCAEgCteQ0fZH6+ICXA357+MPfhR/+ywRf/U///LVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5JknQAFoWhGLm5gBClBmT3GiAAAAAGkHAAAIAAANIOAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"),Do="data:image/png;base64,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",Fo="data:image/png;base64,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",Co="3000.1.17",ln=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",Jr="topleft",hn=64,Bo="monospace",Zr="monospace",Io=36,$r=64,_r=256,un=2048,cn=2048,dn=2048,fn=2048,pn=.1,Lo=64,Si="linear",Uo=8,No=4,Li=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],Oo=Li.reduce((t,e)=>t+e.size,0),Qn=2048,Go=Qn*4*Oo,Ho=Qn*6,zo=`
attribute vec2 a_pos;
attribute vec2 a_uv;
attribute vec4 a_color;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

vec4 def_vert() {
	return vec4(a_pos, 0.0, 1.0);
}

{{user}}

void main() {
	vec4 pos = vert(a_pos, a_uv, a_color);
	v_pos = a_pos;
	v_uv = a_uv;
	v_color = a_color;
	gl_Position = pos;
}
`,Ko=`
precision mediump float;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

uniform sampler2D u_tex;

vec4 def_frag() {
	return v_color * texture2D(u_tex, v_uv);
}

{{user}}

void main() {
	gl_FragColor = frag(v_pos, v_uv, v_color, u_tex);
	if (gl_FragColor.a == 0.0) {
		discard;
	}
}
`,Ti=`
vec4 vert(vec2 pos, vec2 uv, vec4 color) {
	return def_vert();
}
`,Pi=`
vec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {
	return def_frag();
}
`,Yo=new Set(["id","require"]),qo=new Set(["add","update","draw","destroy","inspect","drawInspect"]);function Nt(t){switch(t){case"topleft":return new M(-1,-1);case"top":return new M(0,-1);case"topright":return new M(1,-1);case"left":return new M(-1,0);case"center":return new M(0,0);case"right":return new M(1,0);case"botleft":return new M(-1,1);case"bot":return new M(0,1);case"botright":return new M(1,1);default:return t}}a(Nt,"anchorPt");function Wn(t){switch(t){case"left":return 0;case"center":return .5;case"right":return 1;default:return 0}}a(Wn,"alignPt");function Xn(t){return t.createBuffer(1,1,44100)}a(Xn,"createEmptyAudioBuffer");var jo=a((t={})=>{let e=t.root??document.body;e===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let n=t.canvas??(()=>{let r=document.createElement("canvas");return e.appendChild(r),r})(),h=t.scale??1,p=t.width&&t.height&&!t.stretch&&!t.letterbox;p?(n.width=t.width*h,n.height=t.height*h):(n.width=n.parentElement.offsetWidth,n.height=n.parentElement.offsetHeight);let f=["outline: none","cursor: default"];if(p){let r=n.width,i=n.height;f.push(`width: ${r}px`),f.push(`height: ${i}px`)}else f.push("width: 100%"),f.push("height: 100%");t.crisp&&(f.push("image-rendering: pixelated"),f.push("image-rendering: crisp-edges")),n.style.cssText=f.join(";");let S=t.pixelDensity||window.devicePixelRatio;n.width*=S,n.height*=S,n.tabIndex=0;let B=document.createElement("canvas");B.width=_r,B.height=_r;let F=B.getContext("2d",{willReadFrequently:!0}),y=bo({canvas:n,touchToMouse:t.touchToMouse,gamepads:t.gamepads,pixelDensity:t.pixelDensity,maxFPS:t.maxFPS}),N=[],E=y.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0}),g=Yn(E,{texFilter:t.texFilter}),w=(()=>{let r=Dt(Ti,Pi),i=Gt.fromImage(g,new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),s=t.width&&t.height?new Qr(g,t.width*S*h,t.height*S*h):new Qr(g,E.drawingBufferWidth,E.drawingBufferHeight),o=null,l=1;t.background&&(o=ue(t.background),l=Array.isArray(t.background)?t.background[3]:1,E.clearColor(o.r/255,o.g/255,o.b/255,l??1)),E.enable(E.BLEND),E.blendFuncSeparate(E.SRC_ALPHA,E.ONE_MINUS_SRC_ALPHA,E.ONE,E.ONE_MINUS_SRC_ALPHA);let u=new Mo(g,Li,Go,Ho),m=Gt.fromImage(g,new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"});return{lastDrawCalls:0,defShader:r,defTex:i,frameBuffer:s,postShader:null,postShaderUniform:null,renderer:u,transform:new ot,transformStack:[],bgTex:m,bgColor:o,bgAlpha:l,width:t.width??E.drawingBufferWidth/S/h,height:t.height??E.drawingBufferHeight/S/h,viewport:{x:0,y:0,width:E.drawingBufferWidth,height:E.drawingBufferHeight},fixed:!1}})();const Lt=class Lt{tex;frames=[new Pe(0,0,1,1)];anims={};slice9=null;constructor(i,s,o={},l=null){this.tex=i,s&&(this.frames=s),this.anims=o,this.slice9=l}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(i,s={}){return typeof i=="string"?Lt.fromURL(i,s):Promise.resolve(Lt.fromImage(i,s))}static fromImage(i,s={}){let[o,l]=H.packer.add(i),u=s.frames?s.frames.map(m=>new Pe(l.x+m.x*l.w,l.y+m.y*l.h,m.w*l.w,m.h*l.h)):rt(s.sliceX||1,s.sliceY||1,l.x,l.y,l.w,l.h);return new Lt(o,u,s.anims,s.slice9)}static fromURL(i,s={}){return Ir(i).then(o=>Lt.fromImage(o,s))}};a(Lt,"SpriteData");let j=Lt;const kt=class kt{buf;constructor(i){this.buf=i}static fromArrayBuffer(i){return new Promise((s,o)=>te.ctx.decodeAudioData(i,s,o)).then(s=>new kt(s))}static fromURL(i){return rn(i)?kt.fromArrayBuffer(Fn(i)):jn(i).then(s=>kt.fromArrayBuffer(s))}};a(kt,"SoundData");let W=kt,te=(()=>{let r=new(window.AudioContext||window.webkitAudioContext),i=r.createGain();i.connect(r.destination);let s=new W(Xn(r));return r.decodeAudioData(Po.buffer.slice(0)).then(o=>{s.buf=o}).catch(o=>{console.error("Failed to load burp: ",o)}),{ctx:r,masterNode:i,burpSnd:s}})(),H={urlPrefix:"",sprites:new er,fonts:new er,bitmapFonts:new er,sounds:new er,shaders:new er,custom:new er,packer:new So(g,dn,fn),loaded:!1};function U(r){return typeof r!="string"||rn(r)?r:H.urlPrefix+r}a(U,"fixURL");let T={events:new Cr,objEvents:new Cr,root:Gr([]),gravity:0,scenes:{},logs:[],cam:{pos:null,scale:new M(1),angle:0,shake:0,transform:new ot}};T.root.use(Kr());function De(r){return H.custom.add(null,r)}a(De,"load");function _(){let r=[H.sprites,H.sounds,H.shaders,H.fonts,H.bitmapFonts,H.custom];return r.reduce((i,s)=>i+s.progress(),0)/r.length}a(_,"loadProgress");function Le(r){return r!==void 0&&(H.urlPrefix=r),H.urlPrefix}a(Le,"loadRoot");function ye(r,i){return H.custom.add(r,Br(i))}a(ye,"loadJSON");const Ei=class Ei{fontface;filter=Si;outline=null;size=$r;constructor(i,s={}){if(this.fontface=i,this.filter=s.filter??Si,this.size=s.size??$r,this.size>_r)throw new Error(`Max font size: ${_r}`);s.outline&&(this.outline={width:1,color:ue(0,0,0)},typeof s.outline=="number"?this.outline.width=s.outline:typeof s.outline=="object"&&(s.outline.width&&(this.outline.width=s.outline.width),s.outline.color&&(this.outline.color=s.outline.color)))}};a(Ei,"FontData");let Ve=Ei;function tt(r,i,s={}){let o=new FontFace(r,typeof i=="string"?`url(${i})`:i);return document.fonts.add(o),H.fonts.add(r,o.load().catch(l=>{throw new Error(`Failed to load font from "${i}": ${l}`)}).then(l=>new Ve(l,s)))}a(tt,"loadFont");function Tt(r,i,s,o,l={}){return H.bitmapFonts.add(r,Ir(i).then(u=>yr(Gt.fromImage(g,u,l),s,o,l.chars??ln)))}a(Tt,"loadBitmapFont");function rt(r=1,i=1,s=0,o=0,l=1,u=1){let m=[],x=l/r,A=u/i;for(let c=0;c<i;c++)for(let v=0;v<r;v++)m.push(new Pe(s+v*x,o+c*A,x,A));return m}a(rt,"slice");function Fe(r,i){return r=U(r),De(typeof i=="string"?new Promise((s,o)=>{Br(i).then(l=>{Fe(r,l).then(s).catch(o)})}):j.from(r).then(s=>{let o={};for(let l in i){let u=i[l],m=s.frames[0],x=dn*m.w,A=fn*m.h,c=u.frames?u.frames.map(I=>new Pe(m.x+(u.x+I.x)/x*m.w,m.y+(u.y+I.y)/A*m.h,I.w/x*m.w,I.h/A*m.h)):rt(u.sliceX||1,u.sliceY||1,m.x+u.x/x*m.w,m.y+u.y/A*m.h,u.width/x*m.w,u.height/A*m.h),v=new j(s.tex,c,u.anims);H.sprites.addLoaded(l,v),o[l]=v}return o}))}a(Fe,"loadSpriteAtlas");function Ue(r,i={}){let s=document.createElement("canvas"),o=r[0].width,l=r[0].height;s.width=o*r.length,s.height=l;let u=s.getContext("2d");r.forEach((x,A)=>{x instanceof ImageData?u.putImageData(x,A*o,0):u.drawImage(x,A*o,0)});let m=u.getImageData(0,0,r.length*o,l);return j.fromImage(m,{...i,sliceX:r.length,sliceY:1})}a(Ue,"createSpriteSheet");function Je(r,i,s={sliceX:1,sliceY:1,anims:{}}){return i=U(i),Array.isArray(i)?i.some(o=>typeof o=="string")?H.sprites.add(r,Promise.all(i.map(o=>typeof o=="string"?Ir(o):Promise.resolve(o))).then(o=>Ue(o,s))):H.sprites.addLoaded(r,Ue(i,s)):typeof i=="string"?H.sprites.add(r,j.from(i,s)):H.sprites.addLoaded(r,j.fromImage(i,s))}a(Je,"loadSprite");function it(r,i){return i=U(i),H.sprites.add(r,new Promise(async s=>{let o=typeof i=="string"?await Br(i):i,l=await Promise.all(o.frames.map(Ir)),u=document.createElement("canvas");u.width=o.width,u.height=o.height*o.frames.length;let m=u.getContext("2d");l.forEach((A,c)=>{m.drawImage(A,0,c*o.height)});let x=await Je(null,u,{sliceY:o.frames.length,anims:o.anims});s(x)}))}a(it,"loadPedit");function pt(r,i,s){i=U(i),s=U(s),typeof i=="string"&&!s&&(s=wo(i)+".json");let o=typeof s=="string"?Br(s):Promise.resolve(s);return H.sprites.add(r,o.then(l=>{let u=l.meta.size,m=l.frames.map(A=>new Pe(A.frame.x/u.w,A.frame.y/u.h,A.frame.w/u.w,A.frame.h/u.h)),x={};for(let A of l.meta.frameTags)A.from===A.to?x[A.name]=A.from:x[A.name]={from:A.from,to:A.to,speed:10,loop:!0,pingpong:A.direction==="pingpong"};return j.from(i,{frames:m,anims:x})}))}a(pt,"loadAseprite");function lt(r,i,s){return H.shaders.addLoaded(r,Dt(i,s))}a(lt,"loadShader");function jt(r,i,s){i=U(i),s=U(s);let o=a(u=>u?qn(u):Promise.resolve(null),"resolveUrl"),l=Promise.all([o(i),o(s)]).then(([u,m])=>Dt(u,m));return H.shaders.add(r,l)}a(jt,"loadShaderURL");function Qt(r,i){return i=U(i),H.sounds.add(r,typeof i=="string"?W.fromURL(i):W.fromArrayBuffer(i))}a(Qt,"loadSound");function P(r="bean"){return Je(r,To)}a(P,"loadBean");function k(r){return H.sprites.get(r)}a(k,"getSprite");function re(r){return H.sounds.get(r)}a(re,"getSound");function Y(r){return H.fonts.get(r)}a(Y,"getFont");function se(r){return H.bitmapFonts.get(r)}a(se,"getBitmapFont");function Q(r){return H.shaders.get(r)}a(Q,"getShader");function ce(r){return H.custom.get(r)}a(ce,"getAsset");function Ne(r){if(typeof r=="string"){let i=k(r);if(i)return i;if(_()<1)return null;throw new Error(`Sprite not found: ${r}`)}else{if(r instanceof j)return $e.loaded(r);if(r instanceof $e)return r;throw new Error(`Invalid sprite: ${r}`)}}a(Ne,"resolveSprite");function Ce(r){if(typeof r=="string"){let i=re(r);if(i)return i;if(_()<1)return null;throw new Error(`Sound not found: ${r}`)}else{if(r instanceof W)return $e.loaded(r);if(r instanceof $e)return r;throw new Error(`Invalid sound: ${r}`)}}a(Ce,"resolveSound");function Oe(r){if(!r)return w.defShader;if(typeof r=="string"){let i=Q(r);if(i)return i.data??i;if(_()<1)return null;throw new Error(`Shader not found: ${r}`)}else if(r instanceof $e)return r.data?r.data:r;return r}a(Oe,"resolveShader");function Ke(r){if(!r)return Ke(t.font??Bo);if(typeof r=="string"){let i=se(r),s=Y(r);if(i)return i.data??i;if(s)return s.data??s;if(document.fonts.check(`${$r}px ${r}`))return r;if(_()<1)return null;throw new Error(`Font not found: ${r}`)}else if(r instanceof $e)return r.data?r.data:r;return r}a(Ke,"resolveFont");function Pt(r){return r!==void 0&&(te.masterNode.gain.value=r),te.masterNode.gain.value}a(Pt,"volume");function Wt(r,i={}){let s=te.ctx,o=i.paused??!1,l=s.createBufferSource(),u=new et,m=s.createGain(),x=i.seek??0,A=0,c=0,v=!1;l.loop=!!i.loop,l.detune.value=i.detune??0,l.playbackRate.value=i.speed??1,l.connect(m),l.onended=()=>{J()>=l.buffer?.duration&&u.trigger()},m.connect(te.masterNode),m.gain.value=i.volume??1;let I=a(K=>{l.buffer=K.buf,o||(A=s.currentTime,l.start(0,x),v=!0)},"start"),O=Ce(r);O instanceof $e&&O.onLoad(I);let J=a(()=>{if(!l.buffer)return 0;let K=o?c-A:s.currentTime-A,X=l.buffer.duration;return l.loop?K%X:Math.min(K,X)},"getTime"),Z=a(K=>{let X=s.createBufferSource();return X.buffer=K.buffer,X.loop=K.loop,X.playbackRate.value=K.playbackRate.value,X.detune.value=K.detune.value,X.onended=K.onended,X.connect(m),X},"cloneNode");return{stop(){this.paused=!0,this.seek(0)},set paused(K){if(o!==K)if(o=K,K)v&&(l.stop(),v=!1),c=s.currentTime;else{l=Z(l);let X=c-A;l.start(0,X),v=!0,A=s.currentTime-X,c=0}},get paused(){return o},play(K=0){this.seek(K),this.paused=!1},seek(K){l.buffer?.duration&&(K>l.buffer.duration||(o?(l=Z(l),A=c-K):(l.stop(),l=Z(l),A=s.currentTime-K,l.start(0,K),v=!0,c=0)))},set speed(K){l.playbackRate.value=K},get speed(){return l.playbackRate.value},set detune(K){l.detune.value=K},get detune(){return l.detune.value},set volume(K){m.gain.value=Math.max(K,0)},get volume(){return m.gain.value},set loop(K){l.loop=K},get loop(){return l.loop},duration(){return l.buffer?.duration??0},time(){return J()%this.duration()},onEnd(K){return u.add(K)},then(K){return this.onEnd(K)}}}a(Wt,"play");function Xt(r){return Wt(te.burpSnd,r)}a(Xt,"burp");function Ar(r,i){return new Qr(g,r,i)}a(Ar,"makeCanvas");function Dt(r=Ti,i=Pi){let s=zo.replace("{{user}}",r??Ti),o=Ko.replace("{{user}}",i??Pi);try{return new Ro(g,s,o,Li.map(l=>l.name))}catch(l){let u=/(?<type>^\w+) SHADER ERROR: 0:(?<line>\d+): (?<msg>.+)/,m=yo(l).match(u),x=Number(m.groups.line)-14,A=m.groups.msg.trim(),c=m.groups.type.toLowerCase();throw new Error(`${c} shader line ${x}: ${A}`)}}a(Dt,"makeShader");function yr(r,i,s,o){let l=r.width/i,u={},m=o.split("").entries();for(let[x,A]of m)u[A]=new Pe(x%l*i,Math.floor(x/l)*s,i,s);return{tex:r,map:u,size:s}}a(yr,"makeFont");function Ft(r,i,s,o=w.defTex,l=w.defShader,u={}){let m=Oe(l);if(!m||m instanceof $e)return;let x=w.fixed||s?w.transform:T.cam.transform.mult(w.transform),A=[];for(let c of r){let v=vr(x.multVec2(c.pos));A.push(v.x,v.y,c.uv.x,c.uv.y,c.color.r/255,c.color.g/255,c.color.b/255,c.opacity)}w.renderer.push(E.TRIANGLES,A,i,m,o,u)}a(Ft,"drawRaw");function Ze(){w.renderer.flush()}a(Ze,"flush");function Ct(){E.clear(E.COLOR_BUFFER_BIT),w.frameBuffer.bind(),E.clear(E.COLOR_BUFFER_BIT),w.bgColor||je(()=>{nt({width:Ie(),height:Ge(),quad:new Pe(0,0,Ie()/hn,Ge()/hn),tex:w.bgTex,fixed:!0})}),w.renderer.numDraws=0,w.fixed=!1,w.transformStack.length=0,w.transform=new ot}a(Ct,"frameStart");function Jt(r,i){w.postShader=r,w.postShaderUniform=i??null}a(Jt,"usePostEffect");function Bt(){Ze(),w.lastDrawCalls=w.renderer.numDraws,w.frameBuffer.unbind(),E.viewport(0,0,E.drawingBufferWidth,E.drawingBufferHeight);let r=w.width,i=w.height;w.width=E.drawingBufferWidth/S,w.height=E.drawingBufferHeight/S,gt({flipY:!0,tex:w.frameBuffer.tex,pos:new M(w.viewport.x,w.viewport.y),width:w.viewport.width,height:w.viewport.height,shader:w.postShader,uniform:typeof w.postShaderUniform=="function"?w.postShaderUniform():w.postShaderUniform,fixed:!0}),Ze(),w.width=r,w.height=i}a(Bt,"frameEnd");function vr(r){return new M(r.x/Ie()*2-1,-r.y/Ge()*2+1)}a(vr,"screen2ndc");function Zt(r){w.transform=r.clone()}a(Zt,"pushMatrix");function fe(...r){if(r[0]===void 0)return;let i=C(...r);i.x===0&&i.y===0||w.transform.translate(i)}a(fe,"pushTranslate");function st(...r){if(r[0]===void 0)return;let i=C(...r);i.x===1&&i.y===1||w.transform.scale(i)}a(st,"pushScale");function ge(r){r&&w.transform.rotate(r)}a(ge,"pushRotate");function Ee(){w.transformStack.push(w.transform.clone())}a(Ee,"pushTransform");function Ae(){w.transformStack.length>0&&(w.transform=w.transformStack.pop())}a(Ae,"popTransform");function nt(r){if(r.width===void 0||r.height===void 0)throw new Error('drawUVQuad() requires property "width" and "height".');if(r.width<=0||r.height<=0)return;let i=r.width,s=r.height,o=Nt(r.anchor||Jr).scale(new M(i,s).scale(-.5)),l=r.quad||new Pe(0,0,1,1),u=r.color||ue(255,255,255),m=r.opacity??1,x=r.tex?pn/r.tex.width:0,A=r.tex?pn/r.tex.height:0,c=l.x+x,v=l.y+A,I=l.w-x*2,O=l.h-A*2;Ee(),fe(r.pos),ge(r.angle),st(r.scale),fe(o),Ft([{pos:new M(-i/2,s/2),uv:new M(r.flipX?c+I:c,r.flipY?v:v+O),color:u,opacity:m},{pos:new M(-i/2,-s/2),uv:new M(r.flipX?c+I:c,r.flipY?v+O:v),color:u,opacity:m},{pos:new M(i/2,-s/2),uv:new M(r.flipX?c:c+I,r.flipY?v+O:v),color:u,opacity:m},{pos:new M(i/2,s/2),uv:new M(r.flipX?c:c+I,r.flipY?v:v+O),color:u,opacity:m}],[0,1,3,1,2,3],r.fixed,r.tex,r.shader,r.uniform),Ae()}a(nt,"drawUVQuad");function gt(r){if(!r.tex)throw new Error('drawTexture() requires property "tex".');let i=r.quad??new Pe(0,0,1,1),s=r.tex.width*i.w,o=r.tex.height*i.h,l=new M(1);if(r.tiled){let u=Math.ceil((r.width||s)/s),m=Math.ceil((r.height||o)/o),x=Nt(r.anchor||Jr).add(new M(1,1)).scale(.5).scale(u*s,m*o);for(let A=0;A<u;A++)for(let c=0;c<m;c++)nt(Object.assign({},r,{pos:(r.pos||new M(0)).add(new M(s*A,o*c)).sub(x),scale:l.scale(r.scale||new M(1)),tex:r.tex,quad:i,width:s,height:o,anchor:"topleft"}))}else r.width&&r.height?(l.x=r.width/s,l.y=r.height/o):r.width?(l.x=r.width/s,l.y=l.x):r.height&&(l.y=r.height/o,l.x=l.y),nt(Object.assign({},r,{scale:l.scale(r.scale||new M(1)),tex:r.tex,quad:i,width:s,height:o}))}a(gt,"drawTexture");function Or(r){if(!r.sprite)throw new Error('drawSprite() requires property "sprite"');let i=Ne(r.sprite);if(!i||!i.data)return;let s=i.data.frames[r.frame??0];if(!s)throw new Error(`Frame not found: ${r.frame??0}`);gt(Object.assign({},r,{tex:i.data.tex,quad:s.scale(r.quad??new Pe(0,0,1,1))}))}a(Or,"drawSprite");function ht(r,i,s,o,l,u=1){o=at(o%360),l=at(l%360),l<=o&&(l+=Math.PI*2);let m=[],x=Math.ceil((l-o)/at(8)*u),A=(l-o)/x;for(let c=o;c<l;c+=A)m.push(r.add(i*Math.cos(c),s*Math.sin(c)));return m.push(r.add(i*Math.cos(l),s*Math.sin(l))),m}a(ht,"getArcPts");function Be(r){if(r.width===void 0||r.height===void 0)throw new Error('drawRect() requires property "width" and "height".');if(r.width<=0||r.height<=0)return;let i=r.width,s=r.height,o=Nt(r.anchor||Jr).add(1,1).scale(new M(i,s).scale(-.5)),l=[new M(0,0),new M(i,0),new M(i,s),new M(0,s)];if(r.radius){let u=Math.min(Math.min(i,s)/2,r.radius);l=[new M(u,0),new M(i-u,0),...ht(new M(i-u,u),u,u,270,360),new M(i,u),new M(i,s-u),...ht(new M(i-u,s-u),u,u,0,90),new M(i-u,s),new M(u,s),...ht(new M(u,s-u),u,u,90,180),new M(0,s-u),new M(0,u),...ht(new M(u,u),u,u,180,270)]}Re(Object.assign({},r,{offset:o,pts:l,...r.gradient?{colors:r.horizontal?[r.gradient[0],r.gradient[1],r.gradient[1],r.gradient[0]]:[r.gradient[0],r.gradient[0],r.gradient[1],r.gradient[1]]}:{}}))}a(Be,"drawRect");function d(r){let{p1:i,p2:s}=r;if(!i||!s)throw new Error('drawLine() requires properties "p1" and "p2".');let o=r.width||1,l=s.sub(i).unit().normal().scale(o*.5),u=[i.sub(l),i.add(l),s.add(l),s.sub(l)].map(m=>({pos:new M(m.x,m.y),uv:new M(0),color:r.color??pe.WHITE,opacity:r.opacity??1}));Ft(u,[0,1,3,1,2,3],r.fixed,w.defTex,r.shader,r.uniform)}a(d,"drawLine");function b(r){let i=r.pts;if(!i)throw new Error('drawLines() requires property "pts".');if(!(i.length<2))if(r.radius&&i.length>=3){let s=i[0].sdist(i[1]);for(let o=1;o<i.length-1;o++)s=Math.min(i[o].sdist(i[o+1]),s);Math.min(r.radius,Math.sqrt(s)/2),d(Object.assign({},r,{p1:i[0],p2:i[1]}));for(let o=1;o<i.length-2;o++){let l=i[o],u=i[o+1];d(Object.assign({},r,{p1:l,p2:u}))}d(Object.assign({},r,{p1:i[i.length-2],p2:i[i.length-1]}))}else for(let s=0;s<i.length-1;s++)d(Object.assign({},r,{p1:i[s],p2:i[s+1]})),r.join!=="none"&&ee(Object.assign({},r,{pos:i[s],radius:r.width/2}))}a(b,"drawLines");function D(r){if(!r.p1||!r.p2||!r.p3)throw new Error('drawTriangle() requires properties "p1", "p2" and "p3".');return Re(Object.assign({},r,{pts:[r.p1,r.p2,r.p3]}))}a(D,"drawTriangle");function ee(r){if(typeof r.radius!="number")throw new Error('drawCircle() requires property "radius".');r.radius!==0&&ne(Object.assign({},r,{radiusX:r.radius,radiusY:r.radius,angle:0}))}a(ee,"drawCircle");function ne(r){if(r.radiusX===void 0||r.radiusY===void 0)throw new Error('drawEllipse() requires properties "radiusX" and "radiusY".');if(r.radiusX===0||r.radiusY===0)return;let i=r.start??0,s=r.end??360,o=Nt(r.anchor??"center").scale(new M(-r.radiusX,-r.radiusY)),l=ht(o,r.radiusX,r.radiusY,i,s,r.resolution);l.unshift(o);let u=Object.assign({},r,{pts:l,radius:0,...r.gradient?{colors:[r.gradient[0],...Array(l.length-1).fill(r.gradient[1])]}:{}});if(s-i>=360&&r.outline){r.fill!==!1&&Re(Object.assign(u,{outline:null})),Re(Object.assign(u,{pts:l.slice(1),fill:!1}));return}Re(u)}a(ne,"drawEllipse");function Re(r){if(!r.pts)throw new Error('drawPolygon() requires property "pts".');let i=r.pts.length;if(!(i<3)){if(Ee(),fe(r.pos),st(r.scale),ge(r.angle),fe(r.offset),r.fill!==!1){let s=r.color??pe.WHITE,o=r.pts.map((u,m)=>({pos:new M(u.x,u.y),uv:new M(0,0),color:r.colors&&r.colors[m]?r.colors[m].mult(s):s,opacity:r.opacity??1})),l=[...Array(i-2).keys()].map(u=>[0,u+1,u+2]).flat();Ft(o,r.indices??l,r.fixed,w.defTex,r.shader,r.uniform)}r.outline&&b({pts:[...r.pts,r.pts[0]],radius:r.radius,width:r.outline.width,color:r.outline.color,join:r.outline.join,uniform:r.uniform,fixed:r.fixed,opacity:r.opacity}),Ae()}}a(Re,"drawPolygon");function qe(r,i,s){Ze(),E.clear(E.STENCIL_BUFFER_BIT),E.enable(E.STENCIL_TEST),E.stencilFunc(E.NEVER,1,255),E.stencilOp(E.REPLACE,E.REPLACE,E.REPLACE),i(),Ze(),E.stencilFunc(s,1,255),E.stencilOp(E.KEEP,E.KEEP,E.KEEP),r(),Ze(),E.disable(E.STENCIL_TEST)}a(qe,"drawStenciled");function xr(r,i){qe(r,i,E.EQUAL)}a(xr,"drawMasked");function Vr(r,i){qe(r,i,E.NOTEQUAL)}a(Vr,"drawSubtracted");function _e(){return(w.viewport.width+w.viewport.height)/(w.width+w.height)}a(_e,"getViewportScale");function je(r){Ze();let i=w.width,s=w.height;w.width=w.viewport.width,w.height=w.viewport.height,r(),Ze(),w.width=i,w.height=s}a(je,"drawUnscaled");function ni(r,i){i.pos&&(r.pos=r.pos.add(i.pos)),i.scale&&(r.scale=r.scale.scale(C(i.scale))),i.angle&&(r.angle+=i.angle),i.color&&r.ch.length===1&&(r.color=r.color.mult(i.color)),i.opacity&&(r.opacity*=i.opacity)}a(ni,"applyCharTransform");let Yi=/\[(?<style>\w+)\](?<text>.*?)\[\/\k<style>\]/g;function qi(r){let i={},s=r.replace(Yi,"$2"),o=0;for(let l of r.matchAll(Yi)){let u=l.index-o;for(let m=0;m<l.groups.text.length;m++)i[m+u]=[l.groups.style];o+=l[0].length-l.groups.text.length}return{charStyleMap:i,text:s}}a(qi,"compileStyledText");let oi={};function mt(r){if(r.text===void 0)throw new Error('formatText() requires property "text".');let i=Ke(r.font);if(r.text===""||i instanceof $e||!i)return{width:0,height:0,chars:[],opt:r};let{charStyleMap:s,text:o}=qi(r.text+""),l=Bn(o);if(i instanceof Ve||typeof i=="string"){let ae=i instanceof Ve?i.fontface.family:i,le=i instanceof Ve?{outline:i.outline,filter:i.filter}:{outline:null,filter:Si},$=oi[ae]??{font:{tex:new Gt(g,un,cn,{filter:le.filter}),map:{},size:$r},cursor:new M(0),outline:le.outline};oi[ae]||(oi[ae]=$),i=$.font;for(let Se of l)if(!$.font.map[Se]){let R=F;R.clearRect(0,0,B.width,B.height),R.font=`${i.size}px ${ae}`,R.textBaseline="top",R.textAlign="left",R.fillStyle="#ffffff";let G=R.measureText(Se),z=Math.ceil(G.width),q=i.size;$.outline&&(R.lineJoin="round",R.lineWidth=$.outline.width*2,R.strokeStyle=$.outline.color.toHex(),R.strokeText(Se,$.outline.width,$.outline.width),z+=$.outline.width*2,q+=$.outline.width*3),R.fillText(Se,$.outline?.width??0,$.outline?.width??0);let he=R.getImageData(0,0,z,q);if($.cursor.x+z>un&&($.cursor.x=0,$.cursor.y+=q,$.cursor.y>cn))throw new Error("Font atlas exceeds character limit");i.tex.update(he,$.cursor.x,$.cursor.y),i.map[Se]=new Pe($.cursor.x,$.cursor.y,z,q),$.cursor.x+=z}}let u=r.size||i.size,m=C(r.scale??1).scale(u/i.size),x=r.lineSpacing??0,A=r.letterSpacing??0,c=0,v=0,I=0,O=[],J=[],Z=0,K=null,X=null;for(;Z<l.length;){let ae=l[Z];if(ae===`
`)I+=u+x,O.push({width:c-A,chars:J}),K=null,X=null,c=0,J=[];else{let le=i.map[ae];if(le){let $=le.w*m.x;r.width&&c+$>r.width&&(I+=u+x,K!=null&&(Z-=J.length-K,ae=l[Z],le=i.map[ae],$=le.w*m.x,J=J.slice(0,K-1),c=X),K=null,X=null,O.push({width:c-A,chars:J}),c=0,J=[]),J.push({tex:i.tex,width:le.w,height:le.h,quad:new Pe(le.x/i.tex.width,le.y/i.tex.height,le.w/i.tex.width,le.h/i.tex.height),ch:ae,pos:new M(c,I),opacity:r.opacity??1,color:r.color??pe.WHITE,scale:C(m),angle:0}),ae===" "&&(K=J.length,X=c),c+=$,v=Math.max(v,c),c+=A}}Z++}O.push({width:c-A,chars:J}),I+=u,r.width&&(v=r.width);let Qe=[];for(let ae of O){let le=(v-ae.width)*Wn(r.align??"left");for(let $ of ae.chars){let Se=i.map[$.ch],R=Qe.length;if($.pos=$.pos.add(le,0).add(Se.w*m.x*.5,Se.h*m.y*.5),r.transform){let G=typeof r.transform=="function"?r.transform(R,$.ch):r.transform;G&&ni($,G)}if(s[R]){let G=s[R];for(let z of G){let q=r.styles[z],he=typeof q=="function"?q(R,$.ch):q;he&&ni($,he)}}Qe.push($)}}return{width:v,height:I,chars:Qe,opt:r}}a(mt,"formatText");function ai(r){wt(mt(r))}a(ai,"drawText");function wt(r){Ee(),fe(r.opt.pos),ge(r.opt.angle),fe(Nt(r.opt.anchor??"topleft").add(1,1).scale(r.width,r.height).scale(-.5)),r.chars.forEach(i=>{nt({tex:i.tex,width:i.width,height:i.height,pos:i.pos,scale:i.scale,angle:i.angle,color:i.color,opacity:i.opacity,quad:i.quad,anchor:"center",uniform:r.opt.uniform,shader:r.opt.shader,fixed:r.opt.fixed})}),Ae()}a(wt,"drawFormattedText");function Ie(){return w.width}a(Ie,"width");function Ge(){return w.height}a(Ge,"height");function ji(r){return new M((r.x-w.viewport.x)*Ie()/w.viewport.width,(r.y-w.viewport.y)*Ge()/w.viewport.height)}a(ji,"windowToContent");function Qi(r){return new M(r.x*w.viewport.width/w.width,r.y*w.viewport.height/w.height)}a(Qi,"contentToView");function Er(){return ji(y.mousePos())}a(Er,"mousePos");let Wi=!1,me={inspect:!1,timeScale:1,showLog:!0,fps:()=>y.fps(),numFrames:()=>y.numFrames(),stepFrame:Ai,drawCalls:()=>w.lastDrawCalls,clearLog:()=>T.logs=[],log:r=>{let i=t.logMax??Uo;T.logs.unshift({msg:r,time:y.time()}),T.logs.length>i&&(T.logs=T.logs.slice(0,i))},error:r=>me.log(new Error(r.toString?r.toString():r)),curRecording:null,numObjects:()=>gi("*",{recursive:!0}).length,get paused(){return Wi},set paused(r){Wi=r,r?te.ctx.suspend():te.ctx.resume()}};function ke(){return y.dt()*me.timeScale}a(ke,"dt");function Xi(...r){return r.length>0&&(T.cam.pos=C(...r)),T.cam.pos?T.cam.pos.clone():Tr()}a(Xi,"camPos");function Ji(...r){return r.length>0&&(T.cam.scale=C(...r)),T.cam.scale.clone()}a(Ji,"camScale");function Zi(r){return r!==void 0&&(T.cam.angle=r),T.cam.angle}a(Zi,"camRot");function $i(r=12){T.cam.shake+=r}a($i,"shake");function li(r){return T.cam.transform.multVec2(r)}a(li,"toScreen");function hi(r){return T.cam.transform.invert().multVec2(r)}a(hi,"toWorld");function br(r){let i=new ot;return r.pos&&i.translate(r.pos),r.scale&&i.scale(r.scale),r.angle&&i.rotate(r.angle),r.parent?i.mult(r.parent.transform):i}a(br,"calcTransform");function Gr(r=[]){let i=new Map,s={},o=new Cr,l=[],u=null,m=!1,x={id:Ao(),hidden:!1,transform:new ot,children:[],parent:null,set paused(c){if(c!==m){m=c;for(let v of l)v.paused=c}},get paused(){return m},add(c=[]){let v=Array.isArray(c)?Gr(c):c;if(v.parent)throw new Error("Cannot add a game obj that already has a parent.");return v.parent=this,v.transform=br(v),this.children.push(v),v.trigger("add",v),T.events.trigger("add",v),v},readd(c){let v=this.children.indexOf(c);return v!==-1&&(this.children.splice(v,1),this.children.push(c)),c},remove(c){let v=this.children.indexOf(c);if(v!==-1){c.parent=null,this.children.splice(v,1);let I=a(O=>{O.trigger("destroy"),T.events.trigger("destroy",O),O.children.forEach(J=>I(J))},"trigger");I(c)}},removeAll(c){if(c)this.get(c).forEach(v=>this.remove(v));else for(let v of[...this.children])this.remove(v)},update(){this.paused||(this.children.sort((c,v)=>(c.z??0)-(v.z??0)).forEach(c=>c.update()),this.trigger("update"))},draw(){if(this.hidden)return;this.canvas&&this.canvas.bind();let c=w.fixed;this.fixed&&(w.fixed=!0),Ee(),fe(this.pos),st(this.scale),ge(this.angle);let v=this.children.sort((I,O)=>(I.z??0)-(O.z??0));if(this.mask){let I={intersect:xr,subtract:Vr}[this.mask];if(!I)throw new Error(`Invalid mask func: "${this.mask}"`);I(()=>{v.forEach(O=>O.draw())},()=>{this.trigger("draw")})}else this.trigger("draw"),v.forEach(I=>I.draw());Ae(),w.fixed=c,this.canvas&&this.canvas.unbind()},drawInspect(){this.hidden||(Ee(),fe(this.pos),st(this.scale),ge(this.angle),this.children.sort((c,v)=>(c.z??0)-(v.z??0)).forEach(c=>c.drawInspect()),this.trigger("drawInspect"),Ae())},use(c){if(!c)return;if(typeof c=="string")return this.use({id:c});let v=[];c.id&&(this.unuse(c.id),s[c.id]=[],v=s[c.id],i.set(c.id,c));for(let O in c){if(Yo.has(O))continue;let J=Object.getOwnPropertyDescriptor(c,O);if(typeof J.value=="function"&&(c[O]=c[O].bind(this)),J.set&&Object.defineProperty(c,O,{set:J.set.bind(this)}),J.get&&Object.defineProperty(c,O,{get:J.get.bind(this)}),qo.has(O)){let Z=O==="add"?()=>{u=a(K=>v.push(K),"onCurCompCleanup"),c[O](),u=null}:c[O];v.push(this.on(O,Z).cancel)}else if(this[O]===void 0)Object.defineProperty(this,O,{get:()=>c[O],set:Z=>c[O]=Z,configurable:!0,enumerable:!0}),v.push(()=>delete this[O]);else throw new Error(`Duplicate component property: "${O}"`)}let I=a(()=>{if(c.require){for(let O of c.require)if(!this.c(O))throw new Error(`Component "${c.id}" requires component "${O}"`)}},"checkDeps");c.destroy&&v.push(c.destroy.bind(this)),this.exists()?(I(),c.add&&(u=a(O=>v.push(O),"onCurCompCleanup"),c.add.call(this),u=null)):c.require&&v.push(this.on("add",I).cancel)},unuse(c){s[c]&&(s[c].forEach(v=>v()),delete s[c]),i.has(c)&&i.delete(c)},c(c){return i.get(c)},get(c,v={}){let I=v.recursive?this.children.flatMap(a(function O(J){return[J,...J.children.flatMap(O)]},"recurse")):this.children;if(I=I.filter(O=>c?O.is(c):!0),v.liveUpdate){let O=a(Z=>v.recursive?this.isAncestorOf(Z):Z.parent===this,"isChild"),J=[];J.push(ui(Z=>{O(Z)&&Z.is(c)&&I.push(Z)})),J.push(_i(Z=>{if(O(Z)&&Z.is(c)){let K=I.findIndex(X=>X.id===Z.id);K!==-1&&I.splice(K,1)}})),this.onDestroy(()=>{for(let Z of J)Z.cancel()})}return I},isAncestorOf(c){return c.parent?c.parent===this||this.isAncestorOf(c.parent):!1},exists(){return T.root.isAncestorOf(this)},is(c){if(c==="*")return!0;if(Array.isArray(c)){for(let v of c)if(!this.c(v))return!1;return!0}else return this.c(c)!=null},on(c,v){let I=o.on(c,v.bind(this));return u&&u(()=>I.cancel()),I},trigger(c,...v){o.trigger(c,...v),T.objEvents.trigger(c,this,...v)},destroy(){this.parent&&this.parent.remove(this)},inspect(){let c={};for(let[v,I]of i)c[v]=I.inspect?I.inspect():null;return c},onAdd(c){return this.on("add",c)},onUpdate(c){return this.on("update",c)},onDraw(c){return this.on("draw",c)},onDestroy(c){return this.on("destroy",c)},clearEvents(){o.clear()}},A=["onKeyPress","onKeyPressRepeat","onKeyDown","onKeyRelease","onMousePress","onMouseDown","onMouseRelease","onMouseMove","onCharInput","onMouseMove","onTouchStart","onTouchMove","onTouchEnd","onScroll","onGamepadButtonPress","onGamepadButtonDown","onGamepadButtonRelease","onGamepadStick"];for(let c of A)x[c]=(...v)=>{let I=y[c](...v);return l.push(I),x.onDestroy(()=>I.cancel()),I};for(let c of r)x.use(c);return x}a(Gr,"make");function ut(r,i,s){return T.objEvents[r]||(T.objEvents[r]=new Pn),T.objEvents.on(r,(o,...l)=>{o.is(i)&&s(o,...l)})}a(ut,"on");let Jn=Xe(r=>{let i=Pr([{update:r}]);return{get paused(){return i.paused},set paused(s){i.paused=s},cancel:()=>i.destroy()}},(r,i)=>ut("update",r,i)),Zn=Xe(r=>{let i=Pr([{draw:r}]);return{get paused(){return i.hidden},set paused(s){i.hidden=s},cancel:()=>i.destroy()}},(r,i)=>ut("draw",r,i)),ui=Xe(r=>T.events.on("add",r),(r,i)=>ut("add",r,i)),_i=Xe(r=>T.events.on("destroy",r),(r,i)=>ut("destroy",r,i));function ki(r,i,s){return ut("collide",r,(o,l,u)=>l.is(i)&&s(o,l,u))}a(ki,"onCollide");function es(r,i,s){return ut("collideUpdate",r,(o,l,u)=>l.is(i)&&s(o,l,u))}a(es,"onCollideUpdate");function ts(r,i,s){return ut("collideEnd",r,(o,l,u)=>l.is(i)&&s(o,l,u))}a(ts,"onCollideEnd");function Rr(r,i){gi(r,{recursive:!0}).forEach(i),ui(r,i)}a(Rr,"forAllCurrentAndFuture");let $n=Xe(r=>y.onMousePress(r),(r,i)=>{let s=[];return Rr(r,o=>{if(!o.area)throw new Error("onClick() requires the object to have area() component");s.push(o.onClick(()=>i(o)))}),tr.join(s)});function rs(r,i){let s=[];return Rr(r,o=>{if(!o.area)throw new Error("onHover() requires the object to have area() component");s.push(o.onHover(()=>i(o)))}),tr.join(s)}a(rs,"onHover");function is(r,i){let s=[];return Rr(r,o=>{if(!o.area)throw new Error("onHoverUpdate() requires the object to have area() component");s.push(o.onHoverUpdate(()=>i(o)))}),tr.join(s)}a(is,"onHoverUpdate");function ss(r,i){let s=[];return Rr(r,o=>{if(!o.area)throw new Error("onHoverEnd() requires the object to have area() component");s.push(o.onHoverEnd(()=>i(o)))}),tr.join(s)}a(ss,"onHoverEnd");function ns(r){T.gravity=r}a(ns,"setGravity");function os(){return T.gravity}a(os,"getGravity");function as(...r){r.length===1||r.length===2?(w.bgColor=ue(r[0]),r[1]&&(w.bgAlpha=r[1])):(r.length===3||r.length===4)&&(w.bgColor=ue(r[0],r[1],r[2]),r[3]&&(w.bgAlpha=r[3])),E.clearColor(w.bgColor.r/255,w.bgColor.g/255,w.bgColor.b/255,w.bgAlpha)}a(as,"setBackground");function ls(){return w.bgColor.clone()}a(ls,"getBackground");function Mr(...r){return{id:"pos",pos:C(...r),moveBy(...i){this.pos=this.pos.add(C(...i))},move(...i){this.moveBy(C(...i).scale(ke()))},moveTo(...i){if(typeof i[0]=="number"&&typeof i[1]=="number")return this.moveTo(C(i[0],i[1]),i[2]);let s=i[0],o=i[1];if(o===void 0){this.pos=C(s);return}let l=s.sub(this.pos);if(l.len()<=o*ke()){this.pos=C(s);return}this.move(l.unit().scale(o))},worldPos(){return this.parent?this.parent.transform.multVec2(this.pos):this.pos},screenPos(){let i=this.worldPos();return _t(this)?i:li(i)},inspect(){return`(${Math.round(this.pos.x)}, ${Math.round(this.pos.y)})`},drawInspect(){ee({color:ue(255,0,0),radius:4/_e()})}}}a(Mr,"pos");function Sr(...r){return r.length===0?Sr(1):{id:"scale",scale:C(...r),scaleTo(...i){this.scale=C(...i)},scaleBy(...i){this.scale.scale(C(...i))},inspect(){return`(${$t(this.scale.x,2)}, ${$t(this.scale.y,2)})`}}}a(Sr,"scale");function hs(r){return{id:"rotate",angle:r??0,rotateBy(i){this.angle+=i},rotateTo(i){this.angle=i},inspect(){return`${Math.round(this.angle)}`}}}a(hs,"rotate");function us(...r){return{id:"color",color:ue(...r),inspect(){return this.color.toString()}}}a(us,"color");function $t(r,i){return Number(r.toFixed(i))}a($t,"toFixed");function cs(r){return{id:"opacity",opacity:r??1,inspect(){return`${$t(this.opacity,1)}`},fadeOut(i=1,s=Xr.linear){return mi(this.opacity,0,i,o=>this.opacity=o,s)}}}a(cs,"opacity");function Hr(r){if(!r)throw new Error("Please define an anchor");return{id:"anchor",anchor:r,inspect(){return typeof this.anchor=="string"?this.anchor:this.anchor.toString()}}}a(Hr,"anchor");function ds(r){return{id:"z",z:r,inspect(){return`${this.z}`}}}a(ds,"z");function fs(r,i){return{id:"follow",require:["pos"],follow:{obj:r,offset:i??C(0)},add(){r.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){r.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}a(fs,"follow");function ps(r,i){let s=typeof r=="number"?M.fromAngle(r):r.unit();return{id:"move",require:["pos"],update(){this.move(s.scale(i))}}}a(ps,"move");let _n=200;function gs(r={}){let i=r.distance??_n,s=!1;return{id:"offscreen",require:["pos"],isOffScreen(){let o=this.screenPos(),l=new ze(C(0),Ie(),Ge());return!Ur(l,o)&&l.sdistToPoint(o)>i*i},onExitScreen(o){return this.on("exitView",o)},onEnterScreen(o){return this.on("enterView",o)},update(){this.isOffScreen()?(s||(this.trigger("exitView"),s=!0),r.hide&&(this.hidden=!0),r.pause&&(this.paused=!0),r.destroy&&this.destroy()):(s&&(this.trigger("enterView"),s=!1),r.hide&&(this.hidden=!1),r.pause&&(this.paused=!1))}}}a(gs,"offscreen");function _t(r){return r.fixed?!0:r.parent?_t(r.parent):!1}a(_t,"isFixed");function ms(r={}){let i={},s=new Set;return{id:"area",collisionIgnore:r.collisionIgnore??[],add(){this.area.cursor&&this.onHover(()=>y.setCursor(this.area.cursor)),this.onCollideUpdate((o,l)=>{i[o.id]||this.trigger("collide",o,l),i[o.id]=l,s.add(o.id)})},update(){for(let o in i)s.has(Number(o))||(this.trigger("collideEnd",i[o].target),delete i[o]);s.clear()},drawInspect(){let o=this.localArea();Ee(),st(this.area.scale),fe(this.area.offset);let l={outline:{width:4/_e(),color:ue(0,0,255)},anchor:this.anchor,fill:!1,fixed:_t(this)};o instanceof ze?Be({...l,pos:o.pos,width:o.width,height:o.height}):o instanceof Fr?Re({...l,pts:o.pts}):o instanceof tn&&ee({...l,pos:o.center,radius:o.radius}),Ae()},area:{shape:r.shape??null,scale:r.scale?C(r.scale):C(1),offset:r.offset??C(0),cursor:r.cursor??null},isClicked(){return y.isMousePressed()&&this.isHovering()},isHovering(){let o=_t(this)?Er():hi(Er());return this.hasPoint(o)},checkCollision(o){return i[o.id]??null},getCollisions(){return Object.values(i)},isColliding(o){return!!i[o.id]},isOverlapping(o){let l=i[o.id];return l&&l.hasOverlap()},onClick(o){let l=y.onMousePress("left",()=>{this.isHovering()&&o()});return this.onDestroy(()=>l.cancel()),l},onHover(o){let l=!1;return this.onUpdate(()=>{l?l=this.isHovering():this.isHovering()&&(l=!0,o())})},onHoverUpdate(o){return this.onUpdate(()=>{this.isHovering()&&o()})},onHoverEnd(o){let l=!1;return this.onUpdate(()=>{l?this.isHovering()||(l=!1,o()):l=this.isHovering()})},onCollide(o,l){if(typeof o=="function"&&l===void 0)return this.on("collide",o);if(typeof o=="string")return this.onCollide((u,m)=>{u.is(o)&&l(u,m)})},onCollideUpdate(o,l){if(typeof o=="function"&&l===void 0)return this.on("collideUpdate",o);if(typeof o=="string")return this.on("collideUpdate",(u,m)=>u.is(o)&&l(u,m))},onCollideEnd(o,l){if(typeof o=="function"&&l===void 0)return this.on("collideEnd",o);if(typeof o=="string")return this.on("collideEnd",u=>u.is(o)&&l(u))},hasPoint(o){return zi(this.worldArea(),o)},resolveCollision(o){let l=this.checkCollision(o);l&&!l.resolved&&(this.pos=this.pos.add(l.displacement),l.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let o=this.localArea();if(!(o instanceof Fr||o instanceof ze))throw new Error("Only support polygon and rect shapes for now");let l=this.transform.clone().scale(C(this.area.scale??1)).translate(this.area.offset);if(o instanceof ze){let u=Nt(this.anchor||Jr).add(1,1).scale(-.5).scale(o.width,o.height);l.translate(u)}return o.transform(l)},screenArea(){let o=this.worldArea();return _t(this)?o:o.transform(T.cam.transform)}}}a(ms,"area");function At(r){return{color:r.color,opacity:r.opacity,anchor:r.anchor,outline:r.outline,shader:r.shader,uniform:r.uniform}}a(At,"getRenderProps");function zr(r,i={}){let s=null,o=null,l=null,u=new et;if(!r)throw new Error("Please pass the resource name or data to sprite()");let m=a((x,A,c,v)=>{let I=C(1,1);return c&&v?(I.x=c/(x.width*A.w),I.y=v/(x.height*A.h)):c?(I.x=c/(x.width*A.w),I.y=I.x):v&&(I.y=v/(x.height*A.h),I.x=I.y),I},"calcTexScale");return{id:"sprite",width:0,height:0,frame:i.frame||0,quad:i.quad||new Pe(0,0,1,1),animSpeed:i.animSpeed??1,flipX:i.flipX??!1,flipY:i.flipY??!1,draw(){if(!s)return;let x=s.frames[this.frame??0];if(!x)throw new Error(`Frame not found: ${this.frame??0}`);if(s.slice9){let{left:A,right:c,top:v,bottom:I}=s.slice9,O=s.tex.width*x.w,J=s.tex.height*x.h,Z=this.width-A-c,K=this.height-v-I,X=A/O,Qe=c/O,ae=1-X-Qe,le=v/J,$=I/J,Se=1-le-$,R=[xe(0,0,X,le),xe(X,0,ae,le),xe(X+ae,0,Qe,le),xe(0,le,X,Se),xe(X,le,ae,Se),xe(X+ae,le,Qe,Se),xe(0,le+Se,X,$),xe(X,le+Se,ae,$),xe(X+ae,le+Se,Qe,$),xe(0,0,A,v),xe(A,0,Z,v),xe(A+Z,0,c,v),xe(0,v,A,K),xe(A,v,Z,K),xe(A+Z,v,c,K),xe(0,v+K,A,I),xe(A,v+K,Z,I),xe(A+Z,v+K,c,I)];for(let G=0;G<9;G++){let z=R[G],q=R[G+9];gt(Object.assign(At(this),{pos:q.pos(),tex:s.tex,quad:x.scale(z),flipX:this.flipX,flipY:this.flipY,tiled:i.tiled,width:q.w,height:q.h}))}}else gt(Object.assign(At(this),{tex:s.tex,quad:x.scale(this.quad??new Pe(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:i.tiled,width:this.width,height:this.height}))},add(){let x=a(c=>{let v=c.frames[0].clone();i.quad&&(v=v.scale(i.quad));let I=m(c.tex,v,i.width,i.height);this.width=c.tex.width*v.w*I.x,this.height=c.tex.height*v.h*I.y,i.anim&&this.play(i.anim),s=c,u.trigger(s)},"setSpriteData"),A=Ne(r);A?A.onLoad(x):Yr(()=>x(Ne(r).data))},update(){if(!o)return;let x=s.anims[o.name];if(typeof x=="number"){this.frame=x;return}if(x.speed===0)throw new Error("Sprite anim speed cannot be 0");o.timer+=ke()*this.animSpeed,o.timer>=1/o.speed&&(o.timer=0,this.frame+=l,(this.frame<Math.min(x.from,x.to)||this.frame>Math.max(x.from,x.to))&&(o.loop?o.pingpong?(this.frame-=l,l*=-1,this.frame+=l):this.frame=x.from:(this.frame=x.to,o.onEnd(),this.stop())))},play(x,A={}){if(!s){u.add(()=>this.play(x,A));return}let c=s.anims[x];if(c===void 0)throw new Error(`Anim not found: ${x}`);o&&this.stop(),o=typeof c=="number"?{name:x,timer:0,loop:!1,pingpong:!1,speed:0,onEnd:()=>{}}:{name:x,timer:0,loop:A.loop??c.loop??!1,pingpong:A.pingpong??c.pingpong??!1,speed:A.speed??c.speed??10,onEnd:A.onEnd??(()=>{})},l=typeof c=="number"?null:c.from<c.to?1:-1,this.frame=typeof c=="number"?c:c.from,this.trigger("animStart",x)},stop(){if(!o)return;let x=o.name;o=null,this.trigger("animEnd",x)},numFrames(){return s?.frames.length??0},curAnim(){return o?.name},onAnimEnd(x){return this.on("animEnd",x)},onAnimStart(x){return this.on("animStart",x)},renderArea(){return new ze(C(0),this.width,this.height)},inspect(){if(typeof r=="string")return`"${r}"`}}}a(zr,"sprite");function ws(r,i={}){function s(l){let u=mt(Object.assign(At(l),{text:l.text+"",size:l.textSize,font:l.font,width:i.width&&l.width,align:l.align,letterSpacing:l.letterSpacing,lineSpacing:l.lineSpacing,transform:l.textTransform,styles:l.textStyles}));return i.width||(l.width=u.width/(l.scale?.x||1)),l.height=u.height/(l.scale?.y||1),u}a(s,"update");let o={id:"text",set text(l){r=l,s(this)},get text(){return r},textSize:i.size??Io,font:i.font,width:i.width??0,height:0,align:i.align,lineSpacing:i.lineSpacing,letterSpacing:i.letterSpacing,textTransform:i.transform,textStyles:i.styles,add(){Yr(()=>s(this))},draw(){wt(s(this))},renderArea(){return new ze(C(0),this.width,this.height)}};return s(o),o}a(ws,"text");function As(r,i={}){if(r.length<3)throw new Error(`Polygon's need more than two points, ${r.length} points provided`);return{id:"polygon",pts:r,colors:i.colors,radius:i.radius,draw(){Re(Object.assign(At(this),{pts:this.pts,colors:this.colors,radius:this.radius,fill:i.fill}))},renderArea(){return new Fr(this.pts)},inspect(){return this.pts.map(s=>`[${s.x},${s.y}]`).join(",")}}}a(As,"polygon");function ys(r,i,s={}){return{id:"rect",width:r,height:i,radius:s.radius||0,draw(){Be(Object.assign(At(this),{width:this.width,height:this.height,radius:this.radius,fill:s.fill}))},renderArea(){return new ze(C(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}a(ys,"rect");function vs(r,i){return{id:"rect",width:r,height:i,draw(){nt(Object.assign(At(this),{width:this.width,height:this.height}))},renderArea(){return new ze(C(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}a(vs,"uvquad");function xs(r,i={}){return{id:"circle",radius:r,draw(){ee(Object.assign(At(this),{radius:this.radius,fill:i.fill}))},renderArea(){return new ze(new M(this.anchor?0:-this.radius),this.radius*2,this.radius*2)},inspect(){return`${Math.ceil(this.radius)}`}}}a(xs,"circle");function Vs(r=1,i=ue(0,0,0)){return{id:"outline",outline:{width:r,color:i}}}a(Vs,"outline");function Kr(){return{id:"timer",wait(r,i){let s=[];i&&s.push(i);let o=0,l=this.onUpdate(()=>{o+=ke(),o>=r&&(s.forEach(u=>u()),l.cancel())});return{get paused(){return l.paused},set paused(u){l.paused=u},cancel:l.cancel,onEnd(u){s.push(u)},then(u){return this.onEnd(u),this}}},loop(r,i){let s=null,o=a(()=>{s=this.wait(r,o),i()},"newAction");return s=this.wait(0,o),{get paused(){return s.paused},set paused(l){s.paused=l},cancel:()=>s.cancel()}},tween(r,i,s,o,l=Xr.linear){let u=0,m=[],x=this.onUpdate(()=>{u+=ke();let A=Math.min(u/s,1);o(ft(r,i,l(A))),A===1&&(x.cancel(),o(i),m.forEach(c=>c()))});return{get paused(){return x.paused},set paused(A){x.paused=A},onEnd(A){m.push(A)},then(A){return this.onEnd(A),this},cancel(){x.cancel()},finish(){x.cancel(),o(i),m.forEach(A=>A())}}}}}a(Kr,"timer");let kn=640,eo=65536;function Es(r={}){let i=null,s=null,o=!1;return{id:"body",require:["pos","area"],vel:new M(0),jumpForce:r.jumpForce??kn,gravityScale:r.gravityScale??1,isStatic:r.isStatic??!1,mass:r.mass??1,add(){if(this.mass===0)throw new Error("Can't set body mass to 0");this.onCollideUpdate((l,u)=>{if(l.is("body")&&!u.resolved&&(this.trigger("beforePhysicsResolve",u),l.trigger("beforePhysicsResolve",u.reverse()),!u.resolved&&!(this.isStatic&&l.isStatic))){if(!this.isStatic&&!l.isStatic){let m=this.mass+l.mass;this.pos=this.pos.add(u.displacement.scale(l.mass/m)),l.pos=l.pos.add(u.displacement.scale(-this.mass/m)),this.transform=br(this),l.transform=br(l)}else{let m=!this.isStatic&&l.isStatic?u:u.reverse();m.source.pos=m.source.pos.add(m.displacement),m.source.transform=br(m.source)}u.resolved=!0,this.trigger("physicsResolve",u),l.trigger("physicsResolve",u.reverse())}}),this.onPhysicsResolve(l=>{T.gravity&&(l.isBottom()&&this.isFalling()?(this.vel.y=0,i=l.target,s=l.target.pos,o?o=!1:this.trigger("ground",i)):l.isTop()&&this.isJumping()&&(this.vel.y=0,this.trigger("headbutt",l.target)))})},update(){if(!T.gravity||this.isStatic)return;if(o&&(i=null,s=null,this.trigger("fallOff"),o=!1),i)if(!this.isColliding(i)||!i.exists()||!i.is("body"))o=!0;else{!i.pos.eq(s)&&r.stickToPlatform!==!1&&this.moveBy(i.pos.sub(s)),s=i.pos;return}let l=this.vel.y;this.vel.y+=T.gravity*this.gravityScale*ke(),this.vel.y=Math.min(this.vel.y,r.maxVelocity??eo),l<0&&this.vel.y>=0&&this.trigger("fall"),this.move(this.vel)},onPhysicsResolve(l){return this.on("physicsResolve",l)},onBeforePhysicsResolve(l){return this.on("beforePhysicsResolve",l)},curPlatform(){return i},isGrounded(){return i!==null},isFalling(){return this.vel.y>0},isJumping(){return this.vel.y<0},jump(l){i=null,s=null,this.vel.y=-l||-this.jumpForce},onGround(l){return this.on("ground",l)},onFall(l){return this.on("fall",l)},onFallOff(l){return this.on("fallOff",l)},onHeadbutt(l){return this.on("headbutt",l)}}}a(Es,"body");function bs(r=2){let i=r;return{id:"doubleJump",require:["body"],numJumps:r,add(){this.onGround(()=>{i=this.numJumps})},doubleJump(s){i<=0||(i<this.numJumps&&this.trigger("doubleJump"),i--,this.jump(s))},onDoubleJump(s){return this.on("doubleJump",s)},inspect(){return`${i}`}}}a(bs,"doubleJump");function Rs(r,i){return{id:"shader",shader:r,...typeof i=="function"?{uniform:i(),update(){this.uniform=i()}}:{uniform:i}}}a(Rs,"shader");function Ms(){return{id:"fixed",fixed:!0}}a(Ms,"fixed");function ci(r){return{id:"stay",stay:!0,scenesToStay:r}}a(ci,"stay");function Ss(r,i){if(r==null)throw new Error("health() requires the initial amount of hp");return{id:"health",hurt(s=1){this.setHP(r-s),this.trigger("hurt",s)},heal(s=1){let o=r;this.setHP(r+s),this.trigger("heal",r-o)},hp(){return r},maxHP(){return i??null},setMaxHP(s){i=s},setHP(s){r=i?Math.min(i,s):s,r<=0&&this.trigger("death")},onHurt(s){return this.on("hurt",s)},onHeal(s){return this.on("heal",s)},onDeath(s){return this.on("death",s)},inspect(){return`${r}`}}}a(Ss,"health");function Ts(r,i={}){if(r==null)throw new Error("lifespan() requires time");let s=i.fade??0;return{id:"lifespan",async add(){await Ks(r),s>0&&this.opacity&&await mi(this.opacity,0,s,o=>this.opacity=o,Xr.linear),this.destroy()}}}a(Ts,"lifespan");function Ps(r,i,s){if(!r)throw new Error("state() requires an initial state");let o={};function l(A){o[A]||(o[A]={enter:new et,end:new et,update:new et,draw:new et})}a(l,"initStateEvents");function u(A,c,v){return l(c),o[c][A].add(v)}a(u,"on");function m(A,c,...v){l(c),o[c][A].trigger(...v)}a(m,"trigger");let x=!1;return{id:"state",state:r,enterState(A,...c){if(x=!0,i&&!i.includes(A))throw new Error(`State not found: ${A}`);let v=this.state;if(s){if(!s?.[v])return;let I=typeof s[v]=="string"?[s[v]]:s[v];if(!I.includes(A))throw new Error(`Cannot transition state from "${v}" to "${A}". Available transitions: ${I.map(O=>`"${O}"`).join(", ")}`)}m("end",v,...c),this.state=A,m("enter",A,...c),m("enter",`${v} -> ${A}`,...c)},onStateTransition(A,c,v){return u("enter",`${A} -> ${c}`,v)},onStateEnter(A,c){return u("enter",A,c)},onStateUpdate(A,c){return u("update",A,c)},onStateDraw(A,c){return u("draw",A,c)},onStateEnd(A,c){return u("end",A,c)},update(){x||(m("enter",r),x=!0),m("update",this.state)},draw(){m("draw",this.state)},inspect(){return this.state}}}a(Ps,"state");function Ds(r=1){let i=0,s=!1;return{require:["opacity"],add(){this.opacity=0},update(){s||(i+=ke(),this.opacity=xt(i,0,r,0,1),i>=r&&(this.opacity=1,s=!0))}}}a(Ds,"fadeIn");function Fs(r="intersect"){return{id:"mask",mask:r}}a(Fs,"mask");function Cs(r){return{add(){this.canvas=r}}}a(Cs,"drawon");function Yr(r){H.loaded?r():T.events.on("load",r)}a(Yr,"onLoad");function Bs(r,i){T.scenes[r]=i}a(Bs,"scene");function Is(r,...i){if(!T.scenes[r])throw new Error(`Scene not found: ${r}`);T.events.onOnce("frameEnd",()=>{T.events.trigger("sceneLeave",r),y.events.clear(),T.events.clear(),T.objEvents.clear(),[...T.root.children].forEach(s=>{(!s.stay||s.scenesToStay&&!s.scenesToStay.includes(r))&&T.root.remove(s)}),T.root.clearEvents(),Vi(),T.cam={pos:null,scale:C(1),angle:0,shake:0,transform:new ot},T.scenes[r](...i)})}a(Is,"go");function Ls(r){return T.events.on("sceneLeave",r)}a(Ls,"onSceneLeave");function Us(r,i){try{return JSON.parse(window.localStorage[r])}catch{return i?(di(r,i),i):null}}a(Us,"getData");function di(r,i){window.localStorage[r]=JSON.stringify(i)}a(di,"setData");function fi(r,...i){let s=r(It),o;typeof s=="function"?o=s(...i)(It):o=s;for(let l in o)It[l]=o[l],t.global!==!1&&(window[l]=o[l]);return It}a(fi,"plug");function Tr(){return C(Ie()/2,Ge()/2)}a(Tr,"center");let to;(r=>(r[r.None=0]="None",r[r.Left=1]="Left",r[r.Top=2]="Top",r[r.LeftTop=3]="LeftTop",r[r.Right=4]="Right",r[r.Horizontal=5]="Horizontal",r[r.RightTop=6]="RightTop",r[r.HorizontalTop=7]="HorizontalTop",r[r.Bottom=8]="Bottom",r[r.LeftBottom=9]="LeftBottom",r[r.Vertical=10]="Vertical",r[r.LeftVertical=11]="LeftVertical",r[r.RightBottom=12]="RightBottom",r[r.HorizontalBottom=13]="HorizontalBottom",r[r.RightVertical=14]="RightVertical",r[r.All=15]="All"))(to||={});function pi(r={}){let i=C(0),s=r.isObstacle??!1,o=r.cost??0,l=r.edges??[],u=a(()=>{let x={left:1,top:2,right:4,bottom:8};return l.map(A=>x[A]||0).reduce((A,c)=>A|c,0)},"getEdgeMask"),m=u();return{id:"tile",tilePosOffset:r.offset??C(0),set tilePos(x){let A=this.getLevel();i=x.clone(),this.pos=C(this.tilePos.x*A.tileWidth(),this.tilePos.y*A.tileHeight()).add(this.tilePosOffset)},get tilePos(){return i},set isObstacle(x){s!==x&&(s=x,this.getLevel().invalidateNavigationMap())},get isObstacle(){return s},set cost(x){o!==x&&(o=x,this.getLevel().invalidateNavigationMap())},get cost(){return o},set edges(x){l=x,m=u(),this.getLevel().invalidateNavigationMap()},get edges(){return l},get edgeMask(){return m},getLevel(){return this.parent},moveLeft(){this.tilePos=this.tilePos.add(C(-1,0))},moveRight(){this.tilePos=this.tilePos.add(C(1,0))},moveUp(){this.tilePos=this.tilePos.add(C(0,-1))},moveDown(){this.tilePos=this.tilePos.add(C(0,1))}}}a(pi,"tile");function Ns(r,i){if(!i.tileWidth||!i.tileHeight)throw new Error("Must provide tileWidth and tileHeight.");let s=Pr([Mr(i.pos??C(0))]),o=r.length,l=0,u=null,m=null,x=null,A=null,c=a(R=>R.x+R.y*l,"tile2Hash"),v=a(R=>C(Math.floor(R%l),Math.floor(R/l)),"hash2Tile"),I=a(()=>{u=[];for(let R of s.children)O(R)},"createSpatialMap"),O=a(R=>{let G=c(R.tilePos);u[G]?u[G].push(R):u[G]=[R]},"insertIntoSpatialMap"),J=a(R=>{let G=c(R.tilePos);if(u[G]){let z=u[G].indexOf(R);z>=0&&u[G].splice(z,1)}},"removeFromSpatialMap"),Z=a(()=>{let R=!1;for(let G of s.children){let z=s.pos2Tile(G.pos);(G.tilePos.x!=z.x||G.tilePos.y!=z.y)&&(R=!0,J(G),G.tilePos.x=z.x,G.tilePos.y=z.y,O(G))}R&&s.trigger("spatial_map_changed")},"updateSpatialMap"),K=a(()=>{let R=s.getSpatialMap(),G=s.numRows()*s.numColumns();m?m.length=G:m=new Array(G),m.fill(1,0,G);for(let z=0;z<R.length;z++){let q=R[z];if(q){let he=0;for(let de of q)if(de.isObstacle){he=1/0;break}else he+=de.cost;m[z]=he||1}}},"createCostMap"),X=a(()=>{let R=s.getSpatialMap(),G=s.numRows()*s.numColumns();x?x.length=G:x=new Array(G),x.fill(15,0,G);for(let z=0;z<R.length;z++){let q=R[z];if(q){let he=q.length,de=15;for(let ve=0;ve<he;ve++)de|=q[ve].edgeMask;x[z]=de}}},"createEdgeMap"),Qe=a(()=>{let R=s.numRows()*s.numColumns(),G=a((q,he)=>{let de=[];for(de.push(q);de.length>0;){let ve=de.pop();$(ve).forEach(Te=>{A[Te]<0&&(A[Te]=he,de.push(Te))})}},"traverse");A?A.length=R:A=new Array(R),A.fill(-1,0,R);let z=0;for(let q=0;q<m.length;q++){if(A[q]>=0){z++;continue}G(q,z),z++}},"createConnectivityMap"),ae=a((R,G)=>m[G],"getCost"),le=a((R,G)=>{let z=v(R),q=v(G);return z.dist(q)},"getHeuristic"),$=a((R,G)=>{let z=[],q=Math.floor(R%l),he=q>0&&x[R]&1&&m[R-1]!==1/0,de=R>=l&&x[R]&2&&m[R-l]!==1/0,ve=q<l-1&&x[R]&4&&m[R+1]!==1/0,Te=R<l*o-l-1&&x[R]&8&&m[R+l]!==1/0;return G?(he&&(de&&z.push(R-l-1),z.push(R-1),Te&&z.push(R+l-1)),de&&z.push(R-l),ve&&(de&&z.push(R-l+1),z.push(R+1),Te&&z.push(R+l+1)),Te&&z.push(R+l)):(he&&z.push(R-1),de&&z.push(R-l),ve&&z.push(R+1),Te&&z.push(R+l)),z},"getNeighbours"),Se={id:"level",tileWidth(){return i.tileWidth},tileHeight(){return i.tileHeight},spawn(R,...G){let z=C(...G),q=(()=>{if(typeof R=="string"){if(i.tiles[R]){if(typeof i.tiles[R]!="function")throw new Error("Level symbol def must be a function returning a component list");return i.tiles[R](z)}else if(i.wildcardTile)return i.wildcardTile(R,z)}else{if(Array.isArray(R))return R;throw new Error("Expected a symbol or a component list")}})();if(!q)return null;let he=!1,de=!1;for(let Te of q)Te.id==="tile"&&(de=!0),Te.id==="pos"&&(he=!0);he||q.push(Mr()),de||q.push(pi());let ve=s.add(q);return he&&(ve.tilePosOffset=ve.pos.clone()),ve.tilePos=z,u&&(O(ve),this.trigger("spatial_map_changed"),this.trigger("navigation_map_invalid")),ve},numColumns(){return l},numRows(){return o},levelWidth(){return l*this.tileWidth()},levelHeight(){return o*this.tileHeight()},tile2Pos(...R){return C(...R).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...R){let G=C(...R);return C(Math.floor(G.x/this.tileWidth()),Math.floor(G.y/this.tileHeight()))},getSpatialMap(){return u||I(),u},onSpatialMapChanged(R){return this.on("spatial_map_changed",R)},onNavigationMapInvalid(R){return this.on("navigation_map_invalid",R)},getAt(R){u||I();let G=c(R);return u[G]||[]},update(){u&&Z()},invalidateNavigationMap(){m=null,x=null,A=null},onNavigationMapChanged(R){return this.on("navigation_map_changed",R)},getTilePath(R,G,z={}){if(m||K(),x||X(),A||Qe(),R.x<0||R.x>=l||R.y<0||R.y>=o||G.x<0||G.x>=l||G.y<0||G.y>=o)return null;let q=c(R),he=c(G);if(m[he]===1/0)return null;if(q===he)return[];if(A[q]!=-1&&A[q]!==A[he])return null;let de=new vo((ct,Ri)=>ct.cost<Ri.cost);de.insert({cost:0,node:q});let ve=new Map;ve.set(q,q);let Te=new Map;for(Te.set(q,0);de.length!==0;){let ct=de.remove()?.node;if(ct===he)break;let Ri=$(ct,z.allowDiagonals);for(let Ut of Ri){let Mi=(Te.get(ct)||0)+ae(ct,Ut)+le(Ut,he);(!Te.has(Ut)||Mi<Te.get(Ut))&&(Te.set(Ut,Mi),de.insert({cost:Mi,node:Ut}),ve.set(Ut,ct))}}let bi=[],Dr=he,ao=v(Dr);for(bi.push(ao);Dr!==q;){Dr=ve.get(Dr);let ct=v(Dr);bi.push(ct)}return bi.reverse()},getPath(R,G,z={}){let q=this.tileWidth(),he=this.tileHeight(),de=this.getTilePath(this.pos2Tile(R),this.pos2Tile(G),z);return de?[R,...de.slice(1,-1).map(ve=>ve.scale(q,he).add(q/2,he/2)),G]:null}};return s.use(Se),s.onNavigationMapInvalid(()=>{s.invalidateNavigationMap(),s.trigger("navigation_map_changed")}),r.forEach((R,G)=>{let z=R.split("");l=Math.max(z.length,l),z.forEach((q,he)=>{s.spawn(q,C(he,G))})}),s}a(Ns,"addLevel");function Os(r={}){let i=null,s=null,o=null,l=null;return{id:"agent",require:["pos","tile"],agentSpeed:r.speed??100,allowDiagonals:r.allowDiagonals??!0,getDistanceToTarget(){return i?this.pos.dist(i):0},getNextLocation(){return s&&o?s[o]:null},getPath(){return s?s.slice():null},getTarget(){return i},isNavigationFinished(){return s?o===null:!0},isTargetReachable(){return s!==null},isTargetReached(){return i?this.pos.eq(i):!0},setTarget(u){i=u,s=this.getLevel().getPath(this.pos,i,{allowDiagonals:this.allowDiagonals}),o=s?0:null,s?(l||(l=this.getLevel().onNavigationMapChanged(()=>{s&&o!==null&&(s=this.getLevel().getPath(this.pos,i,{allowDiagonals:this.allowDiagonals}),o=s?0:null,s?this.trigger("navigation-next",this,s[o]):this.trigger("navigation-ended",this))}),this.onDestroy(()=>l.cancel())),this.trigger("navigation-started",this),this.trigger("navigation-next",this,s[o])):this.trigger("navigation-ended",this)},update(){if(s&&o!==null){if(this.pos.sdist(s[o])<2)if(o===s.length-1){this.pos=i.clone(),o=null,this.trigger("navigation-ended",this),this.trigger("target-reached",this);return}else o++,this.trigger("navigation-next",this,s[o]);this.moveTo(s[o],this.agentSpeed)}},onNavigationStarted(u){return this.on("navigation-started",u)},onNavigationNext(u){return this.on("navigation-next",u)},onNavigationEnded(u){return this.on("navigation-ended",u)},onTargetReached(u){return this.on("target-reached",u)},inspect(){return JSON.stringify({target:JSON.stringify(i),path:JSON.stringify(s)})}}}a(Os,"agent");function Gs(r){let i=y.canvas.captureStream(r),s=te.ctx.createMediaStreamDestination();te.masterNode.connect(s);let o=new MediaRecorder(i),l=[];return o.ondataavailable=u=>{u.data.size>0&&l.push(u.data)},o.onerror=()=>{te.masterNode.disconnect(s),i.getTracks().forEach(u=>u.stop())},o.start(),{resume(){o.resume()},pause(){o.pause()},stop(){return o.stop(),te.masterNode.disconnect(s),i.getTracks().forEach(u=>u.stop()),new Promise(u=>{o.onstop=()=>{u(new Blob(l,{type:"video/mp4"}))}})},download(u="kaboom.mp4"){this.stop().then(m=>Bi(u,m))}}}a(Gs,"record");function Hs(){return document.activeElement===y.canvas}a(Hs,"isFocused");function zs(r){r.destroy()}a(zs,"destroy");let Pr=T.root.add.bind(T.root),ro=T.root.readd.bind(T.root),io=T.root.removeAll.bind(T.root),gi=T.root.get.bind(T.root),Ks=T.root.wait.bind(T.root),so=T.root.loop.bind(T.root),mi=T.root.tween.bind(T.root);function wi(r=2,i=1){let s=0;return{require:["scale"],update(){let o=Math.sin(s*r)*i;o<0&&this.destroy(),this.scale=C(o),s+=ke()}}}a(wi,"boom");let no=Je(null,Do),oo=Je(null,Fo);function Ys(r,i={}){let s=Pr([Mr(r),ci()]),o=(i.speed||1)*5,l=i.scale||1;s.add([zr(oo),Sr(0),Hr("center"),wi(o,l),...i.comps??[]]);let u=s.add([zr(no),Sr(0),Hr("center"),Kr(),...i.comps??[]]);return u.wait(.4/o,()=>u.use(wi(o,l))),u.onDestroy(()=>s.destroy()),s}a(Ys,"addKaboom");function Ai(){T.root.update()}a(Ai,"updateFrame");const jr=class jr{source;target;displacement;resolved=!1;constructor(i,s,o,l=!1){this.source=i,this.target=s,this.displacement=o,this.resolved=l}reverse(){return new jr(this.target,this.source,this.displacement.scale(-1),this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.x>0}isRight(){return this.displacement.x<0}isTop(){return this.displacement.y>0}isBottom(){return this.displacement.y<0}preventResolution(){this.resolved=!0}};a(jr,"Collision");let yi=jr;function qs(){let r={},i=t.hashGridSize||Lo,s=new ot,o=[];function l(u){if(o.push(s.clone()),u.pos&&s.translate(u.pos),u.scale&&s.scale(u.scale),u.angle&&s.rotate(u.angle),u.transform=s.clone(),u.c("area")&&!u.paused){let m=u,x=m.worldArea().bbox(),A=Math.floor(x.pos.x/i),c=Math.floor(x.pos.y/i),v=Math.ceil((x.pos.x+x.width)/i),I=Math.ceil((x.pos.y+x.height)/i),O=new Set;for(let J=A;J<=v;J++)for(let Z=c;Z<=I;Z++)if(!r[J])r[J]={},r[J][Z]=[m];else if(!r[J][Z])r[J][Z]=[m];else{let K=r[J][Z];e:for(let X of K){if(X.paused||!X.exists()||O.has(X.id))continue;for(let ae of m.collisionIgnore)if(X.is(ae))continue e;for(let ae of X.collisionIgnore)if(m.is(ae))continue e;let Qe=Tn(m.worldArea(),X.worldArea());if(Qe){let ae=new yi(m,X,Qe);m.trigger("collideUpdate",X,ae);let le=ae.reverse();le.resolved=ae.resolved,X.trigger("collideUpdate",m,le)}O.add(X.id)}K.push(m)}}u.children.forEach(l),s=o.pop()}a(l,"checkObj"),l(T.root)}a(qs,"checkFrame");function js(){let r=T.cam,i=M.fromAngle(Lr(0,360)).scale(r.shake);r.shake=ft(r.shake,0,5*ke()),r.transform=new ot().translate(Tr()).scale(r.scale).rotate(r.angle).translate((r.pos??Tr()).scale(-1).add(i)),T.root.draw(),Ze()}a(js,"drawFrame");function Qs(){let r=_();T.events.numListeners("loading")>0?T.events.trigger("loading",r):je(()=>{let i=Ie()/2,s=24,o=C(Ie()/2,Ge()/2).sub(C(i/2,s/2));Be({pos:C(0),width:Ie(),height:Ge(),color:ue(0,0,0)}),Be({pos:o,width:i,height:s,fill:!1,outline:{width:4}}),Be({pos:o,width:i*r,height:s})})}a(Qs,"drawLoadScreen");function vi(r,i){je(()=>{let s=C(8);Ee(),fe(r);let o=mt({text:i,font:Zr,size:16,pos:s,color:ue(255,255,255),fixed:!0}),l=o.width+s.x*2,u=o.height+s.x*2;r.x+l>=Ie()&&fe(C(-l,0)),r.y+u>=Ge()&&fe(C(0,-u)),Be({width:l,height:u,color:ue(0,0,0),radius:4,opacity:.8,fixed:!0}),wt(o),Ae()})}a(vi,"drawInspectText");function Ws(){if(me.inspect){let r=null;for(let i of T.root.get("*",{recursive:!0}))if(i.c("area")&&i.isHovering()){r=i;break}if(T.root.drawInspect(),r){let i=[],s=r.inspect();for(let o in s)s[o]?i.push(`${o}: ${s[o]}`):i.push(`${o}`);vi(Qi(Er()),i.join(`
`))}vi(C(8),`FPS: ${me.fps()}`)}me.paused&&je(()=>{Ee(),fe(Ie(),0),fe(-8,8);let r=32;Be({width:r,height:r,anchor:"topright",color:ue(0,0,0),opacity:.8,radius:4,fixed:!0});for(let i=1;i<=2;i++)Be({width:4,height:r*.6,anchor:"center",pos:C(-r/3*i,r*.5),color:ue(255,255,255),radius:2,fixed:!0});Ae()}),me.timeScale!==1&&je(()=>{Ee(),fe(Ie(),Ge()),fe(-8,-8);let r=8,i=mt({text:me.timeScale.toFixed(1),font:Zr,size:16,color:ue(255,255,255),pos:C(-r),anchor:"botright",fixed:!0});Be({width:i.width+r*2+r*4,height:i.height+r*2,anchor:"botright",color:ue(0,0,0),opacity:.8,radius:4,fixed:!0});for(let s=0;s<2;s++){let o=me.timeScale<1;D({p1:C(-i.width-r*(o?2:3.5),-r),p2:C(-i.width-r*(o?2:3.5),-r-i.height),p3:C(-i.width-r*(o?3.5:2),-r-i.height/2),pos:C(-s*r*1+(o?-r*.5:0),0),color:ue(255,255,255),fixed:!0})}wt(i),Ae()}),me.curRecording&&je(()=>{Ee(),fe(0,Ge()),fe(24,-24),ee({radius:12,color:ue(255,0,0),opacity:Fi(0,1,y.time()*4),fixed:!0}),Ae()}),me.showLog&&T.logs.length>0&&je(()=>{Ee(),fe(0,Ge()),fe(8,-8);let r=8,i=[];for(let o of T.logs){let l="",u=o.msg instanceof Error?"error":"info";l+=`[time]${o.time.toFixed(2)}[/time]`,l+=" ",l+=`[${u}]${o.msg?.toString?o.msg.toString():o.msg}[/${u}]`,i.push(l)}T.logs=T.logs.filter(o=>y.time()-o.time<(t.logTime||No));let s=mt({text:i.join(`
`),font:Zr,pos:C(r,-r),anchor:"botleft",size:16,width:Ie()*.6,lineSpacing:r/2,fixed:!0,styles:{time:{color:ue(127,127,127)},info:{color:ue(255,255,255)},error:{color:ue(255,0,127)}}});Be({width:s.width+r*2,height:s.height+r*2,anchor:"botleft",color:ue(0,0,0),radius:4,opacity:.8,fixed:!0}),wt(s),Ae()})}a(Ws,"drawDebug");function Xs(r){T.events.on("loading",r)}a(Xs,"onLoading");function Js(r){y.onResize(r)}a(Js,"onResize");function Zs(r){T.events.on("error",r)}a(Zs,"onError");function $s(r){console.error(r),te.ctx.suspend(),y.run(()=>{Ct(),je(()=>{let i=Ie(),s=Ge(),o={size:36,width:i-64,letterSpacing:4,lineSpacing:4,font:Zr,fixed:!0};Be({width:i,height:s,color:ue(0,0,255),fixed:!0});let l=mt({...o,text:"Error",pos:C(32),color:ue(255,128,0),fixed:!0});wt(l),ai({...o,text:r.message,pos:C(32,32+l.height+16),fixed:!0}),Ae(),T.events.trigger("error",r)}),Bt()})}a($s,"handleErr");function _s(r){N.push(r)}a(_s,"onCleanup");function ks(){T.events.onOnce("frameEnd",()=>{y.quit(),E.clear(E.COLOR_BUFFER_BIT|E.DEPTH_BUFFER_BIT|E.STENCIL_BUFFER_BIT);let r=E.getParameter(E.MAX_TEXTURE_IMAGE_UNITS);for(let i=0;i<r;i++)E.activeTexture(E.TEXTURE0+i),E.bindTexture(E.TEXTURE_2D,null),E.bindTexture(E.TEXTURE_CUBE_MAP,null);E.bindBuffer(E.ARRAY_BUFFER,null),E.bindBuffer(E.ELEMENT_ARRAY_BUFFER,null),E.bindRenderbuffer(E.RENDERBUFFER,null),E.bindFramebuffer(E.FRAMEBUFFER,null),g.destroy(),N.forEach(i=>i())})}a(ks,"quit");let qr=!0;y.run(()=>{try{H.loaded||_()===1&&!qr&&(H.loaded=!0,T.events.trigger("load")),!H.loaded&&t.loadingScreen!==!1||qr?(Ct(),Qs(),Bt()):(me.paused||Ai(),qs(),Ct(),js(),t.debug!==!1&&Ws(),Bt()),qr&&(qr=!1),T.events.trigger("frameEnd")}catch(r){$s(r)}});function xi(){let r=S,i=E.drawingBufferWidth/r,s=E.drawingBufferHeight/r;if(t.letterbox){if(!t.width||!t.height)throw new Error("Letterboxing requires width and height defined.");let o=i/s,l=t.width/t.height;if(o>l){let u=s*l,m=(i-u)/2;w.viewport={x:m,y:0,width:u,height:s}}else{let u=i/l,m=(s-u)/2;w.viewport={x:0,y:m,width:i,height:u}}return}if(t.stretch&&(!t.width||!t.height))throw new Error("Stretching requires width and height defined.");w.viewport={x:0,y:0,width:i,height:s}}a(xi,"updateViewport");function Vi(){y.onHide(()=>{t.backgroundAudio||te.ctx.suspend()}),y.onShow(()=>{!t.backgroundAudio&&!me.paused&&te.ctx.resume()}),y.onResize(()=>{if(y.isFullscreen())return;let r=t.width&&t.height;r&&!t.stretch&&!t.letterbox||(n.width=n.offsetWidth*S,n.height=n.offsetHeight*S,xi(),r||(w.frameBuffer.free(),w.frameBuffer=new Qr(g,E.drawingBufferWidth,E.drawingBufferHeight),w.width=E.drawingBufferWidth/S,w.height=E.drawingBufferHeight/S))}),t.debug!==!1&&(y.onKeyPress("f1",()=>me.inspect=!me.inspect),y.onKeyPress("f2",()=>me.clearLog()),y.onKeyPress("f8",()=>me.paused=!me.paused),y.onKeyPress("f7",()=>{me.timeScale=$t(dt(me.timeScale-.2,0,2),1)}),y.onKeyPress("f9",()=>{me.timeScale=$t(dt(me.timeScale+.2,0,2),1)}),y.onKeyPress("f10",()=>me.stepFrame())),t.burp&&y.onKeyPress("b",()=>Xt())}a(Vi,"initEvents"),xi(),Vi();let It={VERSION:Co,loadRoot:Le,loadProgress:_,loadSprite:Je,loadSpriteAtlas:Fe,loadSound:Qt,loadBitmapFont:Tt,loadFont:tt,loadShader:lt,loadShaderURL:jt,loadAseprite:pt,loadPedit:it,loadBean:P,loadJSON:ye,load:De,getSprite:k,getSound:re,getFont:Y,getBitmapFont:se,getShader:Q,getAsset:ce,Asset:$e,SpriteData:j,SoundData:W,width:Ie,height:Ge,center:Tr,dt:ke,time:y.time,screenshot:y.screenshot,record:Gs,isFocused:Hs,setCursor:y.setCursor,getCursor:y.getCursor,setCursorLocked:y.setCursorLocked,isCursorLocked:y.isCursorLocked,setFullscreen:y.setFullscreen,isFullscreen:y.isFullscreen,isTouchscreen:y.isTouchscreen,onLoad:Yr,onLoading:Xs,onResize:Js,onGamepadConnect:y.onGamepadConnect,onGamepadDisconnect:y.onGamepadDisconnect,onError:Zs,onCleanup:_s,camPos:Xi,camScale:Ji,camRot:Zi,shake:$i,toScreen:li,toWorld:hi,setGravity:ns,getGravity:os,setBackground:as,getBackground:ls,getGamepads:y.getGamepads,add:Pr,make:Gr,destroy:zs,destroyAll:io,get:gi,readd:ro,pos:Mr,scale:Sr,rotate:hs,color:us,opacity:cs,anchor:Hr,area:ms,sprite:zr,text:ws,polygon:As,rect:ys,circle:xs,uvquad:vs,outline:Vs,body:Es,doubleJump:bs,shader:Rs,timer:Kr,fixed:Ms,stay:ci,health:Ss,lifespan:Ts,z:ds,move:ps,offscreen:gs,follow:fs,state:Ps,fadeIn:Ds,mask:Fs,drawon:Cs,tile:pi,agent:Os,on:ut,onUpdate:Jn,onDraw:Zn,onAdd:ui,onDestroy:_i,onClick:$n,onCollide:ki,onCollideUpdate:es,onCollideEnd:ts,onHover:rs,onHoverUpdate:is,onHoverEnd:ss,onKeyDown:y.onKeyDown,onKeyPress:y.onKeyPress,onKeyPressRepeat:y.onKeyPressRepeat,onKeyRelease:y.onKeyRelease,onMouseDown:y.onMouseDown,onMousePress:y.onMousePress,onMouseRelease:y.onMouseRelease,onMouseMove:y.onMouseMove,onCharInput:y.onCharInput,onTouchStart:y.onTouchStart,onTouchMove:y.onTouchMove,onTouchEnd:y.onTouchEnd,onScroll:y.onScroll,onHide:y.onHide,onShow:y.onShow,onGamepadButtonDown:y.onGamepadButtonDown,onGamepadButtonPress:y.onGamepadButtonPress,onGamepadButtonRelease:y.onGamepadButtonRelease,onGamepadStick:y.onGamepadStick,mousePos:Er,mouseDeltaPos:y.mouseDeltaPos,isKeyDown:y.isKeyDown,isKeyPressed:y.isKeyPressed,isKeyPressedRepeat:y.isKeyPressedRepeat,isKeyReleased:y.isKeyReleased,isMouseDown:y.isMouseDown,isMousePressed:y.isMousePressed,isMouseReleased:y.isMouseReleased,isMouseMoved:y.isMouseMoved,isGamepadButtonPressed:y.isGamepadButtonPressed,isGamepadButtonDown:y.isGamepadButtonDown,isGamepadButtonReleased:y.isGamepadButtonReleased,getGamepadStick:y.getGamepadStick,charInputted:y.charInputted,loop:so,wait:Ks,play:Wt,volume:Pt,burp:Xt,audioCtx:te.ctx,Line:ir,Rect:ze,Circle:tn,Polygon:Fr,Vec2:M,Color:pe,Mat4:ot,Quad:Pe,RNG:yn,rand:Lr,randi:Oi,randSeed:vn,vec2:C,rgb:ue,hsl2rgb:fo,quad:xe,choose:Vn,chance:xn,lerp:ft,tween:mi,easings:Xr,map:xt,mapc:An,wave:Fi,deg2rad:at,rad2deg:wr,clamp:dt,testLineLine:rr,testRectRect:En,testRectLine:Rn,testRectPoint:Ur,testCirclePolygon:Sn,testLinePoint:Mn,testLineCircle:Gi,drawSprite:Or,drawText:ai,formatText:mt,drawRect:Be,drawLine:d,drawLines:b,drawTriangle:D,drawCircle:ee,drawEllipse:ne,drawUVQuad:nt,drawPolygon:Re,drawFormattedText:wt,drawMasked:xr,drawSubtracted:Vr,pushTransform:Ee,popTransform:Ae,pushTranslate:fe,pushScale:st,pushRotate:ge,pushMatrix:Zt,usePostEffect:Jt,makeCanvas:Ar,debug:me,scene:Bs,go:Is,onSceneLeave:Ls,addLevel:Ns,getData:Us,setData:di,download:ri,downloadJSON:Cn,downloadText:Ki,downloadBlob:Bi,plug:fi,ASCII_CHARS:ln,canvas:y.canvas,addKaboom:Ys,LEFT:M.LEFT,RIGHT:M.RIGHT,UP:M.UP,DOWN:M.DOWN,RED:pe.RED,GREEN:pe.GREEN,BLUE:pe.BLUE,YELLOW:pe.YELLOW,MAGENTA:pe.MAGENTA,CYAN:pe.CYAN,WHITE:pe.WHITE,BLACK:pe.BLACK,quit:ks,Event:et,EventHandler:Cr,EventController:tr};if(t.plugins&&t.plugins.forEach(fi),t.global!==!1)for(let r in It)window[r]=It[r];return t.focus!==!1&&y.canvas.focus(),It},"default");const V=32,He=40,Ht=300,ie=800,be=600,Qo=100,Wo=6,Xo=3,Jo=0,Zo=1,gn=2,$o=.5,Di=200,mn=3,_o=.5,ko=200,ea=600,wn=-350,vt={dirt:{name:"Dirt",value:0,color:[139,90,43],minDepth:0,maxDepth:300,rarity:.7},coal:{name:"Coal",value:10,color:[45,45,45],minDepth:0,maxDepth:100,rarity:.15},copper:{name:"Copper",value:25,color:[205,127,50],minDepth:20,maxDepth:120,rarity:.12},iron:{name:"Iron",value:40,color:[135,135,140],minDepth:40,maxDepth:150,rarity:.1},silver:{name:"Silver",value:75,color:[180,200,220],minDepth:80,maxDepth:200,rarity:.08},gold:{name:"Gold",value:150,color:[255,215,0],minDepth:120,maxDepth:250,rarity:.05},ruby:{name:"Ruby",value:300,color:[224,17,95],minDepth:180,maxDepth:280,rarity:.03},diamond:{name:"Diamond",value:600,color:[0,230,255],minDepth:220,maxDepth:300,rarity:.02},unobtainium:{name:"Unobtainium",value:1500,color:[180,80,255],minDepth:280,maxDepth:300,rarity:.01}},Ot={gas:{name:"Gas Pocket",damage:1,minDepth:60,color:[100,200,100,180],rarity:.03},hardrock:{name:"Hard Rock",damage:1,minDepth:100,color:[80,80,90],rarity:.05,drillMultiplier:3},lava:{name:"Lava",damage:2,minDepth:180,color:[255,100,0],rarity:.04},water:{name:"Water",damage:0,minDepth:120,color:[50,100,200,180],rarity:.03,slowdown:.5}},Me={drill:{name:"Drill Speed",levels:[{cost:0,value:1,desc:"Standard drill"},{cost:150,value:1.3,desc:"30% faster"},{cost:400,value:1.6,desc:"60% faster"},{cost:900,value:2,desc:"2x speed"},{cost:2e3,value:2.5,desc:"Blazing fast"}]},fuel:{name:"Fuel Tank",levels:[{cost:0,value:100,desc:"100 capacity"},{cost:120,value:150,desc:"150 capacity"},{cost:350,value:220,desc:"220 capacity"},{cost:800,value:320,desc:"320 capacity"},{cost:1800,value:450,desc:"450 capacity"}]},cargo:{name:"Cargo Hold",levels:[{cost:0,value:6,desc:"6 slots"},{cost:100,value:10,desc:"10 slots"},{cost:300,value:15,desc:"15 slots"},{cost:700,value:22,desc:"22 slots"},{cost:1500,value:30,desc:"30 slots"}]},hull:{name:"Hull Armor",levels:[{cost:0,value:3,desc:"3 HP"},{cost:200,value:5,desc:"5 HP"},{cost:500,value:8,desc:"8 HP"},{cost:1200,value:12,desc:"12 HP"}]},radar:{name:"Radar",levels:[{cost:0,value:0,desc:"No radar"},{cost:250,value:5,desc:"5 tile range"},{cost:600,value:10,desc:"10 tile range"},{cost:1200,value:20,desc:"Full screen"}]},teleporter:{name:"Teleporter",levels:[{cost:0,value:!1,desc:"Not installed"},{cost:2500,value:!0,desc:"Emergency return"}]}};function ta(t,e,n,h,p,f,S){t.scene("game",()=>{let B=n();(!B||B.length===0)&&(B=S(),h(B));const F=ie/2;let y=be/2,N=[];function E(){N.forEach(Y=>{Y&&Y.exists()&&Y.destroy()}),N=[];const P=g?g.pos.y:0,k=Math.max(0,Math.floor((P-be)/V)),re=Math.min(Ht,Math.floor((P+be)/V)+1);for(let Y=k;Y<re;Y++)for(let se=0;se<He;se++){const Q=B[Y][se];if(!Q||Q.type==="empty")continue;let ce="dirt";Q.type==="mineral"?ce=Q.mineral:Q.type==="hazard"?ce=Q.hazard:Q.type==="crystal"&&(ce="crystal");const Ne=t.add([t.sprite(ce),t.pos(se*V,(Y+1)*V),t.area(),t.body({isStatic:!0}),"tile",{tileX:se,tileY:Y,tileType:Q.type,mineral:Q.mineral,hazard:Q.hazard}]);N.push(Ne)}for(let Y=0;Y<He;Y++){const se=t.add([t.sprite("surface"),t.pos(Y*V,0),"surface"]);N.push(se)}f(N)}const g=t.add([t.sprite("player"),t.pos(He*V/2,0),t.area({shape:new t.Rect(t.vec2(4,4),24,24)}),t.body(),t.z(100),"player",{drilling:!1,drillDir:null,drillProgress:0,drillTarget:null,inWater:!1}]);window.player=g,E(),t.add([t.rect(V*3,V*2),t.pos(V*5,-V*2),t.area(),t.color(0,0,0,0),"shopArea"]),t.add([t.sprite("shop"),t.pos(V*5,-V*2),t.z(50)]),t.add([t.sprite("fuelstation"),t.pos(V*15,-V*2),t.z(50)]),t.add([t.rect(V*3,V*2),t.pos(V*15,-V*2),t.area(),t.color(0,0,0,0),"fuelArea"]),t.add([t.rect(V*3,V*2),t.pos(V*25,-V*2),t.area(),t.color(0,0,0,0),"depotArea"]);const w=document.createElement("canvas");w.width=V*3,w.height=V*2;const j=w.getContext("2d");j.fillStyle="#444",j.fillRect(0,16,96,48),j.fillStyle="#666",j.fillRect(8,8,80,12),j.fillStyle="#0F0",j.font="bold 12px sans-serif",j.fillText("DEPOT - SELL",12,18),t.loadSprite("depot",w.toDataURL()),t.add([t.sprite("depot"),t.pos(V*25,-V*2),t.z(50)]),g.onUpdate(()=>{const P=Math.max(be/2,g.pos.y);t.camPos(F,P);const k=Math.floor(g.pos.y/V);k>e.deepestDepth&&(e.deepestDepth=k),Math.abs(g.pos.y-y)>be/3&&(y=g.pos.y,E()),g.inWater=!1,N.forEach(re=>{re.hazard==="water"&&g.isColliding(re)&&(g.inWater=!0)}),g.pos.y<=V&&(e.teleporterUsed=!1)});function W(P){if(!P||e.fuel<=0)return;let k=.3/e.drillSpeed;P.hazard==="hardrock"&&(k*=Ot.hardrock.drillMultiplier),g.drilling=!0,g.drillTarget=P,g.drillProgress=0;const re=P.mineral?vt[P.mineral].color:[139,90,43],Y=t.onUpdate(()=>{if(!g.drilling){Y.cancel();return}g.drillProgress+=t.dt()/k,Math.random()<.2&&t.shake(1),Math.random()<.4&&Ve(P.pos.x+V/2,P.pos.y+V/2,re),g.drillProgress>=1&&(te(P),Y.cancel())})}function te(P){if(g.drilling=!1,e.fuel=Math.max(0,e.fuel-Zo),P.hazard&&H(P.hazard,P.pos),P.mineral&&P.mineral!=="dirt")if(e.cargo.length<e.cargoSize){e.cargo.push(P.mineral);const Q=vt[P.mineral];Tt(P.pos.x,P.pos.y,Q.color),Q.value>=75&&(Fe(`+${Q.name}! ($${Q.value})`,Q.color),t.shake(3))}else Fe("Cargo full!",[255,100,100]);if(P.tileType==="crystal"){e.hasCrystal=!0,t.shake(20);for(let Q=0;Q<50;Q++)t.add([t.rect(t.rand(4,10),t.rand(4,10)),t.pos(P.pos.x+V/2,P.pos.y+V/2),t.color(255,t.rand(0,100),255),t.opacity(1),t.move(t.vec2(t.rand(-1,1),t.rand(-1,1)).unit(),t.rand(100,400)),t.lifespan(1.5,{fade:.5}),t.z(95)]);Fe("CORE CRYSTAL ACQUIRED! Return to surface!",[255,0,255])}const k=P.tileY,re=P.tileX,Y=n();Y[k][re]={type:"empty",mineral:null,hazard:null},h(Y),t.shake(2),P.destroy(),g.pos.y=P.pos.y-V+4;const se=P.mineral?vt[P.mineral].color:[139,90,43];for(let Q=0;Q<6;Q++)Ve(P.pos.x+V/2,P.pos.y+V/2,se);e.fuel<=0&&g.pos.y>V*2&&T()}function H(P,k){const re=Ot[P];if(P==="gas"){t.shake(15);for(let Y=0;Y<20;Y++)tt(k.x+V/2,k.y+V/2);U(re.damage)}else P==="lava"&&(t.shake(10),U(re.damage),t.flash(t.RED))}function U(P){e.hp-=P,t.shake(8),t.flash(t.rgb(255,0,0)),Fe(`-${P} HP!`,[255,0,0]),e.hp<=0&&De()}function T(){e.money>=Di?(e.money-=Di,e.cargo=[],Fe(`Stranded! Rescue fee: $${Di}`,[255,165,0]),g.pos=t.vec2(He*V/2,0),e.fuel=e.maxFuel):_("STRANDED - Cannot afford rescue!")}function De(){e.deaths++,e.cargo=[],e.hp=e.maxHp,e.money=Math.floor(e.money*(1-_o)),e.fuel=e.maxFuel,g.pos=t.vec2(He*V/2,0),e.deaths>=mn?_("DESTROYED - Too many deaths!"):Fe(`Destroyed! Deaths: ${e.deaths}/${mn}`,[255,0,0])}function _(P){e.gameOver=!0,t.go("gameover",{reason:P,win:!1})}function Le(){e.won=!0;const P=Math.floor((Date.now()-e.startTime)/1e3);t.go("gameover",{reason:"VICTORY!",win:!0,time:P})}let ye=0;t.onUpdate(()=>{ye+=t.dt(),g.pos.y>V*2&&ye>.3&&(ye=0,Math.random()<.3&&t.add([t.rect(t.rand(2,4),t.rand(2,4)),t.pos(g.pos.x+t.rand(-100,100),g.pos.y-200),t.color(100,70,40),t.opacity(.4),t.move(t.DOWN,t.rand(30,80)),t.lifespan(3,{fade:1}),t.z(5)]))});function Ve(P,k,re){const Y=re||[139,90,43];for(let se=0;se<3;se++)t.add([t.rect(t.rand(3,6),t.rand(3,6)),t.pos(P+t.rand(-8,8),k+t.rand(-8,8)),t.color(Y[0],Y[1],Y[2]),t.opacity(1),t.move(t.vec2(t.rand(-1,1),t.rand(-1,.5)).unit(),t.rand(60,180)),t.lifespan(.6,{fade:.3}),t.z(90)])}function tt(P,k){t.add([t.rect(t.rand(4,8),t.rand(4,8)),t.pos(P,k),t.color(255,t.rand(100,200),0),t.opacity(1),t.move(t.vec2(t.rand(-1,1),t.rand(-1,1)).unit(),t.rand(100,300)),t.lifespan(.8,{fade:.4}),t.z(95)])}function Tt(P,k,re){for(let Y=0;Y<8;Y++)t.add([t.rect(4,4),t.pos(P+V/2,k+V/2),t.color(re[0],re[1],re[2]),t.opacity(1),t.move(t.vec2(t.rand(-1,1),t.rand(-1,0)).unit(),t.rand(80,200)),t.lifespan(.6,{fade:.3}),t.z(90)])}let rt=null;function Fe(P,k=[255,255,255]){rt&&rt.destroy(),rt=t.add([t.text(P,{size:20}),t.pos(ie/2,100),t.anchor("center"),t.color(k[0],k[1],k[2]),t.fixed(),t.z(200),t.lifespan(2,{fade:.5})])}let Ue=ko;t.onKeyDown("left",()=>{if(g.drilling)return;const P=g.inWater?Ue*.5:Ue;g.move(-P,0),lt()}),t.onKeyDown("a",()=>{if(g.drilling)return;const P=g.inWater?Ue*.5:Ue;g.move(-P,0),lt()}),t.onKeyDown("right",()=>{if(g.drilling)return;const P=g.inWater?Ue*.5:Ue;g.move(P,0),lt()}),t.onKeyDown("d",()=>{if(g.drilling)return;const P=g.inWater?Ue*.5:Ue;g.move(P,0),lt()}),t.onKeyDown("up",()=>{g.drilling||g.inWater||(g.move(0,wn),e.fuel=Math.max(0,e.fuel-gn*t.dt()),Math.random()<.5&&t.add([t.rect(6,6),t.pos(g.pos.x+16,g.pos.y+32),t.color(255,t.rand(100,200),0),t.opacity(.8),t.move(t.DOWN,t.rand(100,200)),t.lifespan(.3,{fade:.2}),t.z(80)]))}),t.onKeyDown("w",()=>{g.drilling||g.inWater||(g.move(0,wn),e.fuel=Math.max(0,e.fuel-gn*t.dt()))}),t.onKeyDown("down",()=>Je()),t.onKeyDown("s",()=>Je());function Je(P){if(g.drilling||e.fuel<=0)return;const k=Math.floor((g.pos.x+V/2)/V),re=Math.floor(g.pos.y/V);let Y=k,se=re;if(se<0||se>=Ht||Y<0||Y>=He)return;const Q=N.find(ce=>ce.tileX===Y&&ce.tileY===se);if(Q&&Q.tileType!=="empty"){if(Q.hazard==="lava"){U(Ot.lava.damage),t.shake(5);return}W(Q)}}t.onKeyDown("left",()=>it(-1)),t.onKeyDown("a",()=>it(-1)),t.onKeyDown("right",()=>it(1)),t.onKeyDown("d",()=>it(1));function it(P){if(g.drilling||e.fuel<=0)return;const k=Math.floor((g.pos.x+V/2)/V),re=Math.floor((g.pos.y+V/2)/V),Y=k+P,se=re;if(se<0||se>=Ht||Y<0||Y>=He)return;const Q=N.find(ce=>ce.tileX===Y&&ce.tileY===se);if(Q&&Q.tileType!=="empty"){if(Q.hazard==="lava"){U(Ot.lava.damage);return}W(Q)}}t.onKeyPress("space",()=>{if(e.hasTeleporter&&!e.teleporterUsed&&g.pos.y>V*2){e.teleporterUsed=!0,t.shake(20);for(let P=0;P<30;P++)t.add([t.rect(8,8),t.pos(g.pos.x+16,g.pos.y+16),t.color(100,200,255),t.opacity(1),t.move(t.vec2(t.rand(-1,1),t.rand(-1,1)).unit(),t.rand(200,400)),t.lifespan(.5,{fade:.3}),t.z(95)]);g.pos=t.vec2(He*V/2,0),Fe("TELEPORTED!",[100,200,255])}});let pt=0;function lt(){const P=t.time();P-pt>.1&&(e.fuel=Math.max(0,e.fuel-$o),pt=P)}g.onCollide("shopArea",()=>{(t.isKeyPressed("e")||t.isKeyPressed("enter"))&&t.go("shop")}),t.onKeyPress("e",()=>{g.pos.y<V&&g.pos.x>V*4&&g.pos.x<V*9&&t.go("shop"),g.pos.y<V&&g.pos.x>V*24&&g.pos.x<V*29&&jt(),e.hasCrystal&&g.pos.y<V&&Le()}),t.onUpdate(()=>{g.pos.y<V&&g.pos.x>V*14&&g.pos.x<V*19&&e.fuel<e.maxFuel&&(e.fuel=Math.min(e.maxFuel,e.fuel+50*t.dt()))});function jt(){if(e.cargo.length===0){Fe("No minerals to sell!",[255,255,0]);return}let P=0;e.cargo.forEach(k=>{P+=vt[k].value}),e.money+=P,e.totalEarned+=P,e.cargo=[],Fe(`Sold for $${P}!`,[0,255,0]),t.shake(5);for(let k=0;k<15;k++)t.add([t.rect(6,6),t.pos(g.pos.x+16,g.pos.y-20),t.color(255,215,0),t.opacity(1),t.move(t.vec2(t.rand(-1,1),t.rand(-1,0)).unit(),t.rand(100,250)),t.lifespan(.8,{fade:.4}),t.z(90)])}t.onDraw(()=>{t.drawRect({pos:t.vec2(0,0),width:ie,height:50,color:t.rgb(20,20,40),fixed:!0});const P=e.fuel/e.maxFuel,k=P<.2?t.rgb(255,0,0):P<.5?t.rgb(255,200,0):t.rgb(0,200,0);if(t.drawRect({pos:t.vec2(10,10),width:150,height:16,color:t.rgb(40,40,40),fixed:!0}),t.drawRect({pos:t.vec2(10,10),width:150*P,height:16,color:k,fixed:!0}),t.drawText({text:`FUEL: ${Math.floor(e.fuel)}/${e.maxFuel}`,pos:t.vec2(15,12),size:12,color:t.WHITE,fixed:!0}),P<.2&&Math.floor(t.time()*4)%2===0&&t.drawRect({pos:t.vec2(10,10),width:150,height:16,outline:{color:t.RED,width:2},fixed:!0}),t.drawText({text:`HP: ${e.hp}/${e.maxHp}`,pos:t.vec2(180,12),size:14,color:e.hp<=1?t.RED:t.WHITE,fixed:!0}),t.drawText({text:`$${e.money}`,pos:t.vec2(280,12),size:14,color:t.rgb(255,215,0),fixed:!0}),t.drawText({text:`CARGO: ${e.cargo.length}/${e.cargoSize}`,pos:t.vec2(360,12),size:14,color:e.cargo.length>=e.cargoSize?t.rgb(255,100,100):t.WHITE,fixed:!0}),e.cargo.length>0){let Q=360;const ce={};e.cargo.forEach(Ne=>{ce[Ne]=(ce[Ne]||0)+1}),Object.entries(ce).forEach(([Ne,Ce],Oe)=>{if(Oe<5){const Ke=vt[Ne].color;t.drawRect({pos:t.vec2(Q+Oe*18,30),width:14,height:14,color:t.rgb(Ke[0],Ke[1],Ke[2]),fixed:!0}),Ce>1&&t.drawText({text:`${Ce}`,pos:t.vec2(Q+Oe*18+2,31),size:10,color:t.WHITE,fixed:!0})}})}const re=Math.max(0,Math.floor(g.pos.y/V));let Y=t.WHITE;re>250?Y=t.rgb(255,0,255):re>150?Y=t.rgb(255,100,0):re>50?Y=t.rgb(255,200,0):re>0&&(Y=t.rgb(100,200,100)),t.drawText({text:`${re}m`,pos:t.vec2(500,12),size:16,color:Y,fixed:!0});const se=Math.min(1,re/300);t.drawRect({pos:t.vec2(ie-30,60),width:16,height:be-120,color:t.rgb(30,30,40),fixed:!0}),t.drawRect({pos:t.vec2(ie-30,60),width:16,height:(be-120)*se,color:Y,fixed:!0}),t.drawRect({pos:t.vec2(ie-34,60+(be-120)-4),width:24,height:4,color:t.rgb(255,0,255),fixed:!0}),e.hasCrystal&&t.drawText({text:"CRYSTAL!",pos:t.vec2(650,12),size:14,color:t.rgb(255,0,255),fixed:!0}),e.hasTeleporter&&!e.teleporterUsed&&t.drawText({text:"[SPACE] Teleport",pos:t.vec2(10,32),size:12,color:t.rgb(100,200,255),fixed:!0}),g.pos.y<V*2&&t.drawText({text:"SHOP [E]     FUEL (auto)     DEPOT [E]",pos:t.vec2(ie/2-150,be-30),size:12,color:t.rgb(150,150,150),fixed:!0}),e.radarRange>0&&Qt()});function Qt(){const P=Math.floor((g.pos.x+V/2)/V),k=Math.floor(g.pos.y/V),re=e.radarRange;for(let Y=-re;Y<=re;Y++)for(let se=-re;se<=re;se++){const Q=k+Y,ce=P+se;if(Q<0||Q>=Ht||ce<0||ce>=He)continue;const Ce=n()[Q][ce];if(Ce&&Ce.type==="mineral"&&Ce.mineral!=="dirt"){const Oe=vt[Ce.mineral],Ke=ce*V-t.camPos().x+ie/2,Pt=(Q+1)*V-t.camPos().y+be/2;t.drawCircle({pos:t.vec2(Ke+V/2,Pt+V/2),radius:4,color:t.rgb(Oe.color[0],Oe.color[1],Oe.color[2]),opacity:.7,fixed:!1})}if(Ce&&Ce.type==="hazard"){Ot[Ce.hazard];const Oe=ce*V-t.camPos().x+ie/2,Ke=(Q+1)*V-t.camPos().y+be/2;t.drawCircle({pos:t.vec2(Oe+V/2,Ke+V/2),radius:5,color:t.rgb(255,0,0),opacity:.5,fixed:!1})}}}g.onUpdate(()=>{g.pos.x<0&&(g.pos.x=0),g.pos.x>He*V-V&&(g.pos.x=He*V-V),g.pos.y<-V*3&&(g.pos.y=-V*3)})}),t.scene("gameover",({reason:B,win:F,time:y})=>{t.add([t.rect(ie,be),t.pos(0,0),t.color(F?15:40,F?25:15,35),t.fixed()]),F&&t.loop(.1,()=>{t.add([t.rect(t.rand(4,10),t.rand(4,10)),t.pos(t.rand(0,ie),-20),t.color(t.rand(200,255),t.rand(150,255),t.rand(0,100)),t.opacity(t.rand(.6,1)),t.move(t.DOWN,t.rand(80,200)),t.lifespan(5,{fade:1}),t.fixed()])});const N=t.add([t.text(F?"VICTORY!":"GAME OVER",{size:56}),t.pos(ie/2,100),t.anchor("center"),t.color(255,F?215:50,F?0:50),t.fixed()]);if(F){let W=0;N.onUpdate(()=>{W+=t.dt()*5,N.scale=1+Math.sin(W)*.05})}t.add([t.text(B,{size:22}),t.pos(ie/2,165),t.anchor("center"),t.color(200,200,200),t.fixed()]),[`Time: ${y?Math.floor(y/60)+":"+String(y%60).padStart(2,"0"):"N/A"}`,`Deepest Depth: ${e.deepestDepth}m`,`Total Money Earned: $${e.totalEarned}`,`Deaths: ${e.deaths}`].forEach((W,te)=>{t.add([t.text(W,{size:18}),t.pos(ie/2,230+te*32),t.anchor("center"),t.color(180,180,180),t.fixed()])});let g="";F?y&&y<1200?g="Speed runner! Amazing time!":e.deaths===0?g="Flawless victory!":e.totalEarned>1e4?g="Master miner!":g="The core is yours!":e.deepestDepth<50?g="Just getting started...":e.deepestDepth<150?g="Getting deeper!":e.deepestDepth<250?g="So close to the core!":g="Almost had it!",t.add([t.text(g,{size:16}),t.pos(ie/2,380),t.anchor("center"),t.color(F?255:150,F?200:150,F?100:150),t.fixed()]);const w=t.add([t.text("Press ENTER to play again",{size:20}),t.pos(ie/2,450),t.anchor("center"),t.color(100,200,100),t.fixed()]);let j=0;w.onUpdate(()=>{j+=t.dt()*3,w.opacity=.6+Math.sin(j)*.4}),t.add([t.text("Press ESC for title screen",{size:14}),t.pos(ie/2,490),t.anchor("center"),t.color(120,120,120),t.fixed()]),t.onKeyPress("enter",()=>{e.money=0,e.fuel=Me.fuel.levels[0].value,e.maxFuel=Me.fuel.levels[0].value,e.hp=Me.hull.levels[0].value,e.maxHp=Me.hull.levels[0].value,e.cargo=[],e.cargoSize=Me.cargo.levels[0].value,e.drillSpeed=Me.drill.levels[0].value,e.radarRange=0,e.hasTeleporter=!1,e.teleporterUsed=!1,e.upgradeLevels={drill:0,fuel:0,cargo:0,hull:0,radar:0,teleporter:0},e.deaths=0,e.deepestDepth=0,e.totalEarned=0,e.startTime=Date.now(),e.hasCrystal=!1,e.gameOver=!1,e.won=!1,h(S()),t.go("game")}),t.onKeyPress("escape",()=>{e.money=0,e.fuel=Me.fuel.levels[0].value,e.maxFuel=Me.fuel.levels[0].value,e.hp=Me.hull.levels[0].value,e.maxHp=Me.hull.levels[0].value,e.cargo=[],e.cargoSize=Me.cargo.levels[0].value,e.drillSpeed=Me.drill.levels[0].value,e.radarRange=0,e.hasTeleporter=!1,e.teleporterUsed=!1,e.upgradeLevels={drill:0,fuel:0,cargo:0,hull:0,radar:0,teleporter:0},e.deaths=0,e.deepestDepth=0,e.totalEarned=0,e.hasCrystal=!1,e.gameOver=!1,e.won=!1,h(S()),t.go("title")})})}function ra(t,e){t.scene("shop",()=>{let n=0;const h=["drill","fuel","cargo","hull","radar","teleporter"];t.add([t.rect(ie,be),t.pos(0,0),t.color(30,25,35),t.fixed()]),t.add([t.text("UPGRADE SHOP",{size:36}),t.pos(ie/2,40),t.anchor("center"),t.color(255,215,0),t.fixed()]),t.add([t.text(`Your Money: $${e.money}`,{size:20}),t.pos(ie/2,80),t.anchor("center"),t.color(100,255,100),t.fixed()]),t.add([t.text("Arrow Keys to select, ENTER to buy, ESC to exit",{size:14}),t.pos(ie/2,be-30),t.anchor("center"),t.color(150,150,150),t.fixed()]),h.forEach((F,y)=>{const N=Me[F],E=e.upgradeLevels[F],g=E+1,w=g<N.levels.length,j=w?N.levels[g]:null,W=130+y*70;t.add([t.rect(700,60),t.pos(ie/2,W),t.anchor("center"),t.color(50,45,55),t.outline(2,t.rgb(70,65,75)),t.fixed(),{upgradeKey:F,index:y}]),t.add([t.text(N.name,{size:18}),t.pos(80,W-15),t.color(255,255,255),t.fixed()]),t.add([t.text(`Level ${E+1}/${N.levels.length}`,{size:14}),t.pos(80,W+10),t.color(150,150,150),t.fixed()]);const te=N.levels[E];if(t.add([t.text(`Current: ${te.desc}`,{size:14}),t.pos(250,W-10),t.color(180,180,180),t.fixed()]),w){t.add([t.text(`Next: ${j.desc}`,{size:14}),t.pos(250,W+10),t.color(100,200,100),t.fixed()]);const H=e.money>=j.cost;t.add([t.text(`$${j.cost}`,{size:20}),t.pos(550,W),t.anchor("center"),t.color(H?100:255,H?255:100,100),t.fixed()])}else t.add([t.text("MAX LEVEL",{size:16}),t.pos(550,W),t.anchor("center"),t.color(255,215,0),t.fixed()])});const p=t.add([t.rect(710,66),t.pos(ie/2,130),t.anchor("center"),t.color(0,0,0,0),t.outline(3,t.rgb(255,215,0)),t.fixed()]);function f(){p.pos.y=130+n*70}t.onKeyPress("up",()=>{n=(n-1+h.length)%h.length,f()}),t.onKeyPress("down",()=>{n=(n+1)%h.length,f()}),t.onKeyPress("enter",()=>{const F=h[n],y=Me[F],E=e.upgradeLevels[F]+1;if(E>=y.levels.length){B("Already at max level!",[255,200,0]);return}const g=y.levels[E].cost;if(e.money<g){B("Not enough money!",[255,100,100]),t.shake(3);return}e.money-=g,e.upgradeLevels[F]=E;const w=y.levels[E].value;switch(F){case"drill":e.drillSpeed=w;break;case"fuel":e.maxFuel=w,e.fuel=w;break;case"cargo":e.cargoSize=w;break;case"hull":e.maxHp=w,e.hp=w;break;case"radar":e.radarRange=w;break;case"teleporter":e.hasTeleporter=w;break}B("Purchased!",[100,255,100]),t.shake(5);for(let j=0;j<20;j++)t.add([t.rect(8,8),t.pos(ie/2+t.rand(-100,100),130+n*70),t.color(255,215,0),t.opacity(1),t.move(t.vec2(t.rand(-1,1),t.rand(-1,0)).unit(),t.rand(100,300)),t.lifespan(.8,{fade:.4}),t.fixed()]);t.go("shop")});let S=null;function B(F,y){S&&S.destroy(),S=t.add([t.text(F,{size:24}),t.pos(ie/2,be-80),t.anchor("center"),t.color(y[0],y[1],y[2]),t.fixed(),t.lifespan(1.5,{fade:.5})])}t.onKeyPress("escape",()=>{t.go("game")}),t.onKeyPress("e",()=>{t.go("game")})})}const L=jo({width:ie,height:be,background:[26,26,46],global:!1,crisp:!0,scale:1});window.k=L;L.setGravity(ea);const Nr={money:Jo,fuel:Qo,maxFuel:Me.fuel.levels[0].value,hp:Xo,maxHp:Me.hull.levels[0].value,cargo:[],cargoSize:Wo,drillSpeed:Me.drill.levels[0].value,radarRange:Me.radar.levels[0].value,hasTeleporter:!1,teleporterUsed:!1,upgradeLevels:{drill:0,fuel:0,cargo:0,hull:0,radar:0,teleporter:0},deaths:0,deepestDepth:0,totalEarned:0,startTime:Date.now(),hasCrystal:!1,gameOver:!1,won:!1};window.gameState=Nr;function ia(){const t=document.createElement("canvas");t.width=V,t.height=V;const e=t.getContext("2d");e.fillStyle="#FFD700",e.fillRect(4,4,24,20),e.fillStyle="#4169E1",e.fillRect(8,6,16,10),e.fillStyle="#888",e.beginPath(),e.moveTo(16,24),e.lineTo(8,32),e.lineTo(24,32),e.closePath(),e.fill(),e.fillStyle="#333",e.fillRect(2,20,8,6),e.fillRect(22,20,8,6),L.loadSprite("player",t.toDataURL()),Object.entries(vt).forEach(([W,te])=>{const H=document.createElement("canvas");H.width=V,H.height=V;const U=H.getContext("2d");if(U.fillStyle=`rgb(${te.color[0]}, ${te.color[1]}, ${te.color[2]})`,U.fillRect(0,0,V,V),W!=="dirt")U.fillStyle="rgba(255, 255, 255, 0.3)",U.beginPath(),U.moveTo(8,16),U.lineTo(16,8),U.lineTo(24,16),U.lineTo(16,24),U.closePath(),U.fill(),U.fillStyle="rgba(255, 255, 255, 0.6)",U.fillRect(14,10,4,4);else{U.fillStyle="rgba(0, 0, 0, 0.2)";for(let T=0;T<5;T++){const De=Math.random()*28+2,_=Math.random()*28+2;U.fillRect(De,_,3,3)}}U.strokeStyle="rgba(0, 0, 0, 0.3)",U.strokeRect(0,0,V,V),L.loadSprite(W,H.toDataURL())}),Object.entries(Ot).forEach(([W,te])=>{const H=document.createElement("canvas");H.width=V,H.height=V;const U=H.getContext("2d");if(U.fillStyle=`rgba(${te.color[0]}, ${te.color[1]}, ${te.color[2]}, ${te.color[3]?te.color[3]/255:1})`,U.fillRect(0,0,V,V),W==="gas")U.fillStyle="rgba(150, 255, 150, 0.6)",U.beginPath(),U.arc(10,12,4,0,Math.PI*2),U.arc(22,18,3,0,Math.PI*2),U.arc(14,24,5,0,Math.PI*2),U.fill();else if(W==="lava")U.fillStyle="rgba(255, 200, 0, 0.7)",U.fillRect(4,4,24,6),U.fillStyle="rgba(255, 255, 100, 0.5)",U.fillRect(8,8,16,4);else if(W==="water"){U.strokeStyle="rgba(100, 150, 255, 0.5)",U.lineWidth=2;for(let T=0;T<3;T++)U.beginPath(),U.arc(16,16,6+T*5,0,Math.PI),U.stroke()}else W==="hardrock"&&(U.strokeStyle="rgba(50, 50, 60, 0.8)",U.lineWidth=2,U.beginPath(),U.moveTo(8,8),U.lineTo(16,16),U.lineTo(12,24),U.moveTo(16,16),U.lineTo(26,20),U.stroke());L.loadSprite(W,H.toDataURL())});const n=document.createElement("canvas");n.width=V,n.height=V;const h=n.getContext("2d"),p=h.createRadialGradient(16,16,0,16,16,16);p.addColorStop(0,"rgba(255, 100, 255, 1)"),p.addColorStop(.5,"rgba(200, 50, 255, 0.8)"),p.addColorStop(1,"rgba(150, 0, 200, 0.4)"),h.fillStyle=p,h.fillRect(0,0,V,V),h.fillStyle="#FF00FF",h.beginPath(),h.moveTo(16,4),h.lineTo(26,12),h.lineTo(24,26),h.lineTo(8,26),h.lineTo(6,12),h.closePath(),h.fill(),h.fillStyle="rgba(255, 255, 255, 0.7)",h.beginPath(),h.moveTo(14,8),h.lineTo(18,12),h.lineTo(14,16),h.lineTo(10,12),h.closePath(),h.fill(),L.loadSprite("crystal",n.toDataURL());const f=document.createElement("canvas");f.width=V,f.height=V;const S=f.getContext("2d");S.fillStyle="#1a1a2e",S.fillRect(0,0,V,V),L.loadSprite("empty",f.toDataURL());const B=document.createElement("canvas");B.width=V,B.height=V;const F=B.getContext("2d");F.fillStyle="#3d6b3d",F.fillRect(0,0,V,V),F.fillStyle="#2d5a2d",F.fillRect(0,24,V,8),F.fillStyle="#4a8b4a";for(let W=0;W<8;W++)F.fillRect(W*4+2,0,2,6);L.loadSprite("surface",B.toDataURL());const y=document.createElement("canvas");y.width=V*2,y.height=V*2;const N=y.getContext("2d");N.fillStyle="#654321",N.fillRect(8,16,48,48),N.fillStyle="#8B4513",N.beginPath(),N.moveTo(4,16),N.lineTo(32,0),N.lineTo(60,16),N.closePath(),N.fill(),N.fillStyle="#333",N.fillRect(24,36,16,28),N.fillStyle="#FFD700",N.font="bold 10px sans-serif",N.fillText("SHOP",18,30),L.loadSprite("shop",y.toDataURL());const E=document.createElement("canvas");E.width=V*2,E.height=V*2;const g=E.getContext("2d");g.fillStyle="#C00",g.fillRect(16,20,32,44),g.fillStyle="#333",g.fillRect(20,24,24,16),g.fillStyle="#0F0",g.font="bold 10px monospace",g.fillText("FUEL",22,36),g.fillStyle="#666",g.fillRect(40,44,16,6),L.loadSprite("fuelstation",E.toDataURL());const w=document.createElement("canvas");w.width=8,w.height=8;const j=w.getContext("2d");j.fillStyle="#FFF",j.beginPath(),j.arc(4,4,3,0,Math.PI*2),j.fill(),L.loadSprite("particle",w.toDataURL())}function sa(){const t=[];for(let n=0;n<Ht;n++){const h=[],p=n;let f=.85;p>250?f=.4:p>150?f=.55:p>50&&(f=.7);for(let S=0;S<He;S++){if(n===0){h.push({type:"empty",mineral:null,hazard:null});continue}if(n===Ht-1&&S===Math.floor(He/2)){h.push({type:"crystal",mineral:null,hazard:null});continue}if(Math.random()>f){h.push({type:"empty",mineral:null,hazard:null});continue}let B=null;for(const[g,w]of Object.entries(Ot))if(p>=w.minDepth&&Math.random()<w.rarity){B=g;break}if(B){h.push({type:"hazard",mineral:null,hazard:B});continue}let F="dirt";const y=Math.random();let N=0;const E=Object.entries(vt).filter(([g,w])=>p>=w.minDepth&&p<=w.maxDepth&&g!=="dirt").sort((g,w)=>g[1].rarity-w[1].rarity);for(const[g,w]of E)if(N+=w.rarity,y<N){F=g;break}h.push({type:"mineral",mineral:F,hazard:null})}t.push(h)}let e=Math.floor(He/2);for(let n=1;n<Ht-1;n++)n%10===0&&(e=Math.max(2,Math.min(He-3,e+Math.floor(Math.random()*5)-2))),t[n][e].type!=="crystal"&&(t[n][e]={type:"mineral",mineral:"dirt",hazard:null});return t}let Ui=[],Ni=[];window.getWorld=()=>Ui;window.getWorldObjects=()=>Ni;ia();ta(L,Nr,()=>Ui,t=>{Ui=t},()=>Ni,t=>{Ni=t},sa);ra(L,Nr);L.scene("title",()=>{L.add([L.rect(ie,be),L.pos(0,0),L.color(20,15,30),L.fixed()]);for(let f=0;f<30;f++){const S=L.add([L.rect(L.rand(2,6),L.rand(10,30)),L.pos(L.rand(0,ie),L.rand(0,be)),L.color(139,90,43),L.opacity(L.rand(.2,.5)),L.fixed(),{speed:L.rand(20,60)}]);S.onUpdate(()=>{S.pos.y+=S.speed*L.dt(),S.pos.y>be&&(S.pos.y=-30,S.pos.x=L.rand(0,ie))})}const t=L.add([L.text("DEEP DRILL",{size:64}),L.pos(ie/2,120),L.anchor("center"),L.color(255,215,0),L.fixed()]);L.add([L.text("A Motherload-style Mining Game",{size:20}),L.pos(ie/2,180),L.anchor("center"),L.color(150,150,150),L.fixed()]),["Arrow Keys / WASD - Move","Down / S - Drill","Up / W - Fly (uses 2x fuel)","E - Shop / Sell at Depot","Space - Emergency Teleport (when unlocked)"].forEach((f,S)=>{L.add([L.text(f,{size:16}),L.pos(ie/2,260+S*28),L.anchor("center"),L.color(180,180,180),L.fixed()])}),L.add([L.text("GOAL: Reach 300m depth, collect the Core Crystal, and return!",{size:18}),L.pos(ie/2,430),L.anchor("center"),L.color(255,100,255),L.fixed()]);const n=L.add([L.text("Press ENTER or SPACE to start",{size:24}),L.pos(ie/2,520),L.anchor("center"),L.color(100,255,100),L.fixed()]);let h=0;n.onUpdate(()=>{h+=L.dt()*3,n.opacity=.6+Math.sin(h)*.4});let p=0;t.onUpdate(()=>{p+=L.dt()*2,t.pos.y=120+Math.sin(p)*5}),L.onKeyPress("enter",()=>{Nr.startTime=Date.now(),L.go("game")}),L.onKeyPress("space",()=>{Nr.startTime=Date.now(),L.go("game")})});L.go("title");
