(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function i(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=i(s);fetch(s.href,r)}})();const o=32,m=800,D=600,x=40,P=310,B=100,oe=6,V=3,se=0,ae=1,ne=2,fe=.5,Y=200,Q=.5,v=3,h={EMPTY:0,DIRT:1,COAL:2,COPPER:3,IRON:4,SILVER:5,GOLD:6,RUBY:7,DIAMOND:8,UNOBTAINIUM:9,GAS_POCKET:10,HARD_ROCK:11,LAVA:12,WATER:13,CORE_CRYSTAL:14,SURFACE:15,SHOP:16,FUEL_STATION:17},C={[h.DIRT]:{minDepth:0,maxDepth:300,value:0,color:"#8B4513",rarity:0,name:"Dirt"},[h.COAL]:{minDepth:0,maxDepth:100,value:10,color:"#2d2d2d",rarity:.3,name:"Coal"},[h.COPPER]:{minDepth:20,maxDepth:120,value:25,color:"#CD7F32",rarity:.35,name:"Copper"},[h.IRON]:{minDepth:40,maxDepth:150,value:40,color:"#71797E",rarity:.4,name:"Iron"},[h.SILVER]:{minDepth:80,maxDepth:200,value:75,color:"#C0C0C0",rarity:.5,name:"Silver"},[h.GOLD]:{minDepth:120,maxDepth:250,value:150,color:"#FFD700",rarity:.6,name:"Gold"},[h.RUBY]:{minDepth:180,maxDepth:280,value:300,color:"#E0115F",rarity:.7,name:"Ruby"},[h.DIAMOND]:{minDepth:220,maxDepth:300,value:600,color:"#00FFFF",rarity:.8,name:"Diamond"},[h.UNOBTAINIUM]:{minDepth:280,maxDepth:300,value:1500,color:"#9400D3",rarity:.95,name:"Unobtainium"}},X={[h.GAS_POCKET]:{minDepth:60,color:"#7CFC00",damage:1,name:"Gas Pocket"},[h.HARD_ROCK]:{minDepth:100,color:"#3d3d3d",damage:1,name:"Hard Rock",drillTime:3},[h.LAVA]:{minDepth:180,color:"#FF4500",damage:2,name:"Lava"},[h.WATER]:{minDepth:120,color:"#1E90FF",damage:0,name:"Water",slowdown:.5}},N={drill:{1:{cost:0,speed:1},2:{cost:150,speed:1.3},3:{cost:400,speed:1.6},4:{cost:900,speed:2},5:{cost:2e3,speed:2.5}},tank:{1:{cost:0,capacity:100},2:{cost:120,capacity:150},3:{cost:350,capacity:220},4:{cost:800,capacity:320},5:{cost:1800,capacity:450}},cargo:{1:{cost:0,slots:6},2:{cost:100,slots:10},3:{cost:300,slots:15},4:{cost:700,slots:22},5:{cost:1500,slots:30}},hull:{1:{cost:0,hp:3},2:{cost:200,hp:5},3:{cost:500,hp:8},4:{cost:1200,hp:12}},radar:{0:{cost:0,range:0},1:{cost:250,range:5},2:{cost:600,range:10},3:{cost:1200,range:999}},teleporter:{0:{cost:0,enabled:!1},1:{cost:2500,enabled:!0}}},he={background:"#0a0a15"};class ce{constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.width=t.width,this.height=t.height,this.shakeAmount=0,this.shakeDecay=.9}clear(t="#0a0a15"){this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.width,this.height)}shake(t){this.shakeAmount=Math.max(this.shakeAmount,t)}applyShake(){if(this.shakeAmount>.5){const t=(Math.random()-.5)*this.shakeAmount,i=(Math.random()-.5)*this.shakeAmount;this.ctx.translate(t,i),this.shakeAmount*=this.shakeDecay}else this.shakeAmount=0}resetTransform(){this.ctx.setTransform(1,0,0,1,0,0)}drawRect(t,i,n,s,r){this.ctx.fillStyle=r,this.ctx.fillRect(t,i,n,s)}drawTile(t,i,n,s){const r=t*o-s.x,a=i*o-s.y;r+o<0||r>this.width||a+o<0||a>this.height||(this.ctx.fillStyle=n,this.ctx.fillRect(r,a,o,o))}drawTileWithBorder(t,i,n,s,r){const a=t*o-r.x,c=i*o-r.y;a+o<0||a>this.width||c+o<0||c>this.height||(this.ctx.fillStyle=n,this.ctx.fillRect(a,c,o,o),this.ctx.strokeStyle=s,this.ctx.lineWidth=1,this.ctx.strokeRect(a+.5,c+.5,o-1,o-1))}drawText(t,i,n,s="#ffffff",r="16px Courier New",a="left"){this.ctx.fillStyle=s,this.ctx.font=r,this.ctx.textAlign=a,this.ctx.textBaseline="top",this.ctx.fillText(t,i,n)}drawRoundedRect(t,i,n,s,r,a){this.ctx.fillStyle=a,this.ctx.beginPath(),this.ctx.roundRect(t,i,n,s,r),this.ctx.fill()}drawProgressBar(t,i,n,s,r,a,c,d,u=null){this.ctx.fillStyle=d,this.ctx.fillRect(t,i,n,s);const S=r/a*n;this.ctx.fillStyle=c,this.ctx.fillRect(t,i,S,s),u&&(this.ctx.strokeStyle=u,this.ctx.lineWidth=2,this.ctx.strokeRect(t,i,n,s))}drawCircle(t,i,n,s){this.ctx.fillStyle=s,this.ctx.beginPath(),this.ctx.arc(t,i,n,0,Math.PI*2),this.ctx.fill()}drawGlow(t,i,n,s,r=1){const a=this.ctx.createRadialGradient(t,i,0,t,i,n);a.addColorStop(0,s),a.addColorStop(1,"transparent"),this.ctx.globalAlpha=r,this.ctx.fillStyle=a,this.ctx.beginPath(),this.ctx.arc(t,i,n,0,Math.PI*2),this.ctx.fill(),this.ctx.globalAlpha=1}}class de{constructor(){this.keys={},this.keysJustPressed={},this.keysJustReleased={},this.setupListeners()}setupListeners(){window.addEventListener("keydown",t=>{this.keys[t.code]||(this.keysJustPressed[t.code]=!0),this.keys[t.code]=!0,["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space","KeyW","KeyA","KeyS","KeyD"].includes(t.code)&&t.preventDefault()}),window.addEventListener("keyup",t=>{this.keys[t.code]=!1,this.keysJustReleased[t.code]=!0}),window.addEventListener("blur",()=>{this.keys={}})}isDown(t){return!!this.keys[t]}isUp(){return this.isDown("ArrowUp")||this.isDown("KeyW")}isDownKey(){return this.isDown("ArrowDown")||this.isDown("KeyS")}isLeft(){return this.isDown("ArrowLeft")||this.isDown("KeyA")}isRight(){return this.isDown("ArrowRight")||this.isDown("KeyD")}isSpace(){return this.isDown("Space")}justPressed(t){return!!this.keysJustPressed[t]}justPressedSpace(){return this.justPressed("Space")}justPressedEnter(){return this.justPressed("Enter")}justPressedEscape(){return this.justPressed("Escape")}update(){this.keysJustPressed={},this.keysJustReleased={}}}class pe{constructor(){this.x=0,this.y=0,this.targetX=0,this.targetY=0,this.smoothing=.1,this.minX=0,this.minY=-o*3,this.maxX=x*o-m,this.maxY=P*o-D}follow(t,i){this.targetX=t-m/2,this.targetY=i-D/2,this.targetX=Math.max(this.minX,Math.min(this.maxX,this.targetX)),this.targetY=Math.max(this.minY,Math.min(this.maxY,this.targetY))}update(t){const i=1-Math.pow(1-this.smoothing,t*60);this.x+=(this.targetX-this.x)*i,this.y+=(this.targetY-this.y)*i}isVisible(t,i){const n=t*o-this.x,s=i*o-this.y;return n+o>0&&n<m&&s+o>0&&s<D}getVisibleRange(){return{startX:Math.floor(this.x/o)-1,endX:Math.ceil((this.x+m)/o)+1,startY:Math.floor(this.y/o)-1,endY:Math.ceil((this.y+D)/o)+1}}worldToScreen(t,i){return{x:t-this.x,y:i-this.y}}screenToWorld(t,i){return{x:t+this.x,y:i+this.y}}}class ue{constructor(t,i,n,s,r,a,c,d=0,u=!0){this.x=t,this.y=i,this.vx=n,this.vy=s,this.color=r,this.size=a,this.maxLife=c,this.life=c,this.gravity=d,this.fadeOut=u,this.dead=!1}update(t){this.vy+=this.gravity*t,this.x+=this.vx*t,this.y+=this.vy*t,this.life-=t,this.life<=0&&(this.dead=!0)}draw(t,i){if(this.dead)return;const n=this.x-i.x,s=this.y-i.y;n<-this.size||n>t.canvas.width+this.size||s<-this.size||s>t.canvas.height+this.size||(t.globalAlpha=this.fadeOut?this.life/this.maxLife:1,t.fillStyle=this.color,t.fillRect(n-this.size/2,s-this.size/2,this.size,this.size),t.globalAlpha=1)}}class ye{constructor(){this.particles=[],this.maxParticles=500}emit(t,i,n,s){for(let r=0;r<n&&this.particles.length<this.maxParticles;r++){const a=s.angle+(Math.random()-.5)*s.spread,c=s.speed*(.5+Math.random()*.5),d=Math.cos(a)*c,u=Math.sin(a)*c,S=s.size*(.5+Math.random()*.5),F=s.life*(.5+Math.random()*.5),g=Array.isArray(s.colors)?s.colors[Math.floor(Math.random()*s.colors.length)]:s.colors;this.particles.push(new ue(t,i,d,u,g,S,F,s.gravity||0,s.fadeOut!==!1))}}drillDirt(t,i){this.emit(t,i,8,{angle:-Math.PI/2,spread:Math.PI,speed:100,size:4,life:.4,colors:["#8B4513","#A0522D","#6B3E08"],gravity:200})}drillMineral(t,i,n){this.emit(t,i,12,{angle:-Math.PI/2,spread:Math.PI,speed:120,size:5,life:.5,colors:[n,"#ffffff"],gravity:150})}collectMineral(t,i,n){this.emit(t,i,15,{angle:0,spread:Math.PI*2,speed:80,size:4,life:.6,colors:[n,"#FFD700","#ffffff"],gravity:-50})}explosion(t,i,n="#FF4500"){this.emit(t,i,30,{angle:0,spread:Math.PI*2,speed:200,size:6,life:.5,colors:[n,"#FFFF00","#FF6600"],gravity:100})}fuelWarning(t,i){this.emit(t,i,5,{angle:-Math.PI/2,spread:.5,speed:50,size:3,life:.8,colors:["#FF0000","#FF4444","#FF8888"],gravity:-20})}thrust(t,i){this.emit(t,i,3,{angle:Math.PI/2,spread:.4,speed:80,size:4,life:.3,colors:["#FF6600","#FFAA00","#FFFF00"],gravity:50})}sparkle(t,i,n){this.emit(t,i,8,{angle:0,spread:Math.PI*2,speed:40,size:3,life:.8,colors:[n,"#ffffff"],gravity:-20})}update(t){for(let i=this.particles.length-1;i>=0;i--)this.particles[i].update(t),this.particles[i].dead&&this.particles.splice(i,1)}draw(t,i){for(const n of this.particles)n.draw(t,i)}clear(){this.particles=[]}}const A={MENU:"menu",PLAYING:"playing",SHOP:"shop",GAME_OVER:"game_over",VICTORY:"victory",STRANDED:"stranded"};function ee(){return{mode:A.MENU,player:{x:0,y:0,tileX:20,tileY:5,fuel:B,maxFuel:B,cargo:[],cargoCapacity:oe,money:se,hp:V,maxHp:V,deaths:0,isDrilling:!1,drillProgress:0,drillTarget:null,isFlying:!1,facingLeft:!1,teleportAvailable:!1,hasCoreCrystal:!1,moveCooldown:0},upgrades:{drill:1,tank:1,cargo:1,hull:1,radar:0,teleporter:0},world:[],camera:{x:0,y:0},stats:{startTime:0,totalMoney:0,mineralsCollected:0,deepestDepth:0,tripsCompleted:0},message:null,messageTimer:0,time:0,seed:Date.now()}}function _(e){e.player.fuel=e.player.maxFuel,e.player.tileX=20,e.player.tileY=5,e.player.x=e.player.tileX*32,e.player.y=e.player.tileY*32,e.player.isDrilling=!1,e.player.drillProgress=0,e.player.drillTarget=null,e.player.isFlying=!1,e.player.moveCooldown=0,e.upgrades.teleporter>=1&&(e.player.teleportAvailable=!0),e.stats.tripsCompleted++}function R(e,t,i=2){e.message=t,e.messageTimer=i}function me(e){return function(){let t=e+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}}function ge(e=Date.now()){const t=me(e),i=[];for(let a=0;a<P;a++){i[a]=[];for(let c=0;c<x;c++)i[a][c]=h.EMPTY}for(let a=0;a<7;a++)for(let c=0;c<x;c++)i[a][c]=h.SURFACE;i[6][18]=h.SHOP,i[6][19]=h.SHOP,i[6][20]=h.FUEL_STATION,i[6][21]=h.FUEL_STATION;for(let a=7;a<P;a++){const c=a-7;for(let d=0;d<x;d++){let u=h.DIRT;if(c>=10){const S=Math.min(.15,.02+(c-10)*4e-4);if(t()<S){u=h.EMPTY,i[a][d]=u;continue}}t();for(const[S,F]of Object.entries(C)){if(S==h.DIRT)continue;const g=parseInt(S);if(c>=F.minDepth&&c<=F.maxDepth){const y=1-Math.abs(c-(F.minDepth+F.maxDepth)/2)/((F.maxDepth-F.minDepth)/2),T=(1-F.rarity)*.15*y;if(t()<T){u=g;break}}}if(u===h.DIRT)for(const[S,F]of Object.entries(X)){const g=parseInt(S);if(c>=F.minDepth){const y=.02+(c-F.minDepth)*1e-4;if(t()<y){u=g;break}}}i[a][d]=u}}const n=P-3,s=Math.floor(x/2);for(let a=-2;a<=2;a++)for(let c=-3;c<=3;c++){const d=n+a,u=s+c;d>=7&&d<P&&u>=0&&u<x&&Math.abs(c)<=1&&Math.abs(a)<=1&&(i[d][u]=h.EMPTY)}i[n][s]=h.CORE_CRYSTAL;let r=15;for(let a=17;a<P-5;a+=10){for(let c=0;c<3;c++)i[a+c]&&i[a+c][r]&&i[a+c][r]!==h.LAVA&&(i[a+c][r]=h.EMPTY);r+=Math.floor(t()*7)-3,r=Math.max(3,Math.min(x-4,r))}return i}function O(e,t,i){return i<0||i>=P||t<0||t>=x?h.EMPTY:e[i][t]}function W(e,t,i,n){i>=0&&i<P&&t>=0&&t<x&&(e[i][t]=n)}function te(e){return Math.max(0,e-7)}function j(e){return e!==h.EMPTY&&e!==h.SURFACE&&e!==h.SHOP&&e!==h.FUEL_STATION}function U(e){return e>=h.COAL&&e<=h.UNOBTAINIUM}function Fe(e){return e===h.EMPTY||e===h.SURFACE||e===h.SHOP||e===h.FUEL_STATION}function Se(e,t=0){switch(e){case h.EMPTY:return"#0a0a15";case h.SURFACE:return"#2d5a27";case h.SHOP:return"#4a7a44";case h.FUEL_STATION:return"#4169E1";case h.DIRT:return"#8B4513";case h.CORE_CRYSTAL:const i=Math.sin(t*5)*.3+.7;return`rgb(${Math.floor(255*i)}, ${Math.floor(100*i)}, ${Math.floor(255*i)})`;default:if(C[e])return C[e].color;if(X[e]){if(e===h.LAVA){const n=Math.sin(t*3)*.2+.8;return`rgb(${Math.floor(255*n)}, ${Math.floor(69*n)}, 0)`}if(e===h.WATER){const n=Math.sin(t*2)*.15+.85;return`rgb(30, ${Math.floor(144*n)}, 255)`}return X[e].color}return"#FF00FF"}}function Te(e){switch(e){case h.DIRT:return"#6B3E08";case h.HARD_ROCK:return"#2d2d2d";default:return null}}function Ae(e){e.player.tileX=20,e.player.tileY=5,e.player.x=e.player.tileX*o,e.player.y=e.player.tileY*o,e.player.maxFuel=N.tank[e.upgrades.tank].capacity,e.player.fuel=e.player.maxFuel,e.player.cargoCapacity=N.cargo[e.upgrades.cargo].slots,e.player.maxHp=N.hull[e.upgrades.hull].hp,e.player.hp=e.player.maxHp,e.player.cargo=[],e.player.hasCoreCrystal=!1,e.upgrades.teleporter>=1&&(e.player.teleportAvailable=!0)}function Ee(e,t,i,n,s){var F;const r=e.player;if(e.mode===A.STRANDED)return;if(r.isDrilling&&r.drillTarget){const g=N.drill[e.upgrades.drill].speed,y=r.drillTarget,T=O(e.world,y.x,y.y);let p=.3/g;T===h.HARD_ROCK&&(p*=3),r.drillProgress+=s;const E=y.x*o+o/2,k=y.y*o+o/2;if(Math.random()<.3){const b=U(T)&&((F=C[T])==null?void 0:F.color)||"#8B4513";i.drillMineral(E,k,b)}r.drillProgress>=p&&(Re(e,y.x,y.y,i,n),r.isDrilling=!1,r.drillProgress=0,r.drillTarget=null);return}const a=.15;r.moveCooldown>0&&(r.moveCooldown-=s);let c=0,d=0;if(t.isLeft()?(c=-1,r.facingLeft=!0):t.isRight()&&(c=1,r.facingLeft=!1),t.isUp()?(d=-1,r.isFlying=!0):(t.isDownKey()&&(d=1),r.isFlying=!1),t.justPressedSpace()&&r.teleportAvailable&&e.upgrades.teleporter>=1){r.tileX=20,r.tileY=5,r.x=r.tileX*o,r.y=r.tileY*o,r.teleportAvailable=!1,R(e,"TELEPORTED TO SURFACE!",2),i.sparkle(r.x+o/2,r.y+o/2,"#00FFFF");return}if((c!==0||d!==0)&&r.moveCooldown<=0){const g=r.tileX+c,y=r.tileY+d,T=O(e.world,g,y);if(g<0||g>=e.world[0].length||d===-1&&j(T))return;if(j(T)){r.fuel>0?(r.isDrilling=!0,r.drillProgress=0,r.drillTarget={x:g,y},r.fuel-=ae,r.moveCooldown=a):z(e);return}const p=d===-1?ne:fe;if(r.fuel>=p){r.tileX=g,r.tileY=y,r.fuel-=p,r.moveCooldown=a,d===-1&&i.thrust(r.x+o/2,r.y+o),K(e,g,y,i,n),Ce(e,g,y);const E=te(r.tileY);E>e.stats.deepestDepth&&(e.stats.deepestDepth=E)}else z(e)}if(!r.isFlying&&!t.isUp()&&r.moveCooldown<=0){const g=O(e.world,r.tileX,r.tileY+1);Fe(g)&&(r.tileY+=1,r.moveCooldown=a,K(e,r.tileX,r.tileY,i,n))}const u=r.tileX*o,S=r.tileY*o;r.x+=(u-r.x)*.3,r.y+=(S-r.y)*.3}function Re(e,t,i,n,s){const r=e.player,a=O(e.world,t,i);if(a===h.GAS_POCKET){n.explosion(t*o+o/2,i*o+o/2),s.shake(15),r.hp-=1,R(e,"GAS EXPLOSION! -1 HP",1.5);for(let c=-1;c<=1;c++)for(let d=-1;d<=1;d++){const u=O(e.world,t+c,i+d);U(u)&&W(e.world,t+c,i+d,h.EMPTY)}le(e)}else if(a===h.HARD_ROCK)n.drillDirt(t*o+o/2,i*o+o/2),s.shake(3);else if(a===h.CORE_CRYSTAL){r.hasCoreCrystal=!0,s.shake(20);const c=t*o+o/2,d=i*o+o/2;n.sparkle(c,d,"#FF00FF"),n.sparkle(c,d,"#FFFFFF"),n.explosion(c,d,"#FF00FF"),R(e,"★★★ CORE CRYSTAL OBTAINED! ★★★",4)}else if(U(a))if(r.cargo.length<r.cargoCapacity){r.cargo.push(a),e.stats.mineralsCollected++;const c=t*o+o/2,d=i*o+o/2;n.collectMineral(c,d,C[a].color);const u=C[a].value;u>=300?(s.shake(8),n.sparkle(c,d,C[a].color),R(e,`★ ${C[a].name.toUpperCase()}! $${u} ★`,1.2)):u>=150?(s.shake(4),R(e,`${C[a].name}! $${u}`,1)):u>=75?(s.shake(2),R(e,`+${C[a].name} ($${u})`,.8)):R(e,`+${C[a].name}`,.6)}else R(e,"CARGO FULL!",1),n.drillDirt(t*o+o/2,i*o+o/2);W(e.world,t,i,h.EMPTY),r.tileX=t,r.tileY=i}function K(e,t,i,n,s){const r=O(e.world,t,i),a=e.player;r===h.LAVA?(a.hp-=2,s.shake(20),n.explosion(t*o+o/2,i*o+o/2,"#FF4500"),R(e,"LAVA! -2 HP",1.5),W(e.world,t,i,h.EMPTY),le(e)):r===h.WATER&&R(e,"WATER - SLOW MOVEMENT",1)}function Ce(e,t,i){const n=O(e.world,t,i),s=e.player;if(n===h.FUEL_STATION)s.fuel<s.maxFuel&&(s.fuel=s.maxFuel,R(e,"FUEL REFILLED!",1)),e.upgrades.teleporter>=1&&(s.teleportAvailable=!0);else if(n===h.SHOP){if(s.cargo.length>0){let r=0;for(const a of s.cargo)r+=C[a].value;s.money+=r,e.stats.totalMoney+=r,R(e,`SOLD FOR $${r}!`,1.5),s.cargo=[]}s.hasCoreCrystal&&(e.mode=A.VICTORY)}}function z(e){const t=e.player;t.fuel<=0&&t.tileY>6&&(e.mode=A.STRANDED,t.money>=Y?R(e,`STRANDED! RESCUE COSTS $${Y}`,3):R(e,"STRANDED! NO MONEY FOR RESCUE!",3))}function J(e,t){const i=e.player;t&&i.money>=Y?(i.money-=Y,i.cargo=[],_(e),e.mode=A.PLAYING,R(e,"RESCUED! CARGO LOST.",2)):(!t||i.money<Y)&&(i.deaths++,i.deaths>=v?e.mode=A.GAME_OVER:(i.money=Math.floor(i.money*Q),i.cargo=[],_(e),e.mode=A.PLAYING,R(e,`DEATH ${i.deaths}/${v} - 50% MONEY LOST`,2)))}function le(e){const t=e.player;t.hp<=0&&(t.deaths++,t.deaths>=v?(e.mode=A.GAME_OVER,R(e,"GAME OVER - DRILL DESTROYED",3)):(t.money=Math.floor(t.money*Q),t.cargo=[],t.hp=t.maxHp,_(e),R(e,`DESTROYED! ${t.deaths}/${v} DEATHS`,2)))}function G(e,t,i,n){const s=t.player,r=s.x-i.x,a=s.y-i.y;e.fillStyle="rgba(0, 0, 0, 0.3)",e.beginPath(),e.ellipse(r+o/2,a+o+2,10,4,0,0,Math.PI*2),e.fill();const c=e.createLinearGradient(r,a,r+o,a+o);c.addColorStop(0,"#FF8888"),c.addColorStop(.5,"#FF6B6B"),c.addColorStop(1,"#CC5555"),e.fillStyle=c,e.fillRect(r+4,a+6,o-8,o-12),e.strokeStyle="#AA4444",e.lineWidth=1,e.strokeRect(r+4,a+6,o-8,o-12),e.fillStyle="#4ECDC4",e.fillRect(r+8,a+8,o-16,8),e.fillStyle="rgba(255, 255, 255, 0.4)",e.fillRect(r+9,a+9,6,3),e.fillStyle="#333333",e.fillRect(r+2,a+o-10,6,8),e.fillRect(r+o-8,a+o-10,6,8);const d=s.isDrilling?Math.sin(n*30)*2:0,u=e.createLinearGradient(r+10,a,r+o-10,a);if(u.addColorStop(0,"#FFE066"),u.addColorStop(.5,"#FFD93D"),u.addColorStop(1,"#CCAA00"),e.fillStyle=u,e.beginPath(),e.moveTo(r+10,a+o-6),e.lineTo(r+o/2,a+o+d),e.lineTo(r+o-10,a+o-6),e.closePath(),e.fill(),s.isDrilling){e.strokeStyle="#AA8800",e.lineWidth=1;for(let F=0;F<3;F++){const g=(n*10+F*3)%6;e.beginPath(),e.moveTo(r+12,a+o-4+g),e.lineTo(r+o-12,a+o-4+g),e.stroke()}}if(s.isFlying)for(let F=0;F<2;F++){const g=F===0?r+8:r+o-14,y=8+Math.random()*6;e.fillStyle=`rgba(255, ${100+Math.random()*50}, 0, 0.8)`,e.beginPath(),e.moveTo(g,a+o-2),e.lineTo(g+3,a+o+y),e.lineTo(g+6,a+o-2),e.closePath(),e.fill(),e.fillStyle=`rgba(255, 255, ${150+Math.random()*100}, 0.9)`,e.beginPath(),e.moveTo(g+1,a+o-1),e.lineTo(g+3,a+o+y*.6),e.lineTo(g+5,a+o-1),e.closePath(),e.fill()}if(s.hasCoreCrystal){const F=Math.sin(n*8)*.3+.7;e.shadowColor="#FF00FF",e.shadowBlur=10,e.fillStyle=`rgba(255, 0, 255, ${F})`,e.beginPath(),e.arc(r+o/2,a-6,6,0,Math.PI*2),e.fill(),e.shadowBlur=0,e.fillStyle="#FFFFFF",e.beginPath(),e.arc(r+o/2-2,a-8,2,0,Math.PI*2),e.fill()}s.fuel/s.maxFuel<.2&&Math.sin(n*10)>0&&(e.fillStyle="#FF0000",e.shadowColor="#FF0000",e.shadowBlur=8,e.beginPath(),e.arc(r+o-4,a+4,4,0,Math.PI*2),e.fill(),e.shadowBlur=0,e.fillStyle="#FF0000",e.font="bold 10px Courier New",e.textAlign="center",e.fillText("!",r+o-4,a+7));const S=s.cargo.length/s.cargoCapacity;if(S>0){e.fillStyle=S>.8?"#FFAA00":"#44FF44";const F=Math.min(4,Math.ceil(S*4));for(let g=0;g<F;g++)e.beginPath(),e.arc(r+6+g*5,a+2,2,0,Math.PI*2),e.fill()}}function De(e,t,i){const s=e.upgrades[t]+1,r=N[t];if(!r[s])return R(e,"MAX LEVEL!",1),!1;const a=r[s].cost;if(e.player.money<a)return R(e,"NOT ENOUGH MONEY!",1),!1;switch(e.player.money-=a,e.upgrades[t]=s,t){case"tank":e.player.maxFuel=r[s].capacity,e.player.fuel=e.player.maxFuel;break;case"cargo":e.player.cargoCapacity=r[s].slots;break;case"hull":e.player.maxHp=r[s].hp,e.player.hp=e.player.maxHp;break;case"teleporter":e.player.teleportAvailable=!0;break}return R(e,`${t.toUpperCase()} UPGRADED TO LV${s}!`,1.5),i&&i.sparkle(400,300,"#FFD700"),!0}function we(e,t){const i=N[e],n=i[t],s=i[t+1];return{current:n,next:s,isMaxed:!s}}function Me(e,t,i,n){e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(150,100,500,400),e.strokeStyle="#FFD700",e.lineWidth=3,e.strokeRect(150,100,500,400),e.fillStyle="#FFD700",e.font="bold 28px Courier New",e.textAlign="center",e.fillText("UPGRADE SHOP",400,140),e.fillStyle="#44FF44",e.font="20px Courier New",e.fillText(`MONEY: $${t.player.money}`,400,170);const d=["drill","tank","cargo","hull","radar","teleporter"],u={drill:"DRILL SPEED",tank:"FUEL TANK",cargo:"CARGO HOLD",hull:"HULL ARMOR",radar:"MINERAL RADAR",teleporter:"EMERGENCY TP"},S=210,F=45;e.textAlign="left";for(let g=0;g<d.length;g++){const y=d[g],T=t.upgrades[y],p=we(y,T),E=S+g*F;if(g===i){e.fillStyle="rgba(255, 215, 0, 0.2)",e.fillRect(160,E-5,480,F-5);const k=Math.sin(n*8)*3;e.fillStyle="#FFD700",e.font="20px Courier New",e.fillText(">",170+k,E+18)}if(e.fillStyle=p.isMaxed?"#888888":"#FFFFFF",e.font="18px Courier New",e.fillText(`${u[y]}`,195,E+18),e.fillStyle="#4ECDC4",e.fillText(`LV${T}`,350,E+18),p.isMaxed)e.fillStyle="#888888",e.fillText("MAX",430,E+18);else{const k=t.player.money>=p.next.cost;e.fillStyle=k?"#44FF44":"#FF4444",e.fillText(`$${p.next.cost}`,430,E+18),e.fillStyle="#AAAAAA",e.font="14px Courier New";let b="";switch(y){case"drill":b=`${p.current.speed}x → ${p.next.speed}x speed`;break;case"tank":b=`${p.current.capacity} → ${p.next.capacity} fuel`;break;case"cargo":b=`${p.current.slots} → ${p.next.slots} slots`;break;case"hull":b=`${p.current.hp} → ${p.next.hp} HP`;break;case"radar":b=p.next.range===999?"Full screen":`${p.next.range} tile range`;break;case"teleporter":b="Return to surface (1/trip)";break}e.fillText(b,510,E+18)}}e.fillStyle="#888888",e.font="14px Courier New",e.textAlign="center",e.fillText("↑↓ SELECT   ENTER BUY   ESC CLOSE",400,480)}class xe{constructor(){this.selectedIndex=0,this.upgrades=["drill","tank","cargo","hull","radar","teleporter"]}update(t,i,n){if((i.justPressed("ArrowUp")||i.justPressed("KeyW"))&&(this.selectedIndex=(this.selectedIndex-1+this.upgrades.length)%this.upgrades.length),(i.justPressed("ArrowDown")||i.justPressed("KeyS"))&&(this.selectedIndex=(this.selectedIndex+1)%this.upgrades.length),i.justPressedEnter()){const s=this.upgrades[this.selectedIndex];De(t,s,n)}}draw(t,i,n){Me(t,i,this.selectedIndex,n)}}const Pe=document.getElementById("game"),$=new ce(Pe),l=$.ctx,w=new de,M=new pe,L=new ye,ie=new xe;let f=ee();window.gameState=f;window.gameReady=!0;function q(){const e=ee();e.world=ge(e.seed),e.stats.startTime=Date.now(),Object.assign(f,e),Ae(f),M.x=f.player.x-m/2,M.y=f.player.y-D/2}function be(e){switch(f.time+=e,f.messageTimer>0&&(f.messageTimer-=e,f.messageTimer<=0&&(f.message=null)),f.mode){case A.MENU:(w.justPressedEnter()||w.justPressedSpace())&&(f.mode=A.PLAYING,q(),f.mode=A.PLAYING);break;case A.PLAYING:if(O(f.world,f.player.tileX,f.player.tileY)===h.SHOP&&w.justPressedEnter()){f.mode=A.SHOP;break}Ee(f,w,L,$,e),M.follow(f.player.x+o/2,f.player.y+o/2),M.update(e),L.update(e),f.player.fuel/f.player.maxFuel<.2&&Math.random()<.1&&L.fuelWarning(f.player.x+o/2,f.player.y);break;case A.SHOP:ie.update(f,w,L),w.justPressedEscape()&&(f.mode=A.PLAYING),L.update(e);break;case A.STRANDED:w.justPressedEnter()?J(f,!0):w.justPressedEscape()&&J(f,!1);break;case A.GAME_OVER:(w.justPressedEnter()||w.justPressedSpace())&&(q(),f.mode=A.PLAYING);break;case A.VICTORY:(w.justPressedEnter()||w.justPressedSpace())&&(f.mode=A.MENU);break}w.update()}function I(){var c;const{startX:e,endX:t,startY:i,endY:n}=M.getVisibleRange(),s=((c=N.radar[f.upgrades.radar])==null?void 0:c.range)||0,r=f.player.tileX,a=f.player.tileY;for(let d=Math.max(0,i);d<Math.min(P,n);d++){const u=d*o-M.y;if(u>D||u+o<0)continue;const S=Math.max(0,d-7),F=Math.min(1,S/300),g=Math.floor(10+F*15),y=Math.floor(10+F*5),T=Math.floor(21+F*10);l.fillStyle=`rgb(${g}, ${y}, ${T})`,l.fillRect(0,u,m,o)}for(let d=Math.max(0,i);d<Math.min(P,n);d++)for(let u=Math.max(0,e);u<Math.min(x,t);u++){const S=f.world[d][u];if(S===h.EMPTY)continue;const F=Se(S,f.time),g=Te(S),y=u*o-M.x,T=d*o-M.y;if(l.fillStyle=F,l.fillRect(y,T,o,o),g&&(l.strokeStyle=g,l.lineWidth=1,l.strokeRect(y+.5,T+.5,o-1,o-1)),S===h.GOLD||S===h.RUBY||S===h.DIAMOND||S===h.UNOBTAINIUM){const p=Math.sin(f.time*6+u*.5+d*.3)*.3+.5;l.fillStyle=`rgba(255, 255, 255, ${p*.4})`,l.fillRect(y+4,T+4,8,8)}if(s>0&&U(S)&&Math.abs(u-r)+Math.abs(d-a)<=s){const E=Math.sin(f.time*4)*.3+.5;l.fillStyle=`rgba(255, 255, 255, ${E*.3})`,l.fillRect(y,T,o,o),l.strokeStyle=`rgba(255, 255, 0, ${E})`,l.lineWidth=2,l.strokeRect(y+1,T+1,o-2,o-2)}if(S===h.CORE_CRYSTAL){const p=Math.sin(f.time*5)*10+20;l.shadowColor="#FF00FF",l.shadowBlur=p,l.fillStyle="#FF00FF",l.beginPath(),l.moveTo(y+o/2,T+4),l.lineTo(y+o-4,T+o/2),l.lineTo(y+o/2,T+o-4),l.lineTo(y+4,T+o/2),l.closePath(),l.fill(),l.fillStyle="#FFFFFF",l.beginPath(),l.arc(y+o/2,T+o/2,4,0,Math.PI*2),l.fill(),l.shadowBlur=0}if(S===h.SURFACE){if(d===6){l.fillStyle="#4a7a44";for(let p=0;p<o;p+=4){const E=3+Math.sin(p+f.time)*2;l.fillRect(y+p,T,2,E)}}else if(d<6){const p=d/6;l.fillStyle=`rgb(${135-p*50}, ${206-p*50}, ${235-p*50})`,l.fillRect(y,T,o,o)}}if(S===h.SHOP){const p=Math.sin(f.time*3)*.3+.7;l.fillStyle=`rgba(255, 215, 0, ${p})`,l.font="bold 22px Courier New",l.textAlign="center",l.fillText("$",y+o/2,T+o/2+7)}if(S===h.FUEL_STATION){const p=Math.sin(f.time*4)*.3+.7;l.fillStyle=`rgba(255, 102, 0, ${p})`,l.font="bold 20px Courier New",l.textAlign="center",l.fillText("F",y+o/2,T+o/2+6);const E=f.time*30%o;l.fillStyle="#FF6600",l.fillRect(y+o/2-2,T+E,4,6)}if(S===h.GAS_POCKET){l.fillStyle="#7CFC00";for(let p=0;p<3;p++){const E=T+o-(f.time*40+p*10)%o,k=y+8+p*8;l.beginPath(),l.arc(k,E,3,0,Math.PI*2),l.fill()}}if(S===h.LAVA)for(let p=0;p<o;p+=8){const E=Math.sin(f.time*4+p*.3)*2;l.fillStyle="#FFFF00",l.fillRect(y+p,T+2+E,6,3)}if(S===h.WATER){l.strokeStyle="rgba(255, 255, 255, 0.3)",l.lineWidth=1;for(let p=0;p<3;p++){const E=Math.sin(f.time*2+p)*3;l.beginPath(),l.moveTo(y,T+8+p*8),l.quadraticCurveTo(y+o/2,T+8+p*8+E,y+o,T+8+p*8),l.stroke()}}}}function H(){var c,d;const e=f.player,t=10;l.fillStyle="rgba(0, 0, 0, 0.7)",l.fillRect(0,0,m,50);const i=e.fuel/e.maxFuel,n=i<.2?"#FF4444":i<.5?"#FFAA00":"#44FF44";l.fillStyle="#333333",l.fillRect(t,10,150,20),l.fillStyle=n,l.fillRect(t,10,150*i,20),l.strokeStyle="#ffffff",l.lineWidth=2,l.strokeRect(t,10,150,20),l.fillStyle="#ffffff",l.font="12px Courier New",l.textAlign="left",l.fillText(`FUEL: ${Math.floor(e.fuel)}/${e.maxFuel}`,t+5,25);const s=e.hp/e.maxHp,r=s<.3?"#FF4444":"#FF6B6B";l.fillStyle="#333333",l.fillRect(t+160,10,100,20),l.fillStyle=r,l.fillRect(t+160,10,100*s,20),l.strokeStyle="#ffffff",l.strokeRect(t+160,10,100,20),l.fillStyle="#ffffff",l.fillText(`HP: ${e.hp}/${e.maxHp}`,t+165,25),l.fillStyle="#4ECDC4",l.font="16px Courier New",l.fillText(`CARGO: ${e.cargo.length}/${e.cargoCapacity}`,t+280,28),l.fillStyle="#FFD700",l.fillText(`$${e.money}`,t+420,28);const a=te(e.tileY);if(l.fillStyle="#AAAAAA",l.fillText(`DEPTH: ${a}m`,t+520,28),e.deaths>0&&(l.fillStyle="#FF4444",l.fillText(`DEATHS: ${e.deaths}/3`,t+650,28)),f.upgrades.teleporter>=1&&(l.fillStyle=e.teleportAvailable?"#00FFFF":"#555555",l.fillText("[SPACE] TP",m-100,28)),e.cargo.length>0){l.fillStyle="rgba(0, 0, 0, 0.7)",l.fillRect(0,D-40,m,40),l.fillStyle="#888888",l.font="12px Courier New",l.fillText("CARGO:",t,D-20);let u=t+60;for(const F of e.cargo){const g=((c=C[F])==null?void 0:c.color)||"#888888";if(l.fillStyle=g,l.fillRect(u,D-30,20,20),u+=24,u>m-50)break}let S=0;for(const F of e.cargo)S+=((d=C[F])==null?void 0:d.value)||0;l.fillStyle="#FFD700",l.textAlign="right",l.fillText(`VALUE: $${S}`,m-t,D-20),l.textAlign="left"}if(e.hasCoreCrystal&&Math.sin(f.time*6)>0&&(l.fillStyle="#FF00FF",l.font="bold 16px Courier New",l.textAlign="center",l.fillText("★ RETURN TO SURFACE WITH CORE CRYSTAL ★",m/2,70),l.textAlign="left"),f.message){l.fillStyle="rgba(0, 0, 0, 0.8)";const u=l.measureText(f.message).width+40;l.fillRect((m-u)/2,80,u,30),l.fillStyle="#FFD700",l.font="bold 16px Courier New",l.textAlign="center",l.fillText(f.message,m/2,100),l.textAlign="left"}}function Oe(){l.fillStyle="#0a0a15",l.fillRect(0,0,m,D);const e=Math.sin(f.time*2)*10+20;l.shadowColor="#FFD700",l.shadowBlur=e,l.fillStyle="#FFD700",l.font="bold 64px Courier New",l.textAlign="center",l.fillText("DEEP DRILL",m/2,180),l.shadowBlur=0,l.fillStyle="#4ECDC4",l.font="24px Courier New",l.fillText("Dig deep. Get rich. Upgrade. Repeat.",m/2,230),l.fillStyle="#888888",l.font="16px Courier New",l.fillText("ARROWS/WASD - Move & Drill",m/2,320),l.fillText("UP/W - Fly (costs extra fuel)",m/2,350),l.fillText("ENTER - Open shop at $ station",m/2,380),l.fillText("SPACE - Emergency teleport (when unlocked)",m/2,410),l.fillStyle="#FF6B6B",l.font="18px Courier New",l.fillText("GOAL: Reach 300m, collect the CORE CRYSTAL, return to surface",m/2,470),Math.sin(f.time*4)>0&&(l.fillStyle="#44FF44",l.font="bold 24px Courier New",l.fillText("PRESS ENTER OR SPACE TO START",m/2,540))}function ke(){l.fillStyle="rgba(0, 0, 0, 0.85)",l.fillRect(0,0,m,D),l.fillStyle="#FF4444",l.font="bold 48px Courier New",l.textAlign="center",l.fillText("GAME OVER",m/2,200),l.fillStyle="#AAAAAA",l.font="20px Courier New",l.fillText(`Deepest: ${f.stats.deepestDepth}m`,m/2,280),l.fillText(`Minerals collected: ${f.stats.mineralsCollected}`,m/2,320),l.fillText(`Total money earned: $${f.stats.totalMoney}`,m/2,360),Math.sin(f.time*4)>0&&(l.fillStyle="#44FF44",l.font="24px Courier New",l.fillText("PRESS ENTER TO TRY AGAIN",m/2,460))}function Le(){l.fillStyle="rgba(0, 0, 0, 0.85)",l.fillRect(0,0,m,D);const e=Math.sin(f.time*3)*10+20;l.shadowColor="#FFD700",l.shadowBlur=e,l.fillStyle="#FFD700",l.font="bold 48px Courier New",l.textAlign="center",l.fillText("VICTORY!",m/2,180),l.shadowBlur=0,l.fillStyle="#4ECDC4",l.font="24px Courier New",l.fillText("You retrieved the Core Crystal!",m/2,240);const t=Math.floor((Date.now()-f.stats.startTime)/1e3),i=Math.floor(t/60),n=t%60;l.fillStyle="#AAAAAA",l.font="20px Courier New",l.fillText(`Time: ${i}:${n.toString().padStart(2,"0")}`,m/2,320),l.fillText(`Deaths: ${f.player.deaths}`,m/2,360),l.fillText(`Minerals collected: ${f.stats.mineralsCollected}`,m/2,400),l.fillText(`Final money: $${f.player.money}`,m/2,440),Math.sin(f.time*4)>0&&(l.fillStyle="#44FF44",l.font="24px Courier New",l.fillText("PRESS ENTER FOR MENU",m/2,520))}function Ne(){l.fillStyle="rgba(0, 0, 0, 0.85)",l.fillRect(0,0,m,D),l.fillStyle="#FF6600",l.font="bold 36px Courier New",l.textAlign="center",l.fillText("STRANDED!",m/2,200),l.fillStyle="#AAAAAA",l.font="20px Courier New",l.fillText("You ran out of fuel underground!",m/2,260),f.player.money>=200?(l.fillStyle="#FFD700",l.fillText(`Rescue cost: $200 (You have: $${f.player.money})`,m/2,320),l.fillStyle="#FF4444",l.fillText("Your cargo will be lost!",m/2,360),l.fillStyle="#44FF44",l.font="18px Courier New",l.fillText("ENTER - Pay for rescue",m/2,420),l.fillStyle="#FF4444",l.fillText("ESC - Abandon drill (counts as death)",m/2,450)):(l.fillStyle="#FF4444",l.fillText(`Not enough money for rescue! ($${f.player.money} < $200)`,m/2,320),l.fillText("Press ESC to abandon...",m/2,380))}function Ie(){switch($.clear(he.background),l.save(),$.applyShake(),f.mode){case A.MENU:Oe();break;case A.PLAYING:I(),G(l,f,M,f.time),L.draw(l,M),H();break;case A.SHOP:I(),G(l,f,M,f.time),L.draw(l,M),H(),ie.draw(l,f,f.time);break;case A.STRANDED:I(),G(l,f,M,f.time),H(),Ne();break;case A.GAME_OVER:I(),ke();break;case A.VICTORY:I(),Le();break}l.restore(),$.resetTransform()}let Z=0;function re(e){const t=Math.min((e-Z)/1e3,.1);Z=e,be(t),Ie(),requestAnimationFrame(re)}console.log("Deep Drill starting...");requestAnimationFrame(re);
